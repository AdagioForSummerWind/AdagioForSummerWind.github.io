# 缓存

## 缓存如何实现高性能
![](https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20221118225928.png)

## 缓存如何实现高并发
![](https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20221118230020.png)


## 3、Redis 和 Memcached 的区别
Redis 拥有更多的数据结构和丰富的数据操作
Redis 内存利用率高于 Memcached
Redis 是单线程，Memcached 是多线程，在存储大数据的情况下，Redis 比
Memcached 稍有逊色
Memcached 没有原生的集群模式，Redis 官方支持 Redis Cluster 集群模式
## 4、用缓存可能出现的问题
⚫ 数据不一致
⚫ 缓存雪崩
⚫ 缓存穿透
⚫ 缓存并发竞争
## 5、当查询缓存报错，怎么提高可用性？
缓存可以极大的ᨀ高查询性能，但是缓存数据丢失和缓存不可用不能影响应用
的正常工作。因此，一般情况下，如果缓存出现异常，需要手动捕获这个异
常，并且记录日志，并且从数据库查询数据返回给用户，而不应该导致业务不
可用。

## 6、如果避免缓存”穿透”的问题？
缓存穿透，是指查询一个一定不存在的数据，由于缓存是不命中时被动写，并
且处于容错考虑，如果从 DB 查不到数据则不写入缓存，这将导致这个不存在
的数据每次请求都要到 DB 去查询，失去了缓存的意义。
如何解决

有两种方案可以解决：
方案一，缓存空对象。 
当从 DB 查询数据为空，我们仍然将这个空结果进行缓存，具体的值需要使用
特殊的标识，能和真正缓存的数据区分开。另外，需要设置较短的过期时间，
一般建议不要超过 5 分钟。
方案二，BloomFilter 布隆过滤器。 
在缓存服务的基础上，构建 BloomFilter 数据结构，在 BloomFilter 中存储
对应的 KEY 是否存在，如果存在，说明该 KEY 对应的值不为空。

## 7、如何避免缓存“雪崩”的问题？
缓存雪崩
缓存雪崩，是指缓存由于某些原因无法ᨀ供服务( 例如，缓存挂掉了 )，所有
请求全部达到 DB 中，导致 DB 负荷大增，最终挂掉的情况。
如何解决
预防和解决缓存雪崩的问题，可以从以下多个方面进行共同着手。
 1）缓存高可用：通过搭建缓存的高可用，避免缓存挂掉导致无法ᨀ供服务的
情况，从而降低出现缓存雪崩的情况。假设我们使用 Redis 作为缓存，则可以
使用 Redis Sentinel 或 Redis Cluster 实现高可用。
 2）本地缓存：如果使用本地缓存时，即使分布式缓存挂了，也可以将 DB 查
询到的结果缓存到本地，避免后续请求全部到达 DB 中。如果我们使用 JVM ，
则可以使用 Ehcache、Guava Cache 实现本地缓存的功能。

## 8、如果避免缓存“击穿”的问题？
缓存击穿
缓存击穿，是指某个极度“热点”数据在某个时间点过期时，恰好在这个时间
点对这个 KEY 有大量的并发请求过来，这些请求发现缓存过期一般都会从 DB 
加载数据并回设到缓存，但是这个时候大并发的请求可能会瞬间 DB 压垮。
对于一些设置了过期时间的 KEY ，如果这些 KEY 可能会在某些时间点被超高
并发地访问，是一种非常“热点”的数据。这个时候，需要考虑这个问题。
区别： 
⚫ 和缓存“雪崩“”的区别在于，前者针对某一 KEY 缓存，后者则是很多
KEY 。
⚫ 和缓存“穿透“”的区别在于，这个 KEY 是真实存在对应的值的。

如何解决
有两种方案可以解决：
1）方案一，使用互斥锁。请求发现缓存不存在后，去查询 DB 前，使用分布
式锁，保证有且只有一个线程去查询 DB ，并更新到缓存。
2）方案二，手动过期。缓存上从不设置过期时间，功能上将过期时间存在 KEY 
对应的 VALUE 里。流程如下：
⚫ 1、获取缓存。通过 VALUE 的过期时间，判断是否过期。如果未过期，则
直接返回；如果已过期，继续往下执行。
⚫ 2、通过一个后台的异步线程进行缓存的构建，也就是“手动”过期。通过
后台的异步线程，保证有且只有一个线程去查询 DB。
⚫ 3、同时，虽然 VALUE 已经过期，还是直接返回。通过这样的方式，保证
服务的可用性，虽然损失了一定的时效性。

## 9、什么是缓存预热？如何实现缓存预热？
缓存预热
在刚启动的缓存系统中，如果缓存中没有任何数据，如果依靠用户请求的方式
重建缓存数据，那么对数据库的压力非常大，而且系统的性能开销也是巨大
的。
此时，最好的策略是启动时就把热点数据加载好。这样，用户请求时，直接读
取的就是缓存的数据，而无需去读取 DB 重建缓存数据。举个例子，热门的或
者推荐的商品，需要ᨀ前预热到缓存中。

如何实现
一般来说，有如下几种方式来实现：
数据量不大时，项目启动时，自动进行初始化。
写个修复数据脚本，手动执行该脚本。
写个管理界面，可以手动点击，预热对应的数据到缓存中。

## 10、缓存数据的淘汰策略有哪些？
除了缓存服务器自带的缓存自动失效策略之外，我们还可以根据具体的业务需
求进行自定义的“手动”缓存淘汰，常见的策略有两种：
1、定时去清理过期的缓存。
2、当有用户请求过来时，再判断这个请求所用到的缓存是否过期，过期的话
就去底层系统得到新数据并更新缓存。
两者各有优劣，第一种的缺点是维护大量缓存的 key 是比较麻烦的，第二种
的缺点就是每次用户请求过来都要判断缓存失效，逻辑相对比较复杂！
具体用哪种方案，大家可以根据自己的应用场景来权衡。























