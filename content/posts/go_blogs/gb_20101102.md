---
title: "Gb_20101102"
date: 2022-05-08T20:49:57+08:00
lastmod: 2022-05-08
tags: [go official blogs]
categories: [2022]
slug: 
draft: false
---
# 调试 Go 代码（状态报告）

Luuk van Dijk  
2010 年 11 月 2 日

在调试方面，没有什么比使用一些策略性的打印语句来检查变量或放置得当的恐慌来获得堆栈跟踪更好的了。但是，有时您缺少耐心或缺少源代码，在这种情况下，一个好的调试器可能是无价的。这就是为什么在过去的几个版本中，我们一直在改进 Go 的 gc 链接器（6l、8l）对 GDB（GNU 调试器）的支持。

在最新版本 (2010-11-02) 中，6l 和 8l 链接器在编写 ELF（Linux、FreeBSD）或 Mach-O（Mac OS X）二进制文件时会发出 DWARF3 调试信息。DWARF 代码足够丰富，可以让您执行以下操作：

- 在 GDB 7.x 版中加载 Go 程序，
- 按行列出所有 Go、C 和汇编源文件（Go 运行时的一部分是用 C 和汇编编写的），
- 按行设置断点并逐步执行代码，
- 打印堆栈跟踪并检查堆栈帧，以及
- 找到地址并打印大多数变量的内容。

还是有一些不便：

- Mac OS X 附带的 GDB 版本 6.x 无法读取发出的 DWARF 代码。我们很乐意接受补丁以使 DWARF 输出与标准 OS X GDB 兼容，但在修复之前，您需要下载、构建, 并安装 GDB 7.x 以在 OS X 下使用它。源代码可以在[http://sourceware.org/gdb/download/](http://sourceware.org/gdb/download/)找到。由于 OS X 的特殊性，您需要在本地文件系统上安装二进制文件`chgrp procmod`和`chmod g+s`.
- 名称由包名限定，并且由于 GDB 不理解 Go 包，因此您必须通过其全名引用每个项目。例如，`v`包中命名的变量`main`必须用`'main.v'`单引号引用。这样做的结果是变量和函数名称的制表符完成不起作用。
- 词法作用域信息有些模糊。如果有多个同名变量，则第 n 个实例将具有“#n”形式的后缀。我们计划解决此问题，但需要对编​​译器和链接器之间交换的数据进行一些更改。
- 切片和字符串变量在运行时库中表示为它们的底层结构。它们看起来像`{data = 0x2aaaaab3e320, len = 1, cap = 1}.`对于切片，您必须取消引用数据指针以检查元素。

有些事情还没有奏效：

- 无法检查通道、函数、接口和映射变量。
- 只有 Go 变量使用类型信息进行注释；运行时的 C 变量不是。
- Windows 和 ARM 二进制文件不包含 DWARF 调试信息，因此无法使用 GDB 进行检查。

在接下来的几个月中，我们打算通过更改编译器和链接器或使用 GDB 的 Python 扩展来解决这些问题。同时，我们希望 Go 程序员能够从更好地访问这个著名的调试工具中受益。

PS DWARF 信息也可以通过 GDB 以外的工具读取。例如，在 Linux 上，您可以将它与 sysprof 系统范围的分析器一起使用。
