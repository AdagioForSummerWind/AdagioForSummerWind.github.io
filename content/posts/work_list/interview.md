---
title: "interview"
date: 2022-06-28T15:30:06+08:00
lastmod: 2022-08-28
tags: [interview]
categories: [MS]
slug: all-interview
draft: false
---



##  面试问题
### 请你先做一个自我介绍
面试官您好，我叫邹啟正，是一名哈工大深圳本科应届生，我比较喜欢golang这门语言，其他语言也有涉猎，c语言是必修，大一的时候和小组用Java 写了一个简单的安卓app，后面大二的时候用C++和同学一起开发了一款简单的回合策略游戏，用的是Cocos2dx 引擎，大三中段的时候了解到了golang。然后就被它的简洁高效吸引了。第一次用 go 写项目是数据库的大作业，是一个实验室软件管理系统，因为需要前端DEMO,当时就用go 写了服务端代码，算是入门了go web 开发，去年暑假前参加了字节后端青训营，参与了极简抖音后端API的开发，暑假的时候将这个单体项目重构成了微服务的项目，也就是简历上的项目。

### 你介绍一下你的项目吧 
DYTT 是我做的一个基于 Gin 和 gRPC 开发的抖音后端项目，包括 API 网关以及一些业务服务，（比如 用户 服务实现了用户登陆注册获取用户主页信息的接口。一个简单的流程就是，API 服务接受 RESTful 请求，路由交给相应的 handler 处理，handler 经过参数验证后又传给 RPC 客户端，然后 RPC 客户端通过 rpc 框架发送请求数据给某个服务，并接受响应数据，然后便继续将数据向上传，最后响应 json 序列化的数据。）DAL层提供数据层实现。API服务使用Gin开放HTTP端口，同时封装了各个业务服务的RPC客户端，用来和各个业务服务进行通讯。

RPC微服务实现：接受客户端请求，在各自的command中实现与数据库交互的业务逻辑

DAL提供数据层实现，pack层将数据库的输出封装为服务端的响应结构体

password 采用了 Argon2id 的算法去加密，本来打算用MD5,后来了解到这个密码更安全就用这个了



1. 采用 (HTTP API 层 + RPC Service 层+Dal 层) 项目结构；

2. 使用 x.509 证书对服务间通信进行加密和认证；
   首先安装证书签发工具，创建 CA 配置文件，用来配置根证书的使用场景和具体参数。然后创建证书签名请求文件 CSR 配置文件。然后通过 CFSSL工具创建 CA 证书和私钥，创建的同时会生成 csr 文件，也就是证书签名请求。用于交叉签名或者重新签名。创建完根证书以及私钥之后，创建业务服务的 csr 配置文件，最后利用根证书和私钥创建各服务的 CA 证书和私钥。

3. 使用 [go-grpc-middleware](https://github.com/grpc-ecosystem/go-grpc-middleware)中的日志记录、认证、和恢复；
   拦截器的话客户端和服务端都可以设置，分为流式拦截器和一元拦截器，根据请求调用的类型决定，请求如果是流式的用到的就是流式拦截器。grpc本身的话一种类型的拦截器只能设置一个，不用这个grpc中间件的话只能将所有逻辑耦合在一起，代码结构就不清晰了。具体的话，自己实现一下go-grpc-middleware每个拦截器相应函数类型然后传进去就行了。
   日志记录其实就是自己实现一个可以返回zap.Logger实例的 grpc-middleware ZapInterceptor 的拦截器函数， 认证的话采用了bearer令牌认证，bearer token 服务端根据密钥生成。客户端在请求服务端时，必须在请求头中包含Authorization: Bearer 。服务端收到请求后，进行解析并校验。使用bearer token是规范了与HTTP请求的对接，毕竟gRPC也可以同时支持HTTP请求。然后恢复的话把gRPC中的panic转成error，从而恢复程序。

4. 使用 **JWT** 进行用户token的校验；
   简单地实现了两个方法，创建 token 解析token，在用户注册或者登陆时创建token 在需要验证身份的时候进行解析验证
   
5. 使用 **ETCD** 进行服务发现和服务注册；（https://blog.51cto.com/u_15314183/5457223）
   服务实例定义以及一些工具函数、服务注册、服务发现
   先构造一个etcd的结构体，包括名称、地址、版本、和权重（后续做降级熔断的话会用到），工具函数包括注册路径，判断一个服务是否存在之类的
   服务注册：定义注册对象结构体，存储全部的实例信息，包括连接超时时间，etcd服务，clientv3实例等，客户端实例的grant方法能创建lease租约,相当于一个TTL存活时间，用于对etcd客户端和服务端之间进行活性检测。在到达TTL时间之前，etcd服务端不会删除相关租约上绑定的键值对；超过TTL时间就会删除，需要在TTL到来之前续租才能实现etcd服务端和客户端之间的保活。具体注册服务的时候先定义一个node存放服务信息，然后调用Register进行注册。
   服务发现：构造服务发现结构体，用了grpc/resolver这个库做解析器，创建一个基于etcd的resolver。然后有一些操作，比如服务发现，watch机制，更新节点操作，同步获取所有地址信息

6. 使用 **Minio** 实现视频文件和图片的对象存储；
   为什么使用minio：性能比较高，比较适合存储图片、视频之类的，采用golang实现，整个系统运行在用户态。

7. 使用 **Gorm** 对 MySQL 进行 ORM 操作；
   orm object-relational mapping。我觉得最大的优点是能够更好的构建查询，能相对简单地动态构造出复杂的sql语句。单纯用sql的话只是字符串意义上的拼接。
   当然也可以防sql注入，gorm通过占位符的形式一定程度上减少了sql注入
   不足：不能明确sql的内容

8. 使用 **Zipkin** 分布式追踪系统实现链路跟踪；(https://zhuanlan.zhihu.com/p/453190067)
   可以收集服务的一些计时数据，可以用于一些延迟问题的故障排除。
   reporter报告器：将服务之间的请求调用信息报告给zipkin后台，用于生成链路追踪和依赖图。包括http报告器和log报告器，HTTP报告器将请求调用信息封装为span异步报告给zipkin服务器，log报告器将服务调用信息打印到控制台。
   Endpoint: 一个标记信息，标记此服务的服务名以及地址信息，用于zipkin后台画图和分析
   Tracer追踪器：解析服务调用之间的上下文信息context,将链路信息封装为span
   grpc整合zipkin：把创建追踪器的过程封装为一个方法，进行一些初始化即可

9.  数据库表建立了索引和外键约束，对于具有关联性的操作一旦出错立刻回滚，保证数据一致性和安全性；

10. HTTP 服务和 RPC 服务的优雅停止。（https://leileiluoluo.com/posts/golang-shutdown-server-gracefully.html）
    用一个goroutine启动服务，为了不让这个启动过程阻塞后面的优雅停止。
    http服务主要就是使用 http.Server 的 Shutdown 方法结合 signal.Notify 来优雅的终止服务
    初始化一个channel，利用signal.Notify等待系统中断信号，不然就一直阻塞，当中断信号来了的时候，开始优雅关闭，关闭http.server的话直接调用标准库net/http包的Shutdown方法（由文档可知，可以优雅地终止服务，但不会直接中断活跃连接，先关闭所有闲置连接，等待活跃连接闲置后才终止服务）


数据库表建立了索引和外键约束，对于具有关联性的操作一旦出错立刻回滚，保证数据一致性和安全性；


### User 微服务

| 注册接口 | 登录接口 | 获取用户信息接口 |
| --- | --- | --- |
| ![注册接口.png](pic/%E6%B3%A8%E5%86%8C%E6%8E%A5%E5%8F%A3.png) | ![登录接口.png](pic/%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3.png) | ![获取用户信息接口.png](pic/%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3.png) |

### Feed 微服务

| 获取视频流接口 |
| --- |
| ![获取视频流接口.png](pic/%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E6%B5%81%E6%8E%A5%E5%8F%A3.png) |

### Publish 微服务

| 投稿视频接口 | 获取用户发布视频列表接口 |
| --- | --- |
| ![投稿视频接口.png](pic/%E6%8A%95%E7%A8%BF%E8%A7%86%E9%A2%91%E6%8E%A5%E5%8F%A3.png) | ![获取用户发布视频列表接口.png](pic/%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%8F%91%E5%B8%83%E8%A7%86%E9%A2%91%E5%88%97%E8%A1%A8%E6%8E%A5%E5%8F%A3.png) |

### Comment 微服务

| 评论操作接口 | 获取视频评论列表接口 |
| --- | --- |
| ![评论操作接口.png](pic/%E8%AF%84%E8%AE%BA%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3.png) | ![获取视频评论列表接口.png](pic/%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8%E6%8E%A5%E5%8F%A3.png) |

### Favorite 微服务

| 点赞操作接口 | 获取用户点赞列表接口 |
| --- | --- |
| ![点赞操作接口.png](pic/%E7%82%B9%E8%B5%9E%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3.png) | ![获取用户点赞列表接口.png](pic/%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E7%82%B9%E8%B5%9E%E5%88%97%E8%A1%A8%E6%8E%A5%E5%8F%A3.png) |

### Relation 微服务

| 关注操作接口 | 获取关注列表接口 |
| --- | --- |
| ![关注操作接口.png](pic/%E5%85%B3%E6%B3%A8%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3.png) | ![获取关注列表接口.png](pic/%E8%8E%B7%E5%8F%96%E5%85%B3%E6%B3%A8%E5%88%97%E8%A1%A8%E6%8E%A5%E5%8F%A3.png) |







