<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title> - 绿叶律动</title><meta name="Description" content="绿叶律动"><meta property="og:title" content="" />
<meta property="og:description" content="访问集群中的应用程序 配置负载平衡、端口转发或设置防火墙或 DNS 配置，以访问集群中的应用程序。 部署和访问 Kubernetes 仪表板（Dashboard） Dashboard 是基于网页" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jefofrank.xyz/%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" /><meta property="og:image" content="https://jefofrank.xyz/logo.png"/><meta property="article:section" content="posts" />



<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jefofrank.xyz/logo.png"/>

<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="访问集群中的应用程序 配置负载平衡、端口转发或设置防火墙或 DNS 配置，以访问集群中的应用程序。 部署和访问 Kubernetes 仪表板（Dashboard） Dashboard 是基于网页"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://jefofrank.xyz/%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" /><link rel="prev" href="https://jefofrank.xyz/%E8%BF%90%E8%A1%8Cjobs/" /><link rel="next" href="https://jefofrank.xyz/%E7%AE%A1%E7%90%86kubernetes%E5%AF%B9%E8%B1%A1%E4%B8%8Esecrets/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/jefofrank.xyz\/%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F\/"
        },"image": ["https:\/\/jefofrank.xyz\/images\/Apple-Devices-Preview.png"],"genre": "posts","wordcount":  18140 ,
        "url": "https:\/\/jefofrank.xyz\/%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F\/","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Jefo","logo": "https:\/\/jefofrank.xyz\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "Jefo"
            },"description": ""
    }
    </script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-193031966-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-193031966-2');
</script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="绿叶律动"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> All posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/jf-011101" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="直接搜索更方便^-^" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="绿叶律动"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="直接搜索更方便^-^" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">All posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/jf-011101" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX"></h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/jf-011101" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jefo</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="0001-01-01 00:00:00">0001-01-01 00:00:00</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 18140 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 37 分钟&nbsp;<span id="busuanzi_container_page_pv">
                    <i class="far fa-eye fa-fw"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;次阅读量</span>
                </span>
            </div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#部署和访问-kubernetes-仪表板dashboardhttpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboard"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/">部署和访问 Kubernetes 仪表板（Dashboard）</a></a>
      <ul>
        <li><a href="#部署-dashboard-uihttpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde983a8e7bdb2-dashboard-ui">部署 Dashboard UI<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E9%83%A8%E7%BD%B2-dashboard-ui"></a></a></li>
        <li><a href="#访问-dashboard-用户界面httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde8aebfe997ae-dashboard-e794a8e688b7e7958ce99da2">访问 Dashboard 用户界面<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E8%AE%BF%E9%97%AE-dashboard-%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2"></a></a>
          <ul>
            <li><a href="#命令行代理httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde591bde4bba4e8a18ce4bba3e79086">命令行代理<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%A3%E7%90%86"></a></a></li>
          </ul>
        </li>
        <li><a href="#欢迎界面httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde6aca2e8bf8ee7958ce99da2">欢迎界面<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E6%AC%A2%E8%BF%8E%E7%95%8C%E9%9D%A2"></a></a></li>
        <li><a href="#部署容器化应用httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde983a8e7bdb2e5aeb9e599a8e58c96e5ba94e794a8">部署容器化应用<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E9%83%A8%E7%BD%B2%E5%AE%B9%E5%99%A8%E5%8C%96%E5%BA%94%E7%94%A8"></a></a>
          <ul>
            <li><a href="#指定应用的详细配置httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde68c87e5ae9ae5ba94e794a8e79a84e8afa6e7bb86e9858de7bdae">指定应用的详细配置<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E6%8C%87%E5%AE%9A%E5%BA%94%E7%94%A8%E7%9A%84%E8%AF%A6%E7%BB%86%E9%85%8D%E7%BD%AE"></a></a></li>
            <li><a href="#上传-yaml-或者-json-文件httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde4b88ae4bca0-yaml-e68896e88085-json-e69687e4bbb6">上传 YAML 或者 JSON 文件<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E4%B8%8A%E4%BC%A0-yaml-%E6%88%96%E8%80%85-json-%E6%96%87%E4%BB%B6"></a></a></li>
          </ul>
        </li>
        <li><a href="#使用-dashboardhttpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde4bdbfe794a8-dashboard">使用 Dashboard<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E4%BD%BF%E7%94%A8-dashboard"></a></a>
          <ul>
            <li><a href="#导航httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde5afbce888aa">导航<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E5%AF%BC%E8%88%AA"></a></a>
              <ul>
                <li><a href="#管理概述httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde7aea1e79086e6a682e8bfb0">管理概述<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E7%AE%A1%E7%90%86%E6%A6%82%E8%BF%B0"></a></a></li>
                <li><a href="#负载httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde8b49fe8bdbd">负载<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E8%B4%9F%E8%BD%BD"></a></a></li>
                <li><a href="#服务httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde69c8de58aa1">服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E6%9C%8D%E5%8A%A1"></a></a></li>
                <li><a href="#存储httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde5ad98e582a8">存储<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E5%AD%98%E5%82%A8"></a></a></li>
                <li><a href="#configmap-和-secrethttpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboardconfig-maps-and-secrets">ConfigMap 和 Secret<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#config-maps-and-secrets"></a></a></li>
                <li><a href="#日志查看器httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde697a5e5bf97e69fa5e79c8be599a8">日志查看器<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E5%99%A8"></a></a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#接下来httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E6%8E%A5%E4%B8%8B%E6%9D%A5"></a></a></li>
      </ul>
    </li>
    <li><a href="#访问集群httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/">访问集群</a></a>
      <ul>
        <li><a href="#使用-kubectl-完成集群的第一次访问httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusteraccessing-for-the-first-time-with-kubectl">使用 kubectl 完成集群的第一次访问<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#accessing-for-the-first-time-with-kubectl"></a></a></li>
        <li><a href="#直接访问-rest-apihttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterdirectly-accessing-the-rest-api">直接访问 REST API<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#directly-accessing-the-rest-api"></a></a>
          <ul>
            <li><a href="#使用-kubectl-proxyhttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterusing-kubectl-proxy">使用 kubectl proxy<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#using-kubectl-proxy"></a></a></li>
            <li><a href="#不使用-kubectl-proxyhttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterwithout-kubectl-proxy">不使用 kubectl proxy<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#without-kubectl-proxy"></a></a></li>
          </ul>
        </li>
        <li><a href="#以编程方式访问-apihttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterprogrammatic-access-to-the-api">以编程方式访问 API<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#programmatic-access-to-the-api"></a></a>
          <ul>
            <li><a href="#go-客户端httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clustergo-client">Go 客户端<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#go-client"></a></a></li>
            <li><a href="#python-客户端httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterpython-client">Python 客户端<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#python-client"></a></a></li>
            <li><a href="#其它语言httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterother-languages">其它语言<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#other-languages"></a></a></li>
            <li><a href="#从-pod-中访问-apihttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusteraccessing-the-api-from-a-pod">从 Pod 中访问 API<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#accessing-the-api-from-a-pod"></a></a></li>
          </ul>
        </li>
        <li><a href="#访问集群上运行的服务httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusteraccessing-services-running-on-the-cluster">访问集群上运行的服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#accessing-services-running-on-the-cluster"></a></a></li>
        <li><a href="#请求重定向httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterrequesting-redirects">请求重定向<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#requesting-redirects"></a></a></li>
        <li><a href="#多种代理httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterso-many-proxies">多种代理<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#so-many-proxies"></a></a></li>
      </ul>
    </li>
    <li><a href="#配置对多集群的访问httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusters"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/">配置对多集群的访问</a></a>
      <ul>
        <li><a href="#准备开始httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterse58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B"></a></a></li>
        <li><a href="#定义集群用户和上下文httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clustersdefine-clusters-users-and-contexts">定义集群、用户和上下文<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#define-clusters-users-and-contexts"></a></a></li>
        <li><a href="#创建第二个配置文件httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterscreate-a-second-configuration-file">创建第二个配置文件<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#create-a-second-configuration-file"></a></a></li>
        <li><a href="#设置-kubeconfig-环境变量httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clustersset-the-kubeconfig-environment-variable">设置 KUBECONFIG 环境变量<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#set-the-kubeconfig-environment-variable"></a></a>
          <ul>
            <li><a href="#linuxhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterslinux">Linux<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#linux"></a></a></li>
            <li><a href="#windows-powershellhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterswindows-powershell">Windows PowerShell<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#windows-powershell"></a></a></li>
            <li><a href="#linuxhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterslinux-1">Linux<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#linux-1"></a></a></li>
            <li><a href="#windows-powershellhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterswindows-powershell-1">Windows PowerShell<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#windows-powershell-1"></a></a></li>
          </ul>
        </li>
        <li><a href="#探索-homekube-目录httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clustersexplore-the-home-kube-directory">探索 $HOME/.kube 目录<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#explore-the-home-kube-directory"></a></a></li>
        <li><a href="#将-homekubeconfig-追加到-kubeconfig-环境变量中httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clustersappend-home-kube-config-to-your-kubeconfig-environment-variable">将 $HOME/.kube/config 追加到 KUBECONFIG 环境变量中<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#append-home-kube-config-to-your-kubeconfig-environment-variable"></a></a>
          <ul>
            <li><a href="#linuxhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterslinux-2">Linux<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#linux-2"></a></a></li>
            <li><a href="#windows-powershellhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterswindows-powershell-2">Windows Powershell<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#windows-powershell-2"></a></a></li>
          </ul>
        </li>
        <li><a href="#清理httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clustersclean-up">清理<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#clean-up"></a></a>
          <ul>
            <li><a href="#linuxhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterslinux-3">Linux<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#linux-3"></a></a></li>
            <li><a href="#windows-powershellhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterswindows-powershell-3">Windows PowerShell<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#windows-powershell-3"></a></a></li>
          </ul>
        </li>
        <li><a href="#检查-kubeconfig-所表示的主体httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterscheck-the-subject">检查 kubeconfig 所表示的主体<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#check-the-subject"></a></a></li>
        <li><a href="#接下来httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterse68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#%E6%8E%A5%E4%B8%8B%E6%9D%A5"></a></a></li>
      </ul>
    </li>
    <li><a href="#使用端口转发来访问集群中的应用httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-cluster"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/">使用端口转发来访问集群中的应用</a></a>
      <ul>
        <li><a href="#准备开始httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clustere58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B"></a></a></li>
        <li><a href="#创建-mongodb-deployment-和服务httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clustere5889be5bbba-mongodb-deployment-e5928ce69c8de58aa1">创建 MongoDB Deployment 和服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#%E5%88%9B%E5%BB%BA-mongodb-deployment-%E5%92%8C%E6%9C%8D%E5%8A%A1"></a></a></li>
        <li><a href="#转发一个本地端口到-pod-端口httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clustere8bdace58f91e4b880e4b8aae69cace59cb0e7abafe58fa3e588b0-pod-e7abafe58fa3">转发一个本地端口到 Pod 端口<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#%E8%BD%AC%E5%8F%91%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E7%AB%AF%E5%8F%A3%E5%88%B0-pod-%E7%AB%AF%E5%8F%A3"></a></a>
          <ul>
            <li><a href="#可选操作让-_kubectl_-来选择本地端口httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clusterlet-kubectl-choose-local-port">（可选操作）让 <em>kubectl</em> 来选择本地端口<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#let-kubectl-choose-local-port"></a></a></li>
          </ul>
        </li>
        <li><a href="#讨论httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clusterdiscussion">讨论<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#discussion"></a></a></li>
        <li><a href="#接下来httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clustere68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#%E6%8E%A5%E4%B8%8B%E6%9D%A5"></a></a></li>
      </ul>
    </li>
    <li><a href="#使用服务来访问集群中的应用httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-cluster"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/">使用服务来访问集群中的应用</a></a>
      <ul>
        <li><a href="#准备开始httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clustere58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B"></a></a></li>
        <li><a href="#教程目标httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clustere69599e7a88be79baee6a087">教程目标<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#%E6%95%99%E7%A8%8B%E7%9B%AE%E6%A0%87"></a></a></li>
        <li><a href="#为运行在两个-pod-中的应用创建一个服务httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clustercreating-a-service-for-an-app-running-in-two-pods">为运行在两个 Pod 中的应用创建一个服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#creating-a-service-for-an-app-running-in-two-pods"></a></a></li>
        <li><a href="#使用服务配置文件httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clusterusing-a-service-configuration-file">使用服务配置文件<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#using-a-service-configuration-file"></a></a></li>
        <li><a href="#清理现场httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clustere6b885e79086e78eb0e59cba">清理现场<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#%E6%B8%85%E7%90%86%E7%8E%B0%E5%9C%BA"></a></a></li>
        <li><a href="#接下来httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clustere68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#%E6%8E%A5%E4%B8%8B%E6%9D%A5"></a></a></li>
      </ul>
    </li>
    <li><a href="#使用-service-把前端连接到后端httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backend"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/">使用 Service 把前端连接到后端</a></a>
      <ul>
        <li><a href="#教程目标httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende69599e7a88be79baee6a087">教程目标<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E6%95%99%E7%A8%8B%E7%9B%AE%E6%A0%87"></a></a></li>
        <li><a href="#准备开始httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B"></a></a>
          <ul>
            <li><a href="#使用部署对象deployment创建后端httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende4bdbfe794a8e983a8e7bdb2e5afb9e8b1a1-deployment-e5889be5bbbae5908ee7abaf">使用部署对象（Deployment）创建后端<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E4%BD%BF%E7%94%A8%E9%83%A8%E7%BD%B2%E5%AF%B9%E8%B1%A1-deployment-%E5%88%9B%E5%BB%BA%E5%90%8E%E7%AB%AF"></a></a></li>
            <li><a href="#创建-hello-service-对象httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende5889be5bbba-hello-service-e5afb9e8b1a1">创建 <code>hello</code> Service 对象<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E5%88%9B%E5%BB%BA-hello-service-%E5%AF%B9%E8%B1%A1"></a></a></li>
            <li><a href="#创建前端应用httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende5889be5bbbae5898de7abafe5ba94e794a8">创建前端应用<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E5%88%9B%E5%BB%BA%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8"></a></a></li>
            <li><a href="#与前端-service-交互httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backendinteract-with-the-frontend-service">与前端 Service 交互<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#interact-with-the-frontend-service"></a></a></li>
            <li><a href="#通过前端发送流量httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende9809ae8bf87e5898de7abafe58f91e98081e6b581e9878f">通过前端发送流量<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E9%80%9A%E8%BF%87%E5%89%8D%E7%AB%AF%E5%8F%91%E9%80%81%E6%B5%81%E9%87%8F"></a></a></li>
          </ul>
        </li>
        <li><a href="#清理现场httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende6b885e79086e78eb0e59cba">清理现场<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E6%B8%85%E7%90%86%E7%8E%B0%E5%9C%BA"></a></a></li>
        <li><a href="#接下来httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E6%8E%A5%E4%B8%8B%E6%9D%A5"></a></a></li>
      </ul>
    </li>
    <li><a href="#创建外部负载均衡器httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancer"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/">创建外部负载均衡器</a></a>
      <ul>
        <li><a href="#准备开始httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancere58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B"></a></a></li>
        <li><a href="#创建服务httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancercreate-a-service">创建服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#create-a-service"></a></a>
          <ul>
            <li><a href="#基于清单文件创建服务httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancercreate-a-service-from-a-manifest">基于清单文件创建服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#create-a-service-from-a-manifest"></a></a></li>
            <li><a href="#使用-kubectl-创建-servicehttpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancercreate-a-service-using-kubectl">使用 kubectl 创建 Service<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#create-a-service-using-kubectl"></a></a></li>
          </ul>
        </li>
        <li><a href="#找到你的-ip-地址httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancerfinding-your-ip-address">找到你的 IP 地址<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#finding-your-ip-address"></a></a></li>
        <li><a href="#保留客户端源-iphttpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancerpreserving-the-client-source-ip">保留客户端源 IP<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#preserving-the-client-source-ip"></a></a>
          <ul>
            <li><a href="#保留源-ip-时的注意事项和限制httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancercaveats-and-limitations-when-preserving-source-ips">保留源 IP 时的注意事项和限制<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#caveats-and-limitations-when-preserving-source-ips"></a></a></li>
          </ul>
        </li>
        <li><a href="#回收负载均衡器httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancergarbage-collecting-load-balancers">回收负载均衡器<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#garbage-collecting-load-balancers"></a></a></li>
        <li><a href="#外部负载均衡器供应商httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancerexternal-load-balancer-providers">外部负载均衡器供应商<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#external-load-balancer-providers"></a></a></li>
        <li><a href="#接下来httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancere68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#%E6%8E%A5%E4%B8%8B%E6%9D%A5"></a></a></li>
      </ul>
    </li>
    <li><a href="#列出集群中所有运行容器的镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-images"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/">列出集群中所有运行容器的镜像</a></a>
      <ul>
        <li><a href="#准备开始httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B"></a></a></li>
        <li><a href="#列出所有命名空间下的所有容器镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese58897e587bae68980e69c89e591bde5908de7a9bae997b4e4b88be79a84e68980e69c89e5aeb9e599a8e9959ce5838f">列出所有命名空间下的所有容器镜像<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"></a></a></li>
        <li><a href="#按-pod-列出容器镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese68c89-pod-e58897e587bae5aeb9e599a8e9959ce5838f">按 Pod 列出容器镜像<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E6%8C%89-pod-%E5%88%97%E5%87%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"></a></a></li>
        <li><a href="#列出以标签过滤后的-pod-的所有容器镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese58897e587bae4bba5e6a087e7adbee8bf87e6bba4e5908ee79a84-pod-e79a84e68980e69c89e5aeb9e599a8e9959ce5838f">列出以标签过滤后的 Pod 的所有容器镜像<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E5%88%97%E5%87%BA%E4%BB%A5%E6%A0%87%E7%AD%BE%E8%BF%87%E6%BB%A4%E5%90%8E%E7%9A%84-pod-%E7%9A%84%E6%89%80%E6%9C%89%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"></a></a></li>
        <li><a href="#列出以命名空间过滤后的-pod-的所有容器镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese58897e587bae4bba5e591bde5908de7a9bae997b4e8bf87e6bba4e5908ee79a84-pod-e79a84e68980e69c89e5aeb9e599a8e9959ce5838f">列出以命名空间过滤后的 Pod 的所有容器镜像<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E5%88%97%E5%87%BA%E4%BB%A5%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E8%BF%87%E6%BB%A4%E5%90%8E%E7%9A%84-pod-%E7%9A%84%E6%89%80%E6%9C%89%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"></a></a></li>
        <li><a href="#使用-go-template-代替-jsonpath-来获取容器镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese4bdbfe794a8-go-template-e4bba3e69bbf-jsonpath-e69da5e88eb7e58f96e5aeb9e599a8e9959ce5838f">使用 go-template 代替 jsonpath 来获取容器镜像<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E4%BD%BF%E7%94%A8-go-template-%E4%BB%A3%E6%9B%BF-jsonpath-%E6%9D%A5%E8%8E%B7%E5%8F%96%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F"></a></a></li>
        <li><a href="#接下来httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E6%8E%A5%E4%B8%8B%E6%9D%A5"></a></a>
          <ul>
            <li><a href="#参考httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese58f82e88083">参考<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E5%8F%82%E8%80%83"></a></a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#在-minikube-环境中使用-nginx-ingress-控制器配置-ingresshttpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikube"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/">在 Minikube 环境中使用 NGINX Ingress 控制器配置 Ingress</a></a>
      <ul>
        <li><a href="#准备开始httpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubee58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B"></a></a>
          <ul>
            <li><a href="#创建一个-minikube-集群httpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubecreate-minikube-cluster">创建一个 Minikube 集群<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#create-minikube-cluster"></a></a></li>
          </ul>
        </li>
        <li><a href="#启用-ingress-控制器httpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubee590afe794a8-ingress-e68ea7e588b6e599a8">启用 Ingress 控制器<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E5%90%AF%E7%94%A8-ingress-%E6%8E%A7%E5%88%B6%E5%99%A8"></a></a></li>
        <li><a href="#部署一个-hello-world-应用httpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubedeploy-hello-world">部署一个 Hello World 应用<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#deploy-hello-world"></a></a></li>
        <li><a href="#创建一个-ingresshttpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubee5889be5bbbae4b880e4b8aa-ingress">创建一个 Ingress<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-ingress"></a></a></li>
        <li><a href="#创建第二个-deploymenthttpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubecreate-second-deployment">创建第二个 Deployment<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#create-second-deployment"></a></a></li>
        <li><a href="#编辑现有的-ingresshttpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubeedit-ingress">编辑现有的 Ingress<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#edit-ingress"></a></a></li>
        <li><a href="#测试你的-ingresshttpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubetest-ingress">测试你的 Ingress<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#test-ingress"></a></a></li>
        <li><a href="#接下来httpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubee68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E6%8E%A5%E4%B8%8B%E6%9D%A5"></a></a></li>
      </ul>
    </li>
    <li><a href="#同-pod-内的容器使用共享卷通信httpskubernetesiozh-cndocstasksaccess-application-clustercommunicate-containers-same-pod-shared-volume"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/">同 Pod 内的容器使用共享卷通信</a></a>
      <ul>
        <li><a href="#准备开始httpskubernetesiozh-cndocstasksaccess-application-clustercommunicate-containers-same-pod-shared-volumee58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B"></a></a></li>
        <li><a href="#创建一个包含两个容器的-podhttpskubernetesiozh-cndocstasksaccess-application-clustercommunicate-containers-same-pod-shared-volumee5889be5bbbae4b880e4b8aae58c85e590abe4b8a4e4b8aae5aeb9e599a8e79a84-pod">创建一个包含两个容器的 Pod<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB%E4%B8%A4%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%9A%84-pod"></a></a></li>
        <li><a href="#讨论httpskubernetesiozh-cndocstasksaccess-application-clustercommunicate-containers-same-pod-shared-volumee8aea8e8aeba">讨论<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/#%E8%AE%A8%E8%AE%BA"></a></a></li>
        <li><a href="#接下来httpskubernetesiozh-cndocstasksaccess-application-clustercommunicate-containers-same-pod-shared-volumee68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/#%E6%8E%A5%E4%B8%8B%E6%9D%A5"></a></a></li>
      </ul>
    </li>
    <li><a href="#为集群配置-dnshttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-dns-cluster"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-dns-cluster/">为集群配置 DNS</a></a></li>
    <li><a href="#访问集群上运行的服务httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-services"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/">访问集群上运行的服务</a></a>
      <ul>
        <li><a href="#准备开始httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicese58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B"></a></a></li>
        <li><a href="#访问集群上运行的服务httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesaccessing-services-running-on-the-cluster">访问集群上运行的服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#accessing-services-running-on-the-cluster"></a></a>
          <ul>
            <li><a href="#连接方式httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesways-to-connect">连接方式<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#ways-to-connect"></a></a></li>
            <li><a href="#发现内置服务httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesdiscovering-builtin-services">发现内置服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#discovering-builtin-services"></a></a>
              <ul>
                <li><a href="#手动构建-api-服务器代理-urlshttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesmanually-constructing-apiserver-proxy-urls">手动构建 API 服务器代理 URLs<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#manually-constructing-apiserver-proxy-urls"></a></a>
                  <ul>
                    <li><a href="#示例httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesexamples">示例<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#examples"></a></a></li>
                  </ul>
                </li>
                <li><a href="#通过-web-浏览器访问集群中运行的服务httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesuusing-web-browsers-to-access-services-running-on-the-cluster">通过 Web 浏览器访问集群中运行的服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#uusing-web-browsers-to-access-services-running-on-the-cluster"></a></a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="访问集群中的应用程序">访问集群中的应用程序</h1>
<p>配置负载平衡、端口转发或设置防火墙或 DNS 配置，以访问集群中的应用程序。</p>
<hr>
<h2 id="部署和访问-kubernetes-仪表板dashboardhttpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboard"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/" target="_blank" rel="noopener noreffer">部署和访问 Kubernetes 仪表板（Dashboard）</a></h2>
<p>Dashboard 是基于网页的 Kubernetes 用户界面。 你可以使用 Dashboard 将容器应用部署到 Kubernetes 集群中，也可以对容器应用排错，还能管理集群资源。 你可以使用 Dashboard 获取运行在集群中的应用的概览信息，也可以创建或者修改 Kubernetes 资源 （如 Deployment，Job，DaemonSet 等等）。 例如，你可以对 Deployment 实现弹性伸缩、发起滚动升级、重启 Pod 或者使用向导创建新的应用。</p>
<p>Dashboard 同时展示了 Kubernetes 集群中的资源状态信息和所有报错信息。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://d33wubrfki0l68.cloudfront.net/349824f68836152722dab89465835e604719caea/6e0b7/images/docs/ui-dashboard.png"
        data-srcset="https://d33wubrfki0l68.cloudfront.net/349824f68836152722dab89465835e604719caea/6e0b7/images/docs/ui-dashboard.png, https://d33wubrfki0l68.cloudfront.net/349824f68836152722dab89465835e604719caea/6e0b7/images/docs/ui-dashboard.png 1.5x, https://d33wubrfki0l68.cloudfront.net/349824f68836152722dab89465835e604719caea/6e0b7/images/docs/ui-dashboard.png 2x"
        data-sizes="auto"
        alt="https://d33wubrfki0l68.cloudfront.net/349824f68836152722dab89465835e604719caea/6e0b7/images/docs/ui-dashboard.png"
        title="Kubernetes Dashboard UI" /></p>
<h3 id="部署-dashboard-uihttpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde983a8e7bdb2-dashboard-ui">部署 Dashboard UI<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E9%83%A8%E7%BD%B2-dashboard-ui" target="_blank" rel="noopener noreffer"></a></h3>
<p>默认情况下不会部署 Dashboard。可以通过以下命令部署：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
</code></pre></td></tr></table>
</div>
</div><h3 id="访问-dashboard-用户界面httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde8aebfe997ae-dashboard-e794a8e688b7e7958ce99da2">访问 Dashboard 用户界面<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E8%AE%BF%E9%97%AE-dashboard-%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2" target="_blank" rel="noopener noreffer"></a></h3>
<p>为了保护你的集群数据，默认情况下，Dashboard 会使用最少的 RBAC 配置进行部署。 当前，Dashboard 仅支持使用 Bearer 令牌登录。 要为此样本演示创建令牌，你可以按照 <a href="https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md" target="_blank" rel="noopener noreffer">创建示例用户</a> 上的指南进行操作。</p>
<p><strong>警告：</strong></p>
<p>在教程中创建的样本用户将具有管理特权，并且仅用于教育目的。</p>
<h4 id="命令行代理httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde591bde4bba4e8a18ce4bba3e79086">命令行代理<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%A3%E7%90%86" target="_blank" rel="noopener noreffer"></a></h4>
<p>你可以使用 <code>kubectl</code> 命令行工具来启用 Dashboard 访问，命令如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">kubectl proxy
</code></pre></td></tr></table>
</div>
</div><p>kubectl 会使得 Dashboard 可以通过 <a href="http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/" target="_blank" rel="noopener noreffer">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</a> 访问。</p>
<p>UI <em>只能</em> 通过执行这条命令的机器进行访问。更多选项参见 <code>kubectl proxy --help</code>。</p>
<p><strong>说明：</strong></p>
<p>Kubeconfig 身份验证方法<strong>不</strong>支持外部身份提供程序或基于 x509 证书的身份验证。</p>
<h3 id="欢迎界面httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde6aca2e8bf8ee7958ce99da2">欢迎界面<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E6%AC%A2%E8%BF%8E%E7%95%8C%E9%9D%A2" target="_blank" rel="noopener noreffer"></a></h3>
<p>当访问空集群的 Dashboard 时，你会看到欢迎界面。 页面包含一个指向此文档的链接，以及一个用于部署第一个应用程序的按钮。 此外，你可以看到在默认情况下有哪些默认系统应用运行在 <code>kube-system</code> <a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/namespaces/" target="_blank" rel="noopener noreffer">名字空间</a> 中，比如 Dashboard 自己。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://d33wubrfki0l68.cloudfront.net/5f56e7ac82f10f46e70403a246c2b93efcf8b5b3/1c09f/images/docs/ui-dashboard-zerostate.png"
        data-srcset="https://d33wubrfki0l68.cloudfront.net/5f56e7ac82f10f46e70403a246c2b93efcf8b5b3/1c09f/images/docs/ui-dashboard-zerostate.png, https://d33wubrfki0l68.cloudfront.net/5f56e7ac82f10f46e70403a246c2b93efcf8b5b3/1c09f/images/docs/ui-dashboard-zerostate.png 1.5x, https://d33wubrfki0l68.cloudfront.net/5f56e7ac82f10f46e70403a246c2b93efcf8b5b3/1c09f/images/docs/ui-dashboard-zerostate.png 2x"
        data-sizes="auto"
        alt="https://d33wubrfki0l68.cloudfront.net/5f56e7ac82f10f46e70403a246c2b93efcf8b5b3/1c09f/images/docs/ui-dashboard-zerostate.png"
        title="Kubernetes Dashboard 欢迎页面" /></p>
<h3 id="部署容器化应用httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde983a8e7bdb2e5aeb9e599a8e58c96e5ba94e794a8">部署容器化应用<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E9%83%A8%E7%BD%B2%E5%AE%B9%E5%99%A8%E5%8C%96%E5%BA%94%E7%94%A8" target="_blank" rel="noopener noreffer"></a></h3>
<p>通过一个简单的部署向导，你可以使用 Dashboard 将容器化应用作为一个 Deployment 和可选的 Service 进行创建和部署。你可以手工指定应用的详细配置，或者上传一个包含应用配置的 YAML 或 JSON _清单_文件。</p>
<p>点击任何页面右上角的 <strong>CREATE</strong> 按钮以开始。</p>
<h4 id="指定应用的详细配置httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde68c87e5ae9ae5ba94e794a8e79a84e8afa6e7bb86e9858de7bdae">指定应用的详细配置<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E6%8C%87%E5%AE%9A%E5%BA%94%E7%94%A8%E7%9A%84%E8%AF%A6%E7%BB%86%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreffer"></a></h4>
<p>部署向导需要你提供以下信息：</p>
<ul>
<li>
<p><strong>应用名称</strong>（必填）：应用的名称。内容为 <code>应用名称</code> 的 <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noopener noreffer">标签</a> 会被添加到任何将被部署的 Deployment 和 Service。</p>
<p>在选定的 Kubernetes <a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/namespaces/" target="_blank" rel="noopener noreffer">名字空间</a> 中， 应用名称必须唯一。必须由小写字母开头，以数字或者小写字母结尾， 并且只含有小写字母、数字和中划线（-）。小于等于24个字符。开头和结尾的空格会被忽略。</p>
</li>
<li>
<p><strong>容器镜像</strong>（必填）：公共镜像仓库上的 Docker <a href="https://kubernetes.io/zh-cn/docs/concepts/containers/images/" target="_blank" rel="noopener noreffer">容器镜像</a> 或者私有镜像仓库 （通常是 Google Container Registry 或者 Docker Hub）的 URL。容器镜像参数说明必须以冒号结尾。</p>
</li>
<li>
<p><strong>Pod 的数量</strong>（必填）：你希望应用程序部署的 Pod 的数量。值必须为正整数。</p>
<p>系统会创建一个 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreffer">Deployment</a> 以保证集群中运行期望的 Pod 数量。</p>
</li>
<li>
<p><strong>服务</strong>（可选）：对于部分应用（比如前端），你可能想对外暴露一个 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreffer">Service</a>，这个 Service 可能用的是集群之外的公网 IP 地址（外部 Service）。</p>
<p><strong>说明：</strong></p>
<p>对于外部服务，你可能需要开放一个或多个端口才行。</p>
<p>其它只能对集群内部可见的 Service 称为内部 Service。</p>
<p>不管哪种 Service 类型，如果你选择创建一个 Service，而且容器在一个端口上开启了监听（入向的）， 那么你需要定义两个端口。创建的 Service 会把（入向的）端口映射到容器可见的目标端口。 该 Service 会把流量路由到你部署的 Pod。支持 TCP 协议和 UDP 协议。 这个 Service 的内部 DNS 解析名就是之前你定义的应用名称的值。</p>
</li>
</ul>
<p>如果需要，你可以打开 <strong>Advanced Options</strong> 部分，这里你可以定义更多设置：</p>
<ul>
<li>
<p><strong>描述</strong>：这里你输入的文本会作为一个 <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/annotations/" target="_blank" rel="noopener noreffer">注解</a> 添加到 Deployment，并显示在应用的详细信息中。</p>
</li>
<li>
<p><strong>标签</strong>：应用默认使用的 <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noopener noreffer">标签</a> 是应用名称和版本。 你可以为 Deployment、Service（如果有）定义额外的标签，比如 release（版本）、 environment（环境）、tier（层级）、partition（分区） 和 release track（版本跟踪）。</p>
<p>例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">release=1.0
tier=frontend
environment=pod
track=stable
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>名字空间</strong>：Kubernetes 支持多个虚拟集群依附于同一个物理集群。 这些虚拟集群被称为 <a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/namespaces/" target="_blank" rel="noopener noreffer">名字空间</a>， 可以让你将资源划分为逻辑命名的组。</p>
<p>Dashboard 通过下拉菜单提供所有可用的名字空间，并允许你创建新的名字空间。 名字空间的名称最长可以包含 63 个字母或数字和中横线（-），但是不能包含大写字母。</p>
<p>名字空间的名称不能只包含数字。如果名字被设置成一个数字，比如 10，pod 就</p>
<p>在名字空间创建成功的情况下，默认会使用新创建的名字空间。如果创建失败，那么第一个名字空间会被选中。</p>
</li>
<li>
<p><strong>镜像拉取 Secret</strong>：如果要使用私有的 Docker 容器镜像，需要拉取 <a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/" target="_blank" rel="noopener noreffer">Secret</a> 凭证。</p>
<p>Dashboard 通过下拉菜单提供所有可用的 Secret，并允许你创建新的 Secret。 Secret 名称必须遵循 DNS 域名语法，比如 <code>new.image-pull.secret</code>。 Secret 的内容必须是 base64 编码的，并且在一个 <a href="https://kubernetes.io/zh-cn/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod" target="_blank" rel="noopener noreffer"><code>.dockercfg</code></a> 文件中声明。Secret 名称最大可以包含 253 个字符。</p>
<p>在镜像拉取 Secret 创建成功的情况下，默认会使用新创建的 Secret。 如果创建失败，则不会使用任何 Secret。</p>
</li>
<li>
<p><strong>CPU 需求（核数）</strong> 和 <strong>内存需求（MiB）</strong>：你可以为容器定义最小的 <a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/manage-resources/memory-default-namespace/" target="_blank" rel="noopener noreffer">资源限制</a>。 默认情况下，Pod 没有 CPU 和内存限制。</p>
</li>
<li>
<p><strong>运行命令</strong>和<strong>运行命令参数</strong>：默认情况下，你的容器会运行 Docker 镜像的默认 <a href="https://kubernetes.io/zh-cn/docs/tasks/inject-data-application/define-command-argument-container/" target="_blank" rel="noopener noreffer">入口命令</a>。 你可以使用 command 选项覆盖默认值。</p>
</li>
<li>
<p><strong>以特权模式运行</strong>：这个设置决定了在 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/#privileged-mode-for-containers" target="_blank" rel="noopener noreffer">特权容器</a> 中运行的进程是否像主机中使用 root 运行的进程一样。 特权容器可以使用诸如操纵网络堆栈和访问设备的功能。</p>
</li>
<li>
<p><strong>环境变量</strong>：Kubernetes 通过 <a href="https://kubernetes.io/zh-cn/docs/tasks/inject-data-application/environment-variable-expose-pod-information/" target="_blank" rel="noopener noreffer">环境变量</a> 暴露 Service。你可以构建环境变量，或者将环境变量的值作为参数传递给你的命令。 它们可以被应用用于查找 Service。值可以通过 <code>$(VAR_NAME)</code> 语法关联其他变量。</p>
</li>
</ul>
<h4 id="上传-yaml-或者-json-文件httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde4b88ae4bca0-yaml-e68896e88085-json-e69687e4bbb6">上传 YAML 或者 JSON 文件<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E4%B8%8A%E4%BC%A0-yaml-%E6%88%96%E8%80%85-json-%E6%96%87%E4%BB%B6" target="_blank" rel="noopener noreffer"></a></h4>
<p>Kubernetes 支持声明式配置。所有的配置都存储在清单文件 （YAML 或者 JSON 配置文件）中。这些 清单使用 Kubernetes <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/kubernetes-api/" target="_blank" rel="noopener noreffer">API</a> 定义的资源模式。</p>
<p>作为一种替代在部署向导中指定应用详情的方式，你可以在一个或多个清单文件中定义应用，并且使用 Dashboard 上传文件。</p>
<h3 id="使用-dashboardhttpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde4bdbfe794a8-dashboard">使用 Dashboard<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E4%BD%BF%E7%94%A8-dashboard" target="_blank" rel="noopener noreffer"></a></h3>
<p>以下各节描述了 Kubernetes Dashboard UI 视图；包括它们提供的内容，以及怎么使用它们。</p>
<h4 id="导航httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde5afbce888aa">导航<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E5%AF%BC%E8%88%AA" target="_blank" rel="noopener noreffer"></a></h4>
<p>当在集群中定义 Kubernetes 对象时，Dashboard 会在初始视图中显示它们。 默认情况下只会显示 <em>默认</em> 名字空间中的对象，可以通过更改导航栏菜单中的名字空间筛选器进行改变。</p>
<p>Dashboard 展示大部分 Kubernetes 对象，并将它们分组放在几个菜单类别中。</p>
<h5 id="管理概述httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde7aea1e79086e6a682e8bfb0">管理概述<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E7%AE%A1%E7%90%86%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreffer"></a></h5>
<p>集群和名字空间管理的视图，Dashboard 会列出节点、名字空间和持久卷，并且有它们的详细视图。 节点列表视图包含从所有节点聚合的 CPU 和内存使用的度量值。 详细信息视图显示了一个节点的度量值，它的规格、状态、分配的资源、事件和这个节点上运行的 Pod。</p>
<h5 id="负载httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde8b49fe8bdbd">负载<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E8%B4%9F%E8%BD%BD" target="_blank" rel="noopener noreffer"></a></h5>
<p>显示选中的名字空间中所有运行的应用。 视图按照负载类型（例如：Deployment、ReplicaSet、StatefulSet）罗列应用，并且每种负载都可以单独查看。 列表总结了关于负载的可执行信息，比如一个 ReplicaSet 的就绪状态的 Pod 数量，或者目前一个 Pod 的内存用量。</p>
<p>工作负载的详情视图展示了对象的状态、详细信息和相互关系。 例如，ReplicaSet 所控制的 Pod，或者 Deployment 所关联的新 ReplicaSet 和 HorizontalPodAutoscalers。</p>
<h5 id="服务httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde69c8de58aa1">服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E6%9C%8D%E5%8A%A1" target="_blank" rel="noopener noreffer"></a></h5>
<p>展示允许暴露给外网服务和允许集群内部发现的 Kubernetes 资源。 因此，Service 和 Ingress 视图展示他们关联的 Pod、给集群连接使用的内部端点和给外部用户使用的外部端点。</p>
<h5 id="存储httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde5ad98e582a8">存储<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E5%AD%98%E5%82%A8" target="_blank" rel="noopener noreffer"></a></h5>
<p>存储视图展示持久卷申领（PVC）资源，这些资源被应用程序用来存储数据。</p>
<h5 id="configmap-和-secrethttpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboardconfig-maps-and-secrets">ConfigMap 和 Secret<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#config-maps-and-secrets" target="_blank" rel="noopener noreffer"></a></h5>
<p>展示的所有 Kubernetes 资源是在集群中运行的应用程序的实时配置。 通过这个视图可以编辑和管理配置对象，并显示那些默认隐藏的 Secret。</p>
<h5 id="日志查看器httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde697a5e5bf97e69fa5e79c8be599a8">日志查看器<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E5%99%A8" target="_blank" rel="noopener noreffer"></a></h5>
<p>Pod 列表和详细信息页面可以链接到 Dashboard 内置的日志查看器。 查看器可以深入查看属于同一个 Pod 的不同容器的日志。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://d33wubrfki0l68.cloudfront.net/767cfea1ac5847b732e40ddd1ea13e638b679f8f/7be79/images/docs/ui-dashboard-logs-view.png"
        data-srcset="https://d33wubrfki0l68.cloudfront.net/767cfea1ac5847b732e40ddd1ea13e638b679f8f/7be79/images/docs/ui-dashboard-logs-view.png, https://d33wubrfki0l68.cloudfront.net/767cfea1ac5847b732e40ddd1ea13e638b679f8f/7be79/images/docs/ui-dashboard-logs-view.png 1.5x, https://d33wubrfki0l68.cloudfront.net/767cfea1ac5847b732e40ddd1ea13e638b679f8f/7be79/images/docs/ui-dashboard-logs-view.png 2x"
        data-sizes="auto"
        alt="https://d33wubrfki0l68.cloudfront.net/767cfea1ac5847b732e40ddd1ea13e638b679f8f/7be79/images/docs/ui-dashboard-logs-view.png"
        title="日志浏览" /></p>
<h3 id="接下来httpskubernetesiozh-cndocstasksaccess-application-clusterweb-ui-dashboarde68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/#%E6%8E%A5%E4%B8%8B%E6%9D%A5" target="_blank" rel="noopener noreffer"></a></h3>
<p>更多信息，参见 <a href="https://github.com/kubernetes/dashboard" target="_blank" rel="noopener noreffer">Kubernetes Dashboard 项目页面</a>.</p>
<h2 id="访问集群httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/" target="_blank" rel="noopener noreffer">访问集群</a></h2>
<p>本文阐述多种与集群交互的方法。</p>
<ul>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#accessing-for-the-first-time-with-kubectl" target="_blank" rel="noopener noreffer">使用 kubectl 完成集群的第一次访问</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#directly-accessing-the-rest-api" target="_blank" rel="noopener noreffer">直接访问 REST API</a>
<ul>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#using-kubectl-proxy" target="_blank" rel="noopener noreffer">使用 kubectl proxy</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#without-kubectl-proxy" target="_blank" rel="noopener noreffer">不使用 kubectl proxy</a></li>
</ul>
</li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#programmatic-access-to-the-api" target="_blank" rel="noopener noreffer">以编程方式访问 API</a>
<ul>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#go-client" target="_blank" rel="noopener noreffer">Go 客户端</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#python-client" target="_blank" rel="noopener noreffer">Python 客户端</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#other-languages" target="_blank" rel="noopener noreffer">其它语言</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#accessing-the-api-from-a-pod" target="_blank" rel="noopener noreffer">从 Pod 中访问 API</a></li>
</ul>
</li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#accessing-services-running-on-the-cluster" target="_blank" rel="noopener noreffer">访问集群上运行的服务</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#requesting-redirects" target="_blank" rel="noopener noreffer">请求重定向</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#so-many-proxies" target="_blank" rel="noopener noreffer">多种代理</a></li>
</ul>
<h3 id="使用-kubectl-完成集群的第一次访问httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusteraccessing-for-the-first-time-with-kubectl">使用 kubectl 完成集群的第一次访问<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#accessing-for-the-first-time-with-kubectl" target="_blank" rel="noopener noreffer"></a></h3>
<p>当你第一次访问 Kubernetes API 的时候，我们建议你使用 Kubernetes CLI 工具 <code>kubectl</code>。</p>
<p>访问集群时，你需要知道集群的地址并且拥有访问的凭证。通常，这些在你通过 <a href="https://kubernetes.io/zh-cn/docs/setup/" target="_blank" rel="noopener noreffer">启动安装</a>安装集群时都是自动安装好的，或者其他人安装时 也应该提供了凭证和集群地址。</p>
<p>通过以下命令检查 kubectl 是否知道集群地址及凭证：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config view
</code></pre></td></tr></table>
</div>
</div><p>有许多<a href="https://kubernetes.io/zh-cn/docs/reference/kubectl/cheatsheet/" target="_blank" rel="noopener noreffer">例子</a>介绍了如何使用 kubectl， 可以在 <a href="https://kubernetes.io/zh-cn/docs/reference/kubectl/" target="_blank" rel="noopener noreffer">kubectl 参考</a>中找到更完整的文档。</p>
<h3 id="直接访问-rest-apihttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterdirectly-accessing-the-rest-api">直接访问 REST API<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#directly-accessing-the-rest-api" target="_blank" rel="noopener noreffer"></a></h3>
<p>Kubectl 处理 apiserver 的定位和身份验证。 如果要使用 curl 或 wget 等 http 客户端或浏览器直接访问 REST API，可以通过 多种方式查找和验证：</p>
<ul>
<li>以代理模式运行 kubectl。
<ul>
<li>推荐此方式。</li>
<li>使用已存储的 apiserver 地址。</li>
<li>使用自签名的证书来验证 apiserver 的身份。杜绝 MITM 攻击。</li>
<li>对 apiserver 进行身份验证。</li>
<li>未来可能会实现智能化的客户端负载均衡和故障恢复。</li>
</ul>
</li>
<li>直接向 http 客户端提供位置和凭据。
<ul>
<li>可选的方案。</li>
<li>适用于代理可能引起混淆的某些客户端类型。</li>
<li>需要引入根证书到你的浏览器以防止 MITM 攻击。</li>
</ul>
</li>
</ul>
<h4 id="使用-kubectl-proxyhttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterusing-kubectl-proxy">使用 kubectl proxy<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#using-kubectl-proxy" target="_blank" rel="noopener noreffer"></a></h4>
<p>以下命令以反向代理的模式运行 kubectl。它处理 apiserver 的定位和验证。 像这样运行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl proxy --port<span class="o">=</span><span class="m">8080</span>
</code></pre></td></tr></table>
</div>
</div><p>参阅 <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands/#proxy" target="_blank" rel="noopener noreffer">kubectl proxy</a> 获取更多详细信息。</p>
<p>然后，你可以使用 curl、wget 或浏览器访问 API，如果是 IPv6 则用 [::1] 替换 localhost， 如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">curl http://localhost:8080/api/
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;kind&#34;</span><span class="p">:</span> <span class="s2">&#34;APIVersions&#34;</span><span class="p">,</span>
  <span class="nt">&#34;versions&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&#34;v1&#34;</span>
  <span class="p">],</span>
  <span class="nt">&#34;serverAddressByClientCIDRs&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;clientCIDR&#34;</span><span class="p">:</span> <span class="s2">&#34;0.0.0.0/0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;serverAddress&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.1.149:443&#34;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="不使用-kubectl-proxyhttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterwithout-kubectl-proxy">不使用 kubectl proxy<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#without-kubectl-proxy" target="_blank" rel="noopener noreffer"></a></h4>
<p>使用 <code>kubectl apply</code> 和 <code>kubectl describe secret ...</code> 及 grep 和剪切操作来为 default 服务帐户创建令牌，如下所示：</p>
<p>首先，创建 Secret，请求默认 ServiceAccount 的令牌：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f - <span class="s">&lt;&lt;EOF
</span><span class="s">apiVersion: v1
</span><span class="s">kind: Secret
</span><span class="s">metadata:
</span><span class="s">  name: default-token
</span><span class="s">  annotations:
</span><span class="s">    kubernetes.io/service-account.name: default
</span><span class="s">type: kubernetes.io/service-account-token
</span><span class="s">EOF</span>
</code></pre></td></tr></table>
</div>
</div><p>接下来，等待令牌控制器使用令牌填充 Secret：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="k">while</span> ! kubectl describe secret default-token <span class="p">|</span> grep -E <span class="s1">&#39;^token&#39;</span> &gt;/dev/null<span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">&#34;waiting for token...&#34;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
  sleep <span class="m">1</span>
<span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div><p>捕获并使用生成的令牌：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">APISERVER</span><span class="o">=</span><span class="k">$(</span>kubectl config view --minify <span class="p">|</span> grep server <span class="p">|</span> cut -f 2- -d <span class="s2">&#34;:&#34;</span> <span class="p">|</span> tr -d <span class="s2">&#34; &#34;</span><span class="k">)</span>
<span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>kubectl describe secret default-token <span class="p">|</span> grep -E <span class="s1">&#39;^token&#39;</span> <span class="p">|</span> cut -f2 -d<span class="s1">&#39;:&#39;</span> <span class="p">|</span> tr -d <span class="s2">&#34; &#34;</span><span class="k">)</span>
curl <span class="nv">$APISERVER</span>/api --header <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&#34;</span> --insecure
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;kind&#34;</span><span class="p">:</span> <span class="s2">&#34;APIVersions&#34;</span><span class="p">,</span>
  <span class="nt">&#34;versions&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&#34;v1&#34;</span>
  <span class="p">],</span>
  <span class="nt">&#34;serverAddressByClientCIDRs&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;clientCIDR&#34;</span><span class="p">:</span> <span class="s2">&#34;0.0.0.0/0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;serverAddress&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.1.149:443&#34;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>jsonpath</code> 方法实现：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">APISERVER</span><span class="o">=</span><span class="k">$(</span>kubectl config view --minify -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.clusters[0].cluster.server}&#39;</span><span class="k">)</span>
<span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>kubectl get secret default-token -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.token}&#39;</span> <span class="p">|</span> base64 --decode<span class="k">)</span>
curl <span class="nv">$APISERVER</span>/api --header <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&#34;</span> --insecure
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;kind&#34;</span><span class="p">:</span> <span class="s2">&#34;APIVersions&#34;</span><span class="p">,</span>
  <span class="nt">&#34;versions&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&#34;v1&#34;</span>
  <span class="p">],</span>
  <span class="nt">&#34;serverAddressByClientCIDRs&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;clientCIDR&#34;</span><span class="p">:</span> <span class="s2">&#34;0.0.0.0/0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;serverAddress&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.1.149:443&#34;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>上面的例子使用了 <code>--insecure</code> 参数，这使得它很容易受到 MITM 攻击。 当 kubectl 访问集群时，它使用存储的根证书和客户端证书来访问服务器 （它们安装在 <code>~/.kube</code> 目录中）。 由于集群证书通常是自签名的，因此可能需要特殊配置才能让你的 http 客户端使用根证书。</p>
<p>在一些集群中，apiserver 不需要身份验证；它可能只服务于 localhost，或者被防火墙保护， 这个没有一定的标准。 <a href="https://kubernetes.io/zh-cn/docs/concepts/security/controlling-access/" target="_blank" rel="noopener noreffer">配置对 API 的访问</a> 描述了集群管理员如何进行配置。此类方法可能与未来的高可用性支持相冲突。</p>
<h3 id="以编程方式访问-apihttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterprogrammatic-access-to-the-api">以编程方式访问 API<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#programmatic-access-to-the-api" target="_blank" rel="noopener noreffer"></a></h3>
<p>Kubernetes 官方提供对 <a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#go-client" target="_blank" rel="noopener noreffer">Go</a> 和 <a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#python-client" target="_blank" rel="noopener noreffer">Python</a> 的客户端库支持。</p>
<h4 id="go-客户端httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clustergo-client">Go 客户端<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#go-client" target="_blank" rel="noopener noreffer"></a></h4>
<ul>
<li>想要获得这个库，请运行命令：<code>go get k8s.io/client-go@kubernetes-&lt;kubernetes-version-number&gt;</code>， 有关详细安装说明，请参阅 <a href="https://github.com/kubernetes/client-go/blob/master/INSTALL.md#for-the-casual-user" target="_blank" rel="noopener noreffer">INSTALL.md</a>。 请参阅 <a href="https://github.com/kubernetes/client-go#compatibility-matrix" target="_blank" rel="noopener noreffer">https://github.com/kubernetes/client-go</a> 以查看支持的版本。</li>
<li>基于这个 client-go 客户端库编写应用程序。 请注意，client-go 定义了自己的 API 对象，因此如果需要，请从 client-go 而不是从主存储库 导入 API 定义，例如，<code>import &quot;k8s.io/client-go/kubernetes&quot;</code> 才是对的。</li>
</ul>
<p>Go 客户端可以像 kubectl CLI 一样使用相同的 <a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/organize-cluster-access-kubeconfig/" target="_blank" rel="noopener noreffer">kubeconfig 文件</a> 来定位和验证 apiserver。可参阅 <a href="https://git.k8s.io/client-go/examples/out-of-cluster-client-configuration/main.go" target="_blank" rel="noopener noreffer">示例</a>。</p>
<p>如果应用程序以 Pod 的形式部署在集群中，那么请参阅 <a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#accessing-the-api-from-a-pod" target="_blank" rel="noopener noreffer">下一章</a>。</p>
<h4 id="python-客户端httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterpython-client">Python 客户端<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#python-client" target="_blank" rel="noopener noreffer"></a></h4>
<p>如果想要使用 <a href="https://github.com/kubernetes-client/python" target="_blank" rel="noopener noreffer">Python 客户端</a>， 请运行命令：<code>pip install kubernetes</code>。参阅 <a href="https://github.com/kubernetes-client/python" target="_blank" rel="noopener noreffer">Python Client Library page</a> 以获得更详细的安装参数。</p>
<p>Python 客户端可以像 kubectl CLI 一样使用相同的 <a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/organize-cluster-access-kubeconfig/" target="_blank" rel="noopener noreffer">kubeconfig 文件</a> 来定位和验证 apiserver，可参阅 <a href="https://github.com/kubernetes-client/python/tree/master/examples" target="_blank" rel="noopener noreffer">示例</a>。</p>
<h4 id="其它语言httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterother-languages">其它语言<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#other-languages" target="_blank" rel="noopener noreffer"></a></h4>
<p>目前有多个<a href="https://kubernetes.io/zh-cn/docs/reference/using-api/client-libraries/" target="_blank" rel="noopener noreffer">客户端库</a> 为其它语言提供访问 API 的方法。 参阅其它库的相关文档以获取他们是如何验证的。</p>
<h4 id="从-pod-中访问-apihttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusteraccessing-the-api-from-a-pod">从 Pod 中访问 API<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#accessing-the-api-from-a-pod" target="_blank" rel="noopener noreffer"></a></h4>
<p>当你从 Pod 中访问 API 时，定位和验证 API 服务器会有些许不同。</p>
<p>请参阅<a href="https://kubernetes.io/zh-cn/docs/tasks/run-application/access-api-from-pod/" target="_blank" rel="noopener noreffer">从 Pod 中访问 API</a> 了解更多详情。</p>
<h3 id="访问集群上运行的服务httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusteraccessing-services-running-on-the-cluster">访问集群上运行的服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#accessing-services-running-on-the-cluster" target="_blank" rel="noopener noreffer"></a></h3>
<p>上一节介绍了如何连接到 Kubernetes API 服务器。 有关连接到 Kubernetes 集群上运行的其他服务的信息，请参阅 <a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/" target="_blank" rel="noopener noreffer">访问集群服务</a>。</p>
<h3 id="请求重定向httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterrequesting-redirects">请求重定向<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#requesting-redirects" target="_blank" rel="noopener noreffer"></a></h3>
<p>重定向功能已弃用并被删除。请改用代理（见下文）。</p>
<h3 id="多种代理httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-clusterso-many-proxies">多种代理<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#so-many-proxies" target="_blank" rel="noopener noreffer"></a></h3>
<p>使用 Kubernetes 时可能会遇到几种不同的代理：</p>
<ol>
<li>
<p><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster/#directly-accessing-the-rest-api" target="_blank" rel="noopener noreffer">kubectl 代理</a>：</p>
<ul>
<li>在用户的桌面或 Pod 中运行</li>
<li>代理从本地主机地址到 Kubernetes apiserver</li>
<li>客户端到代理将使用 HTTP</li>
<li>代理到 apiserver 使用 HTTPS</li>
<li>定位 apiserver</li>
<li>添加身份验证头部</li>
</ul>
</li>
<li>
<p><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#discovering-builtin-services" target="_blank" rel="noopener noreffer">apiserver 代理</a>：</p>
<ul>
<li>内置于 apiserver 中</li>
<li>将集群外部的用户连接到集群 IP，否则这些 IP 可能无法访问</li>
<li>运行在 apiserver 进程中</li>
<li>客户端代理使用 HTTPS（也可配置为 http）</li>
<li>代理将根据可用的信息决定使用 HTTP 或者 HTTPS 代理到目标</li>
<li>可用于访问节点、Pod 或服务</li>
<li>在访问服务时进行负载平衡</li>
</ul>
</li>
<li>
<p><a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/#ips-and-vips" target="_blank" rel="noopener noreffer">kube proxy</a>：</p>
<ul>
<li>运行在每个节点上</li>
<li>代理 UDP 和 TCP</li>
<li>不能代理 HTTP</li>
<li>提供负载均衡</li>
<li>只能用来访问服务</li>
</ul>
</li>
<li>
<p>位于 apiserver 之前的 Proxy/Load-balancer：</p>
<ul>
<li>存在和实现因集群而异（例如 nginx）</li>
<li>位于所有客户和一个或多个 apiserver 之间</li>
<li>如果有多个 apiserver，则充当负载均衡器</li>
</ul>
</li>
<li>
<p>外部服务上的云负载均衡器：</p>
<ul>
<li>由一些云提供商提供（例如 AWS ELB，Google Cloud Load Balancer）</li>
<li>当 Kubernetes 服务类型为 <code>LoadBalancer</code> 时自动创建</li>
<li>只使用 UDP/TCP</li>
<li>具体实现因云提供商而异。</li>
</ul>
</li>
</ol>
<p>除了前两种类型之外，Kubernetes 用户通常不需要担心任何其他问题。 集群管理员通常会确保后者的正确配置。</p>
<h2 id="配置对多集群的访问httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusters"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/" target="_blank" rel="noopener noreffer">配置对多集群的访问</a></h2>
<p>本文展示如何使用配置文件来配置对多个集群的访问。 在将集群、用户和上下文定义在一个或多个配置文件中之后，用户可以使用 <code>kubectl config use-context</code> 命令快速地在集群之间进行切换。</p>
<p><strong>说明：</strong></p>
<p>用于配置集群访问的文件有时被称为 <strong>kubeconfig 文件</strong>。 这是一种引用配置文件的通用方式，并不意味着存在一个名为 <code>kubeconfig</code> 的文件。</p>
<p><strong>警告：</strong></p>
<p>只使用来源可靠的 kubeconfig 文件。使用特制的 kubeconfig 文件可能会导致恶意代码执行或文件暴露。 如果必须使用不受信任的 kubeconfig 文件，请首先像检查 shell 脚本一样仔细检查它。</p>
<h3 id="准备开始httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterse58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B" target="_blank" rel="noopener noreffer"></a></h3>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。 建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。 如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/" target="_blank" rel="noopener noreffer">Minikube</a> 构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<ul>
<li><a href="https://killercoda.com/playgrounds/scenario/kubernetes" target="_blank" rel="noopener noreffer">Killercoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank" rel="noopener noreffer">玩转 Kubernetes</a></li>
</ul>
<p>要检查 <a href="https://kubernetes.io/docs/user-guide/kubectl-overview/" target="_blank" rel="noopener noreffer">kubectl</a> 是否安装， 执行 <code>kubectl version --client</code> 命令。kubectl 的版本应该与集群的 API 服务器<a href="https://kubernetes.io/zh-cn/releases/version-skew-policy/#kubectl" target="_blank" rel="noopener noreffer">使用同一次版本号</a>。</p>
<h3 id="定义集群用户和上下文httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clustersdefine-clusters-users-and-contexts">定义集群、用户和上下文<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#define-clusters-users-and-contexts" target="_blank" rel="noopener noreffer"></a></h3>
<p>假设用户有两个集群，一个用于开发工作（development），一个用于测试工作（test）。 在 <code>development</code> 集群中，前端开发者在名为 <code>frontend</code> 的名字空间下工作， 存储开发者在名为 <code>storage</code> 的名字空间下工作。在 <code>test</code> 集群中， 开发人员可能在默认名字空间下工作，也可能视情况创建附加的名字空间。 访问开发集群需要通过证书进行认证。 访问测试集群需要通过用户名和密码进行认证。</p>
<p>创建名为 <code>config-exercise</code> 的目录。在 <code>config-exercise</code> 目录中，创建名为 <code>config-demo</code> 的文件，其内容为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Config</span><span class="w">
</span><span class="w"></span><span class="nt">preferences</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">clusters</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">cluster</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">development</span><span class="w">
</span><span class="w"></span>- <span class="nt">cluster</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">users</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">developer</span><span class="w">
</span><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">experimenter</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">contexts</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-frontend</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-storage</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">exp-test</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>配置文件描述了集群、用户名和上下文。<code>config-demo</code> 文件中含有描述两个集群、 两个用户和三个上下文的框架。</p>
<p>进入 <code>config-exercise</code> 目录。输入以下命令，将集群详细信息添加到配置文件中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config --kubeconfig<span class="o">=</span>config-demo set-cluster development --server<span class="o">=</span>https://1.2.3.4 --certificate-authority<span class="o">=</span>fake-ca-file
kubectl config --kubeconfig<span class="o">=</span>config-demo set-cluster <span class="nb">test</span> --server<span class="o">=</span>https://5.6.7.8 --insecure-skip-tls-verify
</code></pre></td></tr></table>
</div>
</div><p>将用户详细信息添加到配置文件中：</p>
<p><strong>注意：</strong></p>
<p>将密码保存到 Kubernetes 客户端配置中有风险。 一个较好的替代方式是使用凭据插件并单独保存这些凭据。 参阅 <a href="https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/authentication/#client-go-credential-plugins" target="_blank" rel="noopener noreffer">client-go 凭据插件</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config --kubeconfig<span class="o">=</span>config-demo set-credentials developer --client-certificate<span class="o">=</span>fake-cert-file --client-key<span class="o">=</span>fake-key-seefile
kubectl config --kubeconfig<span class="o">=</span>config-demo set-credentials experimenter --username<span class="o">=</span>exp --password<span class="o">=</span>some-password
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：</strong></p>
<ul>
<li>要删除用户，可以运行 <code>kubectl --kubeconfig=config-demo config unset users.&lt;name&gt;</code></li>
<li>要删除集群，可以运行 <code>kubectl --kubeconfig=config-demo config unset clusters.&lt;name&gt;</code></li>
<li>要删除上下文，可以运行 <code>kubectl --kubeconfig=config-demo config unset contexts.&lt;name&gt;</code></li>
</ul>
<p>将上下文详细信息添加到配置文件中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config --kubeconfig<span class="o">=</span>config-demo set-context dev-frontend --cluster<span class="o">=</span>development --namespace<span class="o">=</span>frontend --user<span class="o">=</span>developer
kubectl config --kubeconfig<span class="o">=</span>config-demo set-context dev-storage --cluster<span class="o">=</span>development --namespace<span class="o">=</span>storage --user<span class="o">=</span>developer
kubectl config --kubeconfig<span class="o">=</span>config-demo set-context exp-test --cluster<span class="o">=</span><span class="nb">test</span> --namespace<span class="o">=</span>default --user<span class="o">=</span>experimenter
</code></pre></td></tr></table>
</div>
</div><p>打开 <code>config-demo</code> 文件查看添加的详细信息。也可以使用 <code>config view</code> 命令进行查看：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config --kubeconfig<span class="o">=</span>config-demo view
</code></pre></td></tr></table>
</div>
</div><p>输出展示了两个集群、两个用户和三个上下文：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">clusters</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">cluster</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">certificate-authority</span><span class="p">:</span><span class="w"> </span><span class="l">fake-ca-file</span><span class="w">
</span><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l">https://1.2.3.4</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">development</span><span class="w">
</span><span class="w"></span>- <span class="nt">cluster</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">insecure-skip-tls-verify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l">https://5.6.7.8</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test</span><span class="w">
</span><span class="w"></span><span class="nt">contexts</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">development</span><span class="w">
</span><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">frontend</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">developer</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-frontend</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">development</span><span class="w">
</span><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">storage</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">developer</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-storage</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">test</span><span class="w">
</span><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">experimenter</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">exp-test</span><span class="w">
</span><span class="w"></span><span class="nt">current-context</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Config</span><span class="w">
</span><span class="w"></span><span class="nt">preferences</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span><span class="w"></span><span class="nt">users</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">developer</span><span class="w">
</span><span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">client-certificate</span><span class="p">:</span><span class="w"> </span><span class="l">fake-cert-file</span><span class="w">
</span><span class="w">    </span><span class="nt">client-key</span><span class="p">:</span><span class="w"> </span><span class="l">fake-key-file</span><span class="w">
</span><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">experimenter</span><span class="w">
</span><span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># 文档说明（本注释不属于命令输出）。</span><span class="w">
</span><span class="w">    </span><span class="c"># 将密码保存到 Kubernetes 客户端配置有风险。</span><span class="w">
</span><span class="w">    </span><span class="c"># 一个较好的替代方式是使用凭据插件并单独保存这些凭据。</span><span class="w">
</span><span class="w">    </span><span class="c"># 参阅 https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/authentication/#client-go-credential-plugins</span><span class="w">
</span><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">some-password</span><span class="w">
</span><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">exp</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>其中的 <code>fake-ca-file</code>、<code>fake-cert-file</code> 和 <code>fake-key-file</code> 是证书文件路径名的占位符。 你需要更改这些值，使之对应你的环境中证书文件的实际路径名。</p>
<p>有时你可能希望在这里使用 BASE64 编码的数据而不是一个个独立的证书文件。 如果是这样，你需要在键名上添加 <code>-data</code> 后缀。例如， <code>certificate-authority-data</code>、<code>client-certificate-data</code> 和 <code>client-key-data</code>。</p>
<p>每个上下文包含三部分（集群、用户和名字空间），例如， <code>dev-frontend</code> 上下文表明：使用 <code>developer</code> 用户的凭证来访问 <code>development</code> 集群的 <code>frontend</code> 名字空间。</p>
<p>设置当前上下文：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config --kubeconfig<span class="o">=</span>config-demo use-context dev-frontend
</code></pre></td></tr></table>
</div>
</div><p>现在当输入 <code>kubectl</code> 命令时，相应动作会应用于 <code>dev-frontend</code> 上下文中所列的集群和名字空间， 同时，命令会使用 <code>dev-frontend</code> 上下文中所列用户的凭证。</p>
<p>使用 <code>--minify</code> 参数，来查看与当前上下文相关联的配置信息。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config --kubeconfig<span class="o">=</span>config-demo view --minify
</code></pre></td></tr></table>
</div>
</div><p>输出结果展示了 <code>dev-frontend</code> 上下文相关的配置信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">clusters</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">cluster</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">certificate-authority</span><span class="p">:</span><span class="w"> </span><span class="l">fake-ca-file</span><span class="w">
</span><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l">https://1.2.3.4</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">development</span><span class="w">
</span><span class="w"></span><span class="nt">contexts</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">development</span><span class="w">
</span><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">frontend</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">developer</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-frontend</span><span class="w">
</span><span class="w"></span><span class="nt">current-context</span><span class="p">:</span><span class="w"> </span><span class="l">dev-frontend</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Config</span><span class="w">
</span><span class="w"></span><span class="nt">preferences</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span><span class="w"></span><span class="nt">users</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">developer</span><span class="w">
</span><span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">client-certificate</span><span class="p">:</span><span class="w"> </span><span class="l">fake-cert-file</span><span class="w">
</span><span class="w">    </span><span class="nt">client-key</span><span class="p">:</span><span class="w"> </span><span class="l">fake-key-file</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>现在假设用户希望在测试集群中工作一段时间。</p>
<p>将当前上下文更改为 <code>exp-test</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config --kubeconfig<span class="o">=</span>config-demo use-context exp-test
</code></pre></td></tr></table>
</div>
</div><p>现在你发出的所有 <code>kubectl</code> 命令都将应用于 <code>test</code> 集群的默认名字空间。 同时，命令会使用 <code>exp-test</code> 上下文中所列用户的凭证。</p>
<p>查看更新后的当前上下文 <code>exp-test</code> 相关的配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config --kubeconfig<span class="o">=</span>config-demo view --minify
</code></pre></td></tr></table>
</div>
</div><p>最后，假设用户希望在 <code>development</code> 集群中的 <code>storage</code> 名字空间下工作一段时间。</p>
<p>将当前上下文更改为 <code>dev-storage</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config --kubeconfig<span class="o">=</span>config-demo use-context dev-storage
</code></pre></td></tr></table>
</div>
</div><p>查看更新后的当前上下文 <code>dev-storage</code> 相关的配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config --kubeconfig<span class="o">=</span>config-demo view --minify
</code></pre></td></tr></table>
</div>
</div><h3 id="创建第二个配置文件httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterscreate-a-second-configuration-file">创建第二个配置文件<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#create-a-second-configuration-file" target="_blank" rel="noopener noreffer"></a></h3>
<p>在 <code>config-exercise</code> 目录中，创建名为 <code>config-demo-2</code> 的文件，其中包含以下内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Config</span><span class="w">
</span><span class="w"></span><span class="nt">preferences</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">contexts</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">development</span><span class="w">
</span><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ramp</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">developer</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-ramp-up</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>上述配置文件定义了一个新的上下文，名为 <code>dev-ramp-up</code>。</p>
<h3 id="设置-kubeconfig-环境变量httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clustersset-the-kubeconfig-environment-variable">设置 KUBECONFIG 环境变量<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#set-the-kubeconfig-environment-variable" target="_blank" rel="noopener noreffer"></a></h3>
<p>查看是否有名为 <code>KUBECONFIG</code> 的环境变量。 如有，保存 <code>KUBECONFIG</code> 环境变量当前的值，以便稍后恢复。 例如：</p>
<h4 id="linuxhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterslinux">Linux<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#linux" target="_blank" rel="noopener noreffer"></a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">export</span> <span class="nv">KUBECONFIG_SAVED</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$KUBECONFIG</span><span class="s2">&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="windows-powershellhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterswindows-powershell">Windows PowerShell<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#windows-powershell" target="_blank" rel="noopener noreffer"></a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$Env:KUBECONFIG_SAVED</span><span class="p">=</span><span class="nv">$ENV:KUBECONFIG</span>
</code></pre></td></tr></table>
</div>
</div><p><code>KUBECONFIG</code> 环境变量是配置文件路径的列表，该列表在 Linux 和 Mac 中以冒号分隔， 在 Windows 中以分号分隔。 如果有 <code>KUBECONFIG</code> 环境变量，请熟悉列表中的配置文件。</p>
<p>临时添加两条路径到 <code>KUBECONFIG</code> 环境变量中。例如：</p>
<h4 id="linuxhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterslinux-1">Linux<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#linux-1" target="_blank" rel="noopener noreffer"></a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">export</span> <span class="nv">KUBECONFIG</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">KUBECONFIG</span><span class="si">}</span><span class="s2">:config-demo:config-demo-2&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="windows-powershellhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterswindows-powershell-1">Windows PowerShell<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#windows-powershell-1" target="_blank" rel="noopener noreffer"></a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$Env:KUBECONFIG</span><span class="p">=(</span><span class="s2">&#34;config-demo;config-demo-2&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>在 <code>config-exercise</code> 目录中输入以下命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config view
</code></pre></td></tr></table>
</div>
</div><p>输出展示了 <code>KUBECONFIG</code> 环境变量中所列举的所有文件合并后的信息。 特别地，注意合并信息中包含来自 <code>config-demo-2</code> 文件的 <code>dev-ramp-up</code> 上下文和来自 <code>config-demo</code> 文件的三个上下文：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">contexts</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">development</span><span class="w">
</span><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">frontend</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">developer</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-frontend</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">development</span><span class="w">
</span><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">ramp</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">developer</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-ramp-up</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">development</span><span class="w">
</span><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">storage</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">developer</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev-storage</span><span class="w">
</span><span class="w"></span>- <span class="nt">context</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l">test</span><span class="w">
</span><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">experimenter</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">exp-test</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>关于 kubeconfig 文件如何合并的更多信息， 请参考<a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/organize-cluster-access-kubeconfig/" target="_blank" rel="noopener noreffer">使用 kubeconfig 文件组织集群访问</a></p>
<h3 id="探索-homekube-目录httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clustersexplore-the-home-kube-directory">探索 $HOME/.kube 目录<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#explore-the-home-kube-directory" target="_blank" rel="noopener noreffer"></a></h3>
<p>如果用户已经拥有一个集群，可以使用 <code>kubectl</code> 与集群进行交互， 那么很可能在 <code>$HOME/.kube</code> 目录下有一个名为 <code>config</code> 的文件。</p>
<p>进入 <code>$HOME/.kube</code> 目录，看看那里有什么文件。通常会有一个名为 <code>config</code> 的文件，目录中可能还有其他配置文件。请简单地熟悉这些文件的内容。</p>
<h3 id="将-homekubeconfig-追加到-kubeconfig-环境变量中httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clustersappend-home-kube-config-to-your-kubeconfig-environment-variable">将 $HOME/.kube/config 追加到 KUBECONFIG 环境变量中<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#append-home-kube-config-to-your-kubeconfig-environment-variable" target="_blank" rel="noopener noreffer"></a></h3>
<p>如果有 <code>$HOME/.kube/config</code> 文件，并且还未列在 <code>KUBECONFIG</code> 环境变量中， 那么现在将它追加到 <code>KUBECONFIG</code> 环境变量中。例如：</p>
<h4 id="linuxhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterslinux-2">Linux<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#linux-2" target="_blank" rel="noopener noreffer"></a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">export</span> <span class="nv">KUBECONFIG</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">KUBECONFIG</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/.kube/config&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="windows-powershellhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterswindows-powershell-2">Windows Powershell<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#windows-powershell-2" target="_blank" rel="noopener noreffer"></a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$Env:KUBECONFIG</span><span class="p">=</span><span class="s2">&#34;$Env:KUBECONFIG;$HOME\.kube\config&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>在配置练习目录中输入以下命令，查看当前 <code>KUBECONFIG</code> 环境变量中列举的所有文件合并后的配置信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl config view
</code></pre></td></tr></table>
</div>
</div><h3 id="清理httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clustersclean-up">清理<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#clean-up" target="_blank" rel="noopener noreffer"></a></h3>
<p>将 <code>KUBECONFIG</code> 环境变量还原为原始值。例如：</p>
<h4 id="linuxhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterslinux-3">Linux<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#linux-3" target="_blank" rel="noopener noreffer"></a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">export</span> <span class="nv">KUBECONFIG</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$KUBECONFIG_SAVED</span><span class="s2">&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="windows-powershellhttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterswindows-powershell-3">Windows PowerShell<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#windows-powershell-3" target="_blank" rel="noopener noreffer"></a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$Env:KUBECONFIG</span><span class="p">=</span><span class="nv">$ENV:KUBECONFIG_SAVED</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="检查-kubeconfig-所表示的主体httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterscheck-the-subject">检查 kubeconfig 所表示的主体<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#check-the-subject" target="_blank" rel="noopener noreffer"></a></h3>
<p>你在通过集群的身份验证后将获得哪些属性（用户名、组），这一点并不总是很明显。 如果你同时管理多个集群，这可能会更具挑战性。</p>
<p>对于你所选择的 Kubernetes 客户端上下文，有一个 <code>kubectl</code> Alpha 子命令可以检查用户名等主体属性： <code>kubectl alpha auth whoami</code>。</p>
<p>更多细节请参阅<a href="https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/authentication/#self-subject-review" target="_blank" rel="noopener noreffer">通过 API 访问客户端的身份验证信息</a>。</p>
<h3 id="接下来httpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-access-multiple-clusterse68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#%E6%8E%A5%E4%B8%8B%E6%9D%A5" target="_blank" rel="noopener noreffer"></a></h3>
<ul>
<li><a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/organize-cluster-access-kubeconfig/" target="_blank" rel="noopener noreffer">使用 kubeconfig 文件组织集群访问</a></li>
<li><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#config" target="_blank" rel="noopener noreffer">kubectl config</a></li>
</ul>
<h2 id="使用端口转发来访问集群中的应用httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-cluster"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/" target="_blank" rel="noopener noreffer">使用端口转发来访问集群中的应用</a></h2>
<p>本文展示如何使用 <code>kubectl port-forward</code> 连接到在 Kubernetes 集群中运行的 MongoDB 服务。 这种类型的连接对数据库调试很有用。</p>
<h3 id="准备开始httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clustere58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B" target="_blank" rel="noopener noreffer"></a></h3>
<ul>
<li>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。 建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。 如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/" target="_blank" rel="noopener noreffer">Minikube</a> 构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<ul>
<li><a href="https://killercoda.com/playgrounds/scenario/kubernetes" target="_blank" rel="noopener noreffer">Killercoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank" rel="noopener noreffer">玩转 Kubernetes</a></li>
</ul>
<p>你的 Kubernetes 服务器版本必须不低于版本 v1.10. 要获知版本信息，请输入 <code>kubectl version</code>.</p>
</li>
<li>
<p>安装 <a href="https://www.mongodb.com/try/download/shell" target="_blank" rel="noopener noreffer">MongoDB Shell</a>。</p>
</li>
</ul>
<h3 id="创建-mongodb-deployment-和服务httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clustere5889be5bbba-mongodb-deployment-e5928ce69c8de58aa1">创建 MongoDB Deployment 和服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#%E5%88%9B%E5%BB%BA-mongodb-deployment-%E5%92%8C%E6%9C%8D%E5%8A%A1" target="_blank" rel="noopener noreffer"></a></h3>
<ol>
<li>
<p>创建一个运行 MongoDB 的 Deployment：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/application/mongodb/mongo-deployment.yaml
</code></pre></td></tr></table>
</div>
</div><p>成功执行的命令的输出可以证明创建了 Deployment：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">deployment.apps/mongo created
</code></pre></td></tr></table>
</div>
</div><p>查看 Pod 状态，检查其是否准备就绪：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods
</code></pre></td></tr></table>
</div>
</div><p>输出显示创建的 Pod：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME                     READY   STATUS    RESTARTS   AGE
mongo-75f59d57f4-4nd6q   1/1     Running   0          2m4s
</code></pre></td></tr></table>
</div>
</div><p>查看 Deployment 状态：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get deployment
</code></pre></td></tr></table>
</div>
</div><p>输出显示创建的 Deployment：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME    READY   UP-TO-DATE   AVAILABLE   AGE
mongo   1/1     1            1           2m21s
</code></pre></td></tr></table>
</div>
</div><p>该 Deployment 自动管理一个 ReplicaSet。查看该 ReplicaSet 的状态：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get replicaset
</code></pre></td></tr></table>
</div>
</div><p>输出显示 ReplicaSet 已被创建：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME               DESIRED   CURRENT   READY   AGE
mongo-75f59d57f4   1         1         1       3m12s
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>创建一个在网络上公开的 MongoDB 服务：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/application/mongodb/mongo-service.yaml
</code></pre></td></tr></table>
</div>
</div><p>成功执行的命令的输出可以证明 Service 已经被创建：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">service/mongo created
</code></pre></td></tr></table>
</div>
</div><p>检查所创建的 Service：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get service mongo
</code></pre></td></tr></table>
</div>
</div><p>输出显示已被创建的 Service：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)     AGE
mongo   ClusterIP   10.96.41.183   &lt;none&gt;        27017/TCP   11s
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>验证 MongoDB 服务是否运行在 Pod 中并且在监听 27017 端口：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 将 mongo-75f59d57f4-4nd6q 改为 Pod 的名称</span>
kubectl get pod mongo-75f59d57f4-4nd6q --template<span class="o">=</span><span class="s1">&#39;{{(index (index .spec.containers 0).ports 0).containerPort}}{{&#34;\n&#34;}}&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>输出应该显示对应 Pod 中 MongoDB 的端口：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">27017
</code></pre></td></tr></table>
</div>
</div><p>27017 是分配给 MongoDB 的互联网 TCP 端口。</p>
</li>
</ol>
<h3 id="转发一个本地端口到-pod-端口httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clustere8bdace58f91e4b880e4b8aae69cace59cb0e7abafe58fa3e588b0-pod-e7abafe58fa3">转发一个本地端口到 Pod 端口<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#%E8%BD%AC%E5%8F%91%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E7%AB%AF%E5%8F%A3%E5%88%B0-pod-%E7%AB%AF%E5%8F%A3" target="_blank" rel="noopener noreffer"></a></h3>
<ol>
<li>
<p><code>kubectl port-forward</code> 允许使用资源名称 （例如 Pod 名称）来选择匹配的 Pod 来进行端口转发。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 将 mongo-75f59d57f4-4nd6q 改为 Pod 的名称</span>
kubectl port-forward mongo-75f59d57f4-4nd6q 28015:27017
</code></pre></td></tr></table>
</div>
</div><p>这相当于</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl port-forward pods/mongo-75f59d57f4-4nd6q 28015:27017
</code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl port-forward deployment/mongo 28015:27017
</code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl port-forward replicaset/mongo-75f59d57f4 28015:27017
</code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl port-forward service/mongo 28015:27017
</code></pre></td></tr></table>
</div>
</div><p>以上所有命令都有效。输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Forwarding from 127.0.0.1:28015 -&gt; 27017
Forwarding from [::1]:28015 -&gt; 27017
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：</strong></p>
<p><code>kubectl port-forward</code> 不会返回。你需要打开另一个终端来继续这个练习。</p>
</li>
<li>
<p>启动 MongoDB 命令行接口：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">mongosh --port <span class="m">28015</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在 MongoDB 命令行提示符下，输入 <code>ping</code> 命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">db.runCommand( { ping: 1 } )
</code></pre></td></tr></table>
</div>
</div><p>成功的 ping 请求应该返回：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">{ ok: 1 }
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h4 id="可选操作让-_kubectl_-来选择本地端口httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clusterlet-kubectl-choose-local-port">（可选操作）让 <em>kubectl</em> 来选择本地端口<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#let-kubectl-choose-local-port" target="_blank" rel="noopener noreffer"></a></h4>
<p>如果你不需要指定特定的本地端口，你可以让 <code>kubectl</code> 来选择和分配本地端口， 这样你就不需要管理本地端口冲突。该命令使用稍微不同的语法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl port-forward deployment/mongo :27017
</code></pre></td></tr></table>
</div>
</div><p><code>kubectl</code> 工具会找到一个未被使用的本地端口号（避免使用低段位的端口号， 因为他们可能会被其他应用程序使用）。输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Forwarding from 127.0.0.1:63753 -&gt; 27017
Forwarding from [::1]:63753 -&gt; 27017
</code></pre></td></tr></table>
</div>
</div><h3 id="讨论httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clusterdiscussion">讨论<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#discussion" target="_blank" rel="noopener noreffer"></a></h3>
<p>与本地 28015 端口建立的连接将被转发到运行 MongoDB 服务器的 Pod 的 27017 端口。 通过此连接，你可以使用本地工作站来调试在 Pod 中运行的数据库。</p>
<p><strong>说明：</strong></p>
<p><code>kubectl port-forward</code> 仅实现了 TCP 端口 支持。 在 <a href="https://github.com/kubernetes/kubernetes/issues/47862" target="_blank" rel="noopener noreffer">issue 47862</a> 中跟踪了对 UDP 协议的支持。</p>
<h3 id="接下来httpskubernetesiozh-cndocstasksaccess-application-clusterport-forward-access-application-clustere68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/port-forward-access-application-cluster/#%E6%8E%A5%E4%B8%8B%E6%9D%A5" target="_blank" rel="noopener noreffer"></a></h3>
<p>进一步了解 <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands/#port-forward" target="_blank" rel="noopener noreffer">kubectl port-forward</a>。</p>
<h2 id="使用服务来访问集群中的应用httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-cluster"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/" target="_blank" rel="noopener noreffer">使用服务来访问集群中的应用</a></h2>
<p>本文展示如何创建一个 Kubernetes 服务对象，能让外部客户端访问在集群中运行的应用。 该服务为一个应用的两个运行实例提供负载均衡。</p>
<h3 id="准备开始httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clustere58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B" target="_blank" rel="noopener noreffer"></a></h3>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。 建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。 如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/" target="_blank" rel="noopener noreffer">Minikube</a> 构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<ul>
<li><a href="https://killercoda.com/playgrounds/scenario/kubernetes" target="_blank" rel="noopener noreffer">Killercoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank" rel="noopener noreffer">玩转 Kubernetes</a></li>
</ul>
<h3 id="教程目标httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clustere69599e7a88be79baee6a087">教程目标<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#%E6%95%99%E7%A8%8B%E7%9B%AE%E6%A0%87" target="_blank" rel="noopener noreffer"></a></h3>
<ul>
<li>运行 Hello World 应用的两个实例。</li>
<li>创建一个服务对象来暴露 NodePort。</li>
<li>使用服务对象来访问正在运行的应用。</li>
</ul>
<h3 id="为运行在两个-pod-中的应用创建一个服务httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clustercreating-a-service-for-an-app-running-in-two-pods">为运行在两个 Pod 中的应用创建一个服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#creating-a-service-for-an-app-running-in-two-pods" target="_blank" rel="noopener noreffer"></a></h3>
<p>这是应用程序部署的配置文件：</p>
<p><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/service/access/hello-application.yaml" target="_blank" rel="noopener noreffer"><code>service/access/hello-application.yaml</code></a> <figure><a class="lightgallery" href="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" title="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-thumbnail="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-sub-html="<h2>Copy service/access/hello-application.yaml to clipboard</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg"
            data-srcset="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 1.5x, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 2x"
            data-sizes="auto"
            alt="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" />
    </a><figcaption class="image-caption">Copy service/access/hello-application.yaml to clipboard</figcaption>
    </figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello-world</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">load-balancer-example</span><span class="w">
</span><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">load-balancer-example</span><span class="w">
</span><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello-world</span><span class="w">
</span><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">gcr.io/google-samples/node-hello:1.0</span><span class="w">
</span><span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">              </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>在你的集群中运行一个 Hello World 应用。 使用上面的文件创建应用程序 Deployment：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/service/access/hello-application.yaml
</code></pre></td></tr></table>
</div>
</div><p>上面的命令创建一个 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreffer">Deployment</a> 对象 和一个关联的 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/replicaset/" target="_blank" rel="noopener noreffer">ReplicaSet</a> 对象。 这个 ReplicaSet 有两个 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/" target="_blank" rel="noopener noreffer">Pod</a>， 每个 Pod 都运行着 Hello World 应用。</p>
</li>
<li>
<p>展示 Deployment 的信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get deployments hello-world
kubectl describe deployments hello-world
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>展示你的 ReplicaSet 对象信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get replicasets
kubectl describe replicasets
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>创建一个服务对象来暴露 Deployment：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl expose deployment hello-world --type<span class="o">=</span>NodePort --name<span class="o">=</span>example-service
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>展示 Service 信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl describe services example-service
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Name:                   example-service
Namespace:              default
Labels:                 run=load-balancer-example
Annotations:            &lt;none&gt;
Selector:               run=load-balancer-example
Type:                   NodePort
IP:                     10.32.0.16
Port:                   &lt;unset&gt; 8080/TCP
TargetPort:             8080/TCP
NodePort:               &lt;unset&gt; 31496/TCP
Endpoints:              10.200.1.4:8080,10.200.2.5:8080
Session Affinity:       None
Events:                 &lt;none&gt;
</code></pre></td></tr></table>
</div>
</div><p>注意服务中的 NodePort 值。例如在上面的输出中，NodePort 值是 31496。</p>
</li>
<li>
<p>列出运行 Hello World 应用的 Pod：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods --selector<span class="o">=</span><span class="s2">&#34;run=load-balancer-example&#34;</span> --output<span class="o">=</span>wide
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME                           READY   STATUS    ...  IP           NODE
hello-world-2895499144-bsbk5   1/1     Running   ...  10.200.1.4   worker1
hello-world-2895499144-m1pwt   1/1     Running   ...  10.200.2.5   worker2
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>获取运行 Hello World 的 pod 的其中一个节点的公共 IP 地址。如何获得此地址取决于你设置集群的方式。 例如，如果你使用的是 Minikube，则可以通过运行 <code>kubectl cluster-info</code> 来查看节点地址。 如果你使用的是 Google Compute Engine 实例， 则可以使用 <code>gcloud compute instances list</code> 命令查看节点的公共地址。</p>
</li>
<li>
<p>在你选择的节点上，创建一个防火墙规则以开放节点端口上的 TCP 流量。 例如，如果你的服务的 NodePort 值为 31568，请创建一个防火墙规则以允许 31568 端口上的 TCP 流量。 不同的云提供商提供了不同方法来配置防火墙规则。</p>
</li>
<li>
<p>使用节点地址和 node port 来访问 Hello World 应用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">curl http://&lt;public-node-ip&gt;:&lt;node-port&gt;
</code></pre></td></tr></table>
</div>
</div><p>这里的 <code>&lt;public-node-ip&gt;</code> 是你节点的公共 IP 地址，<code>&lt;node-port&gt;</code> 是你服务的 NodePort 值。 对于请求成功的响应是一个 hello 消息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Hello Kubernetes!
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="使用服务配置文件httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clusterusing-a-service-configuration-file">使用服务配置文件<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#using-a-service-configuration-file" target="_blank" rel="noopener noreffer"></a></h3>
<p>作为 <code>kubectl expose</code> 的替代方法， 你可以使用<a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreffer">服务配置文件</a>来创建服务。</p>
<h3 id="清理现场httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clustere6b885e79086e78eb0e59cba">清理现场<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#%E6%B8%85%E7%90%86%E7%8E%B0%E5%9C%BA" target="_blank" rel="noopener noreffer"></a></h3>
<p>想要删除服务，输入以下命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl delete services example-service
</code></pre></td></tr></table>
</div>
</div><p>想要删除运行 Hello World 应用的 Deployment、ReplicaSet 和 Pod，输入以下命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl delete deployment hello-world
</code></pre></td></tr></table>
</div>
</div><h3 id="接下来httpskubernetesiozh-cndocstasksaccess-application-clusterservice-access-application-clustere68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/service-access-application-cluster/#%E6%8E%A5%E4%B8%8B%E6%9D%A5" target="_blank" rel="noopener noreffer"></a></h3>
<p>跟随教程<a href="https://kubernetes.io/zh-cn/docs/tutorials/services/connect-applications-service/" target="_blank" rel="noopener noreffer">使用 Service 连接到应用</a>。</p>
<h2 id="使用-service-把前端连接到后端httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backend"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/" target="_blank" rel="noopener noreffer">使用 Service 把前端连接到后端</a></h2>
<p>本任务会描述如何创建前端（Frontend）微服务和后端（Backend）微服务。后端微服务是一个 hello 欢迎程序。 前端通过 nginx 和一个 Kubernetes <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreffer">服务</a> 暴露后端所提供的服务。</p>
<h3 id="教程目标httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende69599e7a88be79baee6a087">教程目标<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E6%95%99%E7%A8%8B%E7%9B%AE%E6%A0%87" target="_blank" rel="noopener noreffer"></a></h3>
<ul>
<li>使用部署对象（Deployment object）创建并运行一个 <code>hello</code> 后端微服务</li>
<li>使用一个 Service 对象将请求流量发送到后端微服务的多个副本</li>
<li>同样使用一个 Deployment 对象创建并运行一个 <code>nginx</code> 前端微服务</li>
<li>配置前端微服务将请求流量发送到后端微服务</li>
<li>使用 <code>type=LoadBalancer</code> 的 Service 对象将前端微服务暴露到集群外部</li>
</ul>
<h3 id="准备开始httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B" target="_blank" rel="noopener noreffer"></a></h3>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。 建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。 如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/" target="_blank" rel="noopener noreffer">Minikube</a> 构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<ul>
<li><a href="https://killercoda.com/playgrounds/scenario/kubernetes" target="_blank" rel="noopener noreffer">Killercoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank" rel="noopener noreffer">玩转 Kubernetes</a></li>
</ul>
<p>要获知版本信息，请输入 <code>kubectl version</code>.</p>
<p>本任务使用<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/" target="_blank" rel="noopener noreffer">外部负载均衡服务</a>， 所以需要对应的可支持此功能的环境。如果你的环境不能支持，你可以使用 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/#type-nodeport" target="_blank" rel="noopener noreffer">NodePort</a> 类型的服务代替。</p>
<h4 id="使用部署对象deployment创建后端httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende4bdbfe794a8e983a8e7bdb2e5afb9e8b1a1-deployment-e5889be5bbbae5908ee7abaf">使用部署对象（Deployment）创建后端<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E4%BD%BF%E7%94%A8%E9%83%A8%E7%BD%B2%E5%AF%B9%E8%B1%A1-deployment-%E5%88%9B%E5%BB%BA%E5%90%8E%E7%AB%AF" target="_blank" rel="noopener noreffer"></a></h4>
<p>后端是一个简单的 hello 欢迎微服务应用。这是后端应用的 Deployment 配置文件：</p>
<p><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/service/access/backend-deployment.yaml" target="_blank" rel="noopener noreffer"><code>service/access/backend-deployment.yaml</code></a> <figure><a class="lightgallery" href="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" title="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-thumbnail="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-sub-html="<h2>Copy service/access/backend-deployment.yaml to clipboard</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg"
            data-srcset="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 1.5x, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 2x"
            data-sizes="auto"
            alt="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" />
    </a><figcaption class="image-caption">Copy service/access/backend-deployment.yaml to clipboard</figcaption>
    </figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">backend</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span><span class="w">      </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">backend</span><span class="w">
</span><span class="w">      </span><span class="nt">track</span><span class="p">:</span><span class="w"> </span><span class="l">stable</span><span class="w">
</span><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span><span class="w">        </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">backend</span><span class="w">
</span><span class="w">        </span><span class="nt">track</span><span class="p">:</span><span class="w"> </span><span class="l">stable</span><span class="w">
</span><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;gcr.io/google-samples/hello-go-gke:1.0&#34;</span><span class="w">
</span><span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span><span class="w">              </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w"></span><span class="nn">...</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>创建后端 Deployment：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/service/access/backend-deployment.yaml
</code></pre></td></tr></table>
</div>
</div><p>查看后端的 Deployment 信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl describe deployment backend
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Name:                           backend
Namespace:                      default
CreationTimestamp:              Mon, 24 Oct 2016 14:21:02 -0700
Labels:                         app=hello
                                tier=backend
                                track=stable
Annotations:                    deployment.kubernetes.io/revision=1
Selector:                       app=hello,tier=backend,track=stable
Replicas:                       3 desired | 3 updated | 3 total | 3 available | 0 unavailable
StrategyType:                   RollingUpdate
MinReadySeconds:                0
RollingUpdateStrategy:          1 max unavailable, 1 max surge
Pod Template:
  Labels:       app=hello
                tier=backend
                track=stable
  Containers:
   hello:
    Image:              &#34;gcr.io/google-samples/hello-go-gke:1.0&#34;
    Port:               80/TCP
    Environment:        &lt;none&gt;
    Mounts:             &lt;none&gt;
  Volumes:              &lt;none&gt;
Conditions:
  Type          Status  Reason
  ----          ------  ------
  Available     True    MinimumReplicasAvailable
  Progressing   True    NewReplicaSetAvailable
OldReplicaSets:                 &lt;none&gt;
NewReplicaSet:                  hello-3621623197 (3/3 replicas created)
Events:
...
</code></pre></td></tr></table>
</div>
</div><h4 id="创建-hello-service-对象httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende5889be5bbba-hello-service-e5afb9e8b1a1">创建 <code>hello</code> Service 对象<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E5%88%9B%E5%BB%BA-hello-service-%E5%AF%B9%E8%B1%A1" target="_blank" rel="noopener noreffer"></a></h4>
<p>将请求从前端发送到后端的关键是后端 Service。Service 创建一个固定 IP 和 DNS 解析名入口， 使得后端微服务总是可达。Service 使用 <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noopener noreffer">选择算符</a> 来寻找目标 Pod。</p>
<p>首先，浏览 Service 的配置文件：</p>
<p><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/service/access/backend-service.yaml" target="_blank" rel="noopener noreffer"><code>service/access/backend-service.yaml</code></a> <figure><a class="lightgallery" href="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" title="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-thumbnail="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-sub-html="<h2>Copy service/access/backend-service.yaml to clipboard</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg"
            data-srcset="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 1.5x, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 2x"
            data-sizes="auto"
            alt="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" />
    </a><figcaption class="image-caption">Copy service/access/backend-service.yaml to clipboard</figcaption>
    </figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span><span class="w">    </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">backend</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span><span class="w"></span><span class="nn">...</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>配置文件中，你可以看到名为 <code>hello</code> 的 Service 将流量路由到包含 <code>app: hello</code> 和 <code>tier: backend</code> 标签的 Pod。</p>
<p>创建后端 Service：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/service/access/backend-service.yaml
</code></pre></td></tr></table>
</div>
</div><p>此时，你已经有了一个运行着 <code>hello</code> 应用的三个副本的 <code>backend</code> Deployment，你也有了 一个 Service 用于路由网络流量。不过，这个服务在集群外部无法访问也无法解析。</p>
<h4 id="创建前端应用httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende5889be5bbbae5898de7abafe5ba94e794a8">创建前端应用<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E5%88%9B%E5%BB%BA%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8" target="_blank" rel="noopener noreffer"></a></h4>
<p>现在你已经有了运行中的后端应用，你可以创建一个可在集群外部访问的前端，并通过代理 前端的请求连接到后端。</p>
<p>前端使用被赋予后端 Service 的 DNS 名称将请求发送到后端工作 Pods。这一 DNS 名称为 <code>hello</code>，也就是 <code>examples/service/access/backend-service.yaml</code> 配置 文件中 <code>name</code> 字段的取值。</p>
<p>前端 Deployment 中的 Pods 运行一个 nginx 镜像，这个已经配置好的镜像会将请求转发 给后端的 <code>hello</code> Service。下面是 nginx 的配置文件：</p>
<p><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/service/access/frontend-nginx.conf" target="_blank" rel="noopener noreffer"><code>service/access/frontend-nginx.conf</code></a> <figure><a class="lightgallery" href="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" title="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-thumbnail="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-sub-html="<h2>Copy service/access/frontend-nginx.conf to clipboard</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg"
            data-srcset="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 1.5x, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 2x"
            data-sizes="auto"
            alt="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" />
    </a><figcaption class="image-caption">Copy service/access/frontend-nginx.conf to clipboard</figcaption>
    </figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"># Backend 是 nginx 的内部标识符，用于命名以下特定的 upstream
upstream Backend {
    # hello 是 Kubernetes 中的后端服务所使用的内部 DNS 名称
    server hello;
}

server {
    listen 80;

    location / {
        # 以下语句将流量通过代理方式转发到名为 Backend 的上游
        proxy_pass http://Backend;
    }
}
</code></pre></td></tr></table>
</div>
</div><p>与后端类似，前端用包含一个 Deployment 和一个 Service。后端与前端服务之间的一个 重要区别是前端 Service 的配置文件包含了 <code>type: LoadBalancer</code>，也就是说，Service 会使用你的云服务商的默认负载均衡设备，从而实现从集群外访问的目的。</p>
<p><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/service/access/frontend-service.yaml" target="_blank" rel="noopener noreffer"><code>service/access/frontend-service.yaml</code></a> <figure><a class="lightgallery" href="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" title="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-thumbnail="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-sub-html="<h2>Copy service/access/frontend-service.yaml to clipboard</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg"
            data-srcset="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 1.5x, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 2x"
            data-sizes="auto"
            alt="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" />
    </a><figcaption class="image-caption">Copy service/access/frontend-service.yaml to clipboard</figcaption>
    </figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">frontend</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span><span class="w">    </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">frontend</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;TCP&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">LoadBalancer</span><span class="w">
</span><span class="w"></span><span class="nn">...</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/service/access/frontend-deployment.yaml" target="_blank" rel="noopener noreffer"><code>service/access/frontend-deployment.yaml</code></a> <figure><a class="lightgallery" href="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" title="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-thumbnail="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-sub-html="<h2>Copy service/access/frontend-deployment.yaml to clipboard</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg"
            data-srcset="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 1.5x, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 2x"
            data-sizes="auto"
            alt="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" />
    </a><figcaption class="image-caption">Copy service/access/frontend-deployment.yaml to clipboard</figcaption>
    </figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">frontend</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span><span class="w">      </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">frontend</span><span class="w">
</span><span class="w">      </span><span class="nt">track</span><span class="p">:</span><span class="w"> </span><span class="l">stable</span><span class="w">
</span><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span><span class="w">        </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">frontend</span><span class="w">
</span><span class="w">        </span><span class="nt">track</span><span class="p">:</span><span class="w"> </span><span class="l">stable</span><span class="w">
</span><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;gcr.io/google-samples/hello-frontend:1.0&#34;</span><span class="w">
</span><span class="w">          </span><span class="nt">lifecycle</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">preStop</span><span class="p">:</span><span class="w">
</span><span class="w">              </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span><span class="w">                </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/usr/sbin/nginx&#34;</span><span class="p">,</span><span class="s2">&#34;-s&#34;</span><span class="p">,</span><span class="s2">&#34;quit&#34;</span><span class="p">]</span><span class="w">
</span><span class="w"></span><span class="nn">...</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>创建前端 Deployment 和 Service：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/service/access/frontend-deployment.yaml
kubectl apply -f https://k8s.io/examples/service/access/frontend-service.yaml
</code></pre></td></tr></table>
</div>
</div><p>通过输出确认两个资源都已经被创建：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">deployment.apps/frontend created
service/frontend created
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：</strong></p>
<p>这个 nginx 配置文件是被打包在 <a href="https://kubernetes.io/examples/service/access/Dockerfile" target="_blank" rel="noopener noreffer">容器镜像</a> 里的。 更好的方法是使用 <a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-pod-configmap/" target="_blank" rel="noopener noreffer">ConfigMap</a>， 这样的话你可以更轻易地更改配置。</p>
<h4 id="与前端-service-交互httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backendinteract-with-the-frontend-service">与前端 Service 交互<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#interact-with-the-frontend-service" target="_blank" rel="noopener noreffer"></a></h4>
<p>一旦你创建了 LoadBalancer 类型的 Service，你可以使用这条命令查看外部 IP：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get service frontend --watch
</code></pre></td></tr></table>
</div>
</div><p>外部 IP 字段的生成可能需要一些时间。如果是这种情况，外部 IP 会显示为 <code>&lt;pending&gt;</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME       TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)  AGE
frontend   LoadBalancer   10.51.252.116   &lt;pending&gt;     80/TCP   10s
</code></pre></td></tr></table>
</div>
</div><p>当外部 IP 地址被分配可用时，配置会更新，在 <code>EXTERNAL-IP</code> 头部下显示新的 IP：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME       TYPE           CLUSTER-IP      EXTERNAL-IP        PORT(S)  AGE
frontend   LoadBalancer   10.51.252.116   XXX.XXX.XXX.XXX    80/TCP   1m
</code></pre></td></tr></table>
</div>
</div><p>这一新的 IP 地址就可以用来从集群外与 <code>frontend</code> 服务交互了。</p>
<h4 id="通过前端发送流量httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende9809ae8bf87e5898de7abafe58f91e98081e6b581e9878f">通过前端发送流量<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E9%80%9A%E8%BF%87%E5%89%8D%E7%AB%AF%E5%8F%91%E9%80%81%E6%B5%81%E9%87%8F" target="_blank" rel="noopener noreffer"></a></h4>
<p>前端和后端已经完成连接了。你可以使用 curl 命令通过你的前端 Service 的外部 IP 访问服务端点。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">curl http://<span class="si">${</span><span class="nv">EXTERNAL_IP</span><span class="si">}</span> <span class="c1"># 将 EXTERNAL_P 替换为你之前看到的外部 IP</span>
</code></pre></td></tr></table>
</div>
</div><p>输出显示后端生成的消息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="nt">&#34;message&#34;</span><span class="p">:</span><span class="s2">&#34;Hello&#34;</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="清理现场httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende6b885e79086e78eb0e59cba">清理现场<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E6%B8%85%E7%90%86%E7%8E%B0%E5%9C%BA" target="_blank" rel="noopener noreffer"></a></h3>
<p>要删除服务，输入下面的命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl delete services frontend backend
</code></pre></td></tr></table>
</div>
</div><p>要删除在前端和后端应用中运行的 Deployment、ReplicaSet 和 Pod，输入下面的命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl delete deployment frontend backend
</code></pre></td></tr></table>
</div>
</div><h3 id="接下来httpskubernetesiozh-cndocstasksaccess-application-clusterconnecting-frontend-backende68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/connecting-frontend-backend/#%E6%8E%A5%E4%B8%8B%E6%9D%A5" target="_blank" rel="noopener noreffer"></a></h3>
<ul>
<li>进一步了解 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreffer">Service</a></li>
<li>进一步了解 <a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-pod-configmap/" target="_blank" rel="noopener noreffer">ConfigMap</a></li>
<li>进一步了解 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/dns-pod-service/" target="_blank" rel="noopener noreffer">Service 和 Pods 的 DNS</a></li>
</ul>
<h2 id="创建外部负载均衡器httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancer"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/" target="_blank" rel="noopener noreffer">创建外部负载均衡器</a></h2>
<p>本文展示如何创建一个外部负载均衡器。</p>
<p>创建<a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreffer">服务</a>时，你可以选择自动创建云网络负载均衡器。 负载均衡器提供外部可访问的 IP 地址，可将流量发送到集群节点上的正确端口上 （<strong>假设集群在支持的环境中运行，并配置了正确的云负载均衡器驱动包</strong>）。</p>
<p>你还可以使用 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener noreffer">Ingress</a> 代替 Service。 更多信息，请参阅 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener noreffer">Ingress</a> 文档。</p>
<h3 id="准备开始httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancere58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B" target="_blank" rel="noopener noreffer"></a></h3>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。 建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。 如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/" target="_blank" rel="noopener noreffer">Minikube</a> 构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<ul>
<li><a href="https://killercoda.com/playgrounds/scenario/kubernetes" target="_blank" rel="noopener noreffer">Killercoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank" rel="noopener noreffer">玩转 Kubernetes</a></li>
</ul>
<p>你的集群必须在已经支持配置外部负载均衡器的云或其他环境中运行。</p>
<h3 id="创建服务httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancercreate-a-service">创建服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#create-a-service" target="_blank" rel="noopener noreffer"></a></h3>
<h4 id="基于清单文件创建服务httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancercreate-a-service-from-a-manifest">基于清单文件创建服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#create-a-service-from-a-manifest" target="_blank" rel="noopener noreffer"></a></h4>
<p>要创建外部负载均衡器，请将以下内容添加到你的 Service 清单文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">LoadBalancer</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>你的清单文件可能会如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-service</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">example</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8765</span><span class="w">
</span><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">9376</span><span class="w">
</span><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">LoadBalancer</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="使用-kubectl-创建-servicehttpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancercreate-a-service-using-kubectl">使用 kubectl 创建 Service<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#create-a-service-using-kubectl" target="_blank" rel="noopener noreffer"></a></h4>
<p>你也可以使用 <code>kubectl expose</code> 命令及其 <code>--type=LoadBalancer</code> 参数创建服务：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">kubectl expose deployment example --port<span class="o">=</span><span class="m">8765</span> --target-port<span class="o">=</span><span class="m">9376</span> <span class="se">\
</span><span class="se"></span>        --name<span class="o">=</span>example-service --type<span class="o">=</span>LoadBalancer
</code></pre></td></tr></table>
</div>
</div><p>此命令通过使用与引用资源（在上面的示例的情况下，名为 <code>example</code> 的 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreffer">Deployment</a>） 相同的选择器来创建一个新的服务。</p>
<p>更多信息（包括更多的可选参数），请参阅 <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands/#expose" target="_blank" rel="noopener noreffer"><code>kubectl expose</code> 指南</a>。</p>
<h3 id="找到你的-ip-地址httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancerfinding-your-ip-address">找到你的 IP 地址<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#finding-your-ip-address" target="_blank" rel="noopener noreffer"></a></h3>
<p>你可以通过 <code>kubectl</code> 获取服务信息，找到为你的服务创建的 IP 地址：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">kubectl describe services example-service
</code></pre></td></tr></table>
</div>
</div><p>这将获得类似如下输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Name:                     example-service
Namespace:                default
Labels:                   app=example
Annotations:              &lt;none&gt;
Selector:                 app=example
Type:                     LoadBalancer
IP Families:              &lt;none&gt;
IP:                       10.3.22.96
IPs:                      10.3.22.96
LoadBalancer Ingress:     192.0.2.89
Port:                     &lt;unset&gt;  8765/TCP
TargetPort:               9376/TCP
NodePort:                 &lt;unset&gt;  30593/TCP
Endpoints:                172.17.0.3:9376
Session Affinity:         None
External Traffic Policy:  Cluster
Events:                   &lt;none&gt;
</code></pre></td></tr></table>
</div>
</div><p>负载均衡器的 IP 地址列在 <code>LoadBalancer Ingress</code> 旁边。</p>
<p><strong>说明：</strong></p>
<p>如果你在 Minikube 上运行服务，你可以通过以下命令找到分配的 IP 地址和端口：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">minikube service example-service --url
</code></pre></td></tr></table>
</div>
</div><h3 id="保留客户端源-iphttpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancerpreserving-the-client-source-ip">保留客户端源 IP<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#preserving-the-client-source-ip" target="_blank" rel="noopener noreffer"></a></h3>
<p>默认情况下，目标容器中看到的源 IP 将<strong>不是客户端的原始源 IP</strong>。 要启用保留客户端 IP，可以在服务的 <code>.spec</code> 中配置以下字段：</p>
<ul>
<li>
<p><code>.spec.externalTrafficPolicy</code> - 表示此 Service 是否希望将外部流量路由到节点本地或集群范围的端点。 有两个可用选项：<code>Cluster</code>（默认）和 <code>Local</code>。 <code>Cluster</code> 隐藏了客户端源 IP，可能导致第二跳到另一个节点，但具有良好的整体负载分布。 <code>Local</code> 保留客户端源 IP 并避免 LoadBalancer 和 NodePort 类型服务的第二跳， 但存在潜在的不均衡流量传播风险。</p>
</li>
<li>
<p><code>.spec.healthCheckNodePort</code> - 指定服务的 healthcheck nodePort（数字端口号）。 如果你未指定 <code>healthCheckNodePort</code>，服务控制器从集群的 NodePort 范围内分配一个端口。 你可以通过设置 API 服务器的命令行选项 <code>--service-node-port-range</code> 来配置上述范围。 在服务 <code>type</code> 设置为 LoadBalancer 并且 <code>externalTrafficPolicy</code> 设置为 <code>Local</code> 时， Service 将会使用用户指定的 <code>healthCheckNodePort</code> 值（如果你指定了它）。</p>
</li>
</ul>
<p>可以通过在服务的清单文件中将 <code>externalTrafficPolicy</code> 设置为 Local 来激活此功能。比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-service</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">example</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8765</span><span class="w">
</span><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">9376</span><span class="w">
</span><span class="w">  </span><span class="nt">externalTrafficPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Local</span><span class="w">
</span><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">LoadBalancer</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="保留源-ip-时的注意事项和限制httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancercaveats-and-limitations-when-preserving-source-ips">保留源 IP 时的注意事项和限制<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#caveats-and-limitations-when-preserving-source-ips" target="_blank" rel="noopener noreffer"></a></h4>
<p>一些云服务供应商的负载均衡服务不允许你为每个目标配置不同的权重。</p>
<p>由于每个目标在向节点发送流量方面的权重相同，因此外部流量不会在不同 Pod 之间平均负载。 外部负载均衡器不知道每个节点上用作目标的 Pod 数量。</p>
<p>在 <code>NumServicePods &lt;&lt; _NumNodes</code> 或 <code>NumServicePods &gt;&gt; NumNodes</code> 时， 即使没有权重，也会看到接近相等的分布。</p>
<p>内部 Pod 到 Pod 的流量应该与 ClusterIP 服务类似，所有 Pod 的概率相同。</p>
<h3 id="回收负载均衡器httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancergarbage-collecting-load-balancers">回收负载均衡器<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#garbage-collecting-load-balancers" target="_blank" rel="noopener noreffer"></a></h3>
<p><strong>特性状态：</strong> <code>Kubernetes v1.17 [stable]</code></p>
<p>在通常情况下，应在删除 LoadBalancer 类型 Service 后立即清除云服务供应商中的相关负载均衡器资源。 但是，众所周知，在删除关联的服务后，云资源被孤立的情况很多。 引入了针对服务负载均衡器的终结器保护，以防止这种情况发生。 通过使用终结器，在删除相关的负载均衡器资源之前，也不会删除服务资源。</p>
<p>具体来说，如果服务具有 <code>type</code> LoadBalancer，则服务控制器将附加一个名为 <code>service.kubernetes.io/load-balancer-cleanup</code> 的终结器。 仅在清除负载均衡器资源后才能删除终结器。 即使在诸如服务控制器崩溃之类的极端情况下，这也可以防止负载均衡器资源悬空。</p>
<h3 id="外部负载均衡器供应商httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancerexternal-load-balancer-providers">外部负载均衡器供应商<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#external-load-balancer-providers" target="_blank" rel="noopener noreffer"></a></h3>
<p>请务必注意，此功能的数据路径由 Kubernetes 集群外部的负载均衡器提供。</p>
<p>当服务 <code>type</code> 设置为 LoadBalancer 时，Kubernetes 向集群中的 Pod 提供的功能等同于 <code>type</code> 设置为 ClusterIP，并通过使用托管了相关 Kubernetes Pod 的节点作为条目对负载均衡器 （从外部到 Kubernetes）进行编程来扩展它。 Kubernetes 控制平面自动创建外部负载均衡器、健康检查（如果需要）和包过滤规则（如果需要）。 一旦云服务供应商为负载均衡器分配了 IP 地址，控制平面就会查找该外部 IP 地址并将其填充到 Service 对象中。</p>
<h3 id="接下来httpskubernetesiozh-cndocstasksaccess-application-clustercreate-external-load-balancere68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/create-external-load-balancer/#%E6%8E%A5%E4%B8%8B%E6%9D%A5" target="_blank" rel="noopener noreffer"></a></h3>
<ul>
<li>遵循教程<a href="https://kubernetes.io/zh-cn/docs/tutorials/services/connect-applications-service/" target="_blank" rel="noopener noreffer">使用 Service 连接到应用</a></li>
<li>阅读<a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreffer">服务</a></li>
<li>阅读 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener noreffer">Ingress</a></li>
</ul>
<h2 id="列出集群中所有运行容器的镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-images"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/" target="_blank" rel="noopener noreffer">列出集群中所有运行容器的镜像</a></h2>
<p>本文展示如何使用 kubectl 来列出集群中所有运行 Pod 的容器的镜像</p>
<h3 id="准备开始httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B" target="_blank" rel="noopener noreffer"></a></h3>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。 建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。 如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/" target="_blank" rel="noopener noreffer">Minikube</a> 构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<ul>
<li><a href="https://killercoda.com/playgrounds/scenario/kubernetes" target="_blank" rel="noopener noreffer">Killercoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank" rel="noopener noreffer">玩转 Kubernetes</a></li>
</ul>
<p>要获知版本信息，请输入 <code>kubectl version</code>.</p>
<p>在本练习中，你将使用 kubectl 来获取集群中运行的所有 Pod，并格式化输出来提取每个 Pod 中的容器列表。</p>
<h3 id="列出所有命名空间下的所有容器镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese58897e587bae68980e69c89e591bde5908de7a9bae997b4e4b88be79a84e68980e69c89e5aeb9e599a8e9959ce5838f">列出所有命名空间下的所有容器镜像<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F" target="_blank" rel="noopener noreffer"></a></h3>
<ul>
<li>使用 <code>kubectl get pods --all-namespaces</code> 获取所有命名空间下的所有 Pod</li>
<li>使用 <code>-o jsonpath={.items[*].spec.containers[*].image}</code> 来格式化输出，以仅包含容器镜像名称。 这将以递归方式从返回的 json 中解析出 <code>image</code> 字段。
<ul>
<li>参阅 <a href="https://kubernetes.io/zh-cn/docs/reference/kubectl/jsonpath/" target="_blank" rel="noopener noreffer">jsonpath 说明</a> 获取更多关于如何使用 jsonpath 的信息。</li>
</ul>
</li>
<li>使用标准化工具来格式化输出：<code>tr</code>, <code>sort</code>, <code>uniq</code>
<ul>
<li>使用 <code>tr</code> 以用换行符替换空格</li>
<li>使用 <code>sort</code> 来对结果进行排序</li>
<li>使用 <code>uniq</code> 来聚合镜像计数</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods --all-namespaces -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.items[*].spec.containers[*].image}&#34;</span> <span class="p">|</span><span class="se">\
</span><span class="se"></span>tr -s <span class="s1">&#39;[[:space:]]&#39;</span> <span class="s1">&#39;\n&#39;</span> <span class="p">|</span><span class="se">\
</span><span class="se"></span>sort <span class="p">|</span><span class="se">\
</span><span class="se"></span>uniq -c
</code></pre></td></tr></table>
</div>
</div><p>jsonpath 解释如下：</p>
<ul>
<li><code>.items[*]</code>: 对于每个返回的值</li>
<li><code>.spec</code>: 获取 spec</li>
<li><code>.containers[*]</code>: 对于每个容器</li>
<li><code>.image</code>: 获取镜像</li>
</ul>
<p><strong>说明：</strong> 按名字获取单个 Pod 时，例如 <code>kubectl get pod nginx</code>，路径的 <code>.items[*]</code> 部分应该省略， 因为返回的是一个 Pod 而不是一个项目列表。</p>
<h3 id="按-pod-列出容器镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese68c89-pod-e58897e587bae5aeb9e599a8e9959ce5838f">按 Pod 列出容器镜像<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E6%8C%89-pod-%E5%88%97%E5%87%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F" target="_blank" rel="noopener noreffer"></a></h3>
<p>可以使用 <code>range</code> 操作进一步控制格式化，以单独操作每个元素。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods --all-namespaces -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{range .items[*]}{&#34;\n&#34;}{.metadata.name}{&#34;:\t&#34;}{range .spec.containers[*]}{.image}{&#34;, &#34;}{end}{end}&#39;</span> <span class="p">|</span><span class="se">\
</span><span class="se"></span>sort
</code></pre></td></tr></table>
</div>
</div><h3 id="列出以标签过滤后的-pod-的所有容器镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese58897e587bae4bba5e6a087e7adbee8bf87e6bba4e5908ee79a84-pod-e79a84e68980e69c89e5aeb9e599a8e9959ce5838f">列出以标签过滤后的 Pod 的所有容器镜像<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E5%88%97%E5%87%BA%E4%BB%A5%E6%A0%87%E7%AD%BE%E8%BF%87%E6%BB%A4%E5%90%8E%E7%9A%84-pod-%E7%9A%84%E6%89%80%E6%9C%89%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F" target="_blank" rel="noopener noreffer"></a></h3>
<p>要获取匹配特定标签的 Pod，请使用 -l 参数。以下匹配仅与标签 <code>app=nginx</code> 相符的 Pod。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods --all-namespaces -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.items[*].spec.containers[*].image}&#34;</span> -l <span class="nv">app</span><span class="o">=</span>nginx
</code></pre></td></tr></table>
</div>
</div><h3 id="列出以命名空间过滤后的-pod-的所有容器镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese58897e587bae4bba5e591bde5908de7a9bae997b4e8bf87e6bba4e5908ee79a84-pod-e79a84e68980e69c89e5aeb9e599a8e9959ce5838f">列出以命名空间过滤后的 Pod 的所有容器镜像<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E5%88%97%E5%87%BA%E4%BB%A5%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E8%BF%87%E6%BB%A4%E5%90%8E%E7%9A%84-pod-%E7%9A%84%E6%89%80%E6%9C%89%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F" target="_blank" rel="noopener noreffer"></a></h3>
<p>要获取匹配特定命名空间的 Pod，请使用 namespace 参数。以下仅匹配 <code>kube-system</code> 命名空间下的 Pod。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods --namespace kube-system -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;{.items[*].spec.containers[*].image}&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="使用-go-template-代替-jsonpath-来获取容器镜像httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese4bdbfe794a8-go-template-e4bba3e69bbf-jsonpath-e69da5e88eb7e58f96e5aeb9e599a8e9959ce5838f">使用 go-template 代替 jsonpath 来获取容器镜像<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E4%BD%BF%E7%94%A8-go-template-%E4%BB%A3%E6%9B%BF-jsonpath-%E6%9D%A5%E8%8E%B7%E5%8F%96%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F" target="_blank" rel="noopener noreffer"></a></h3>
<p>作为 jsonpath 的替代，Kubectl 支持使用 <a href="https://golang.org/pkg/text/template/" target="_blank" rel="noopener noreffer">go-templates</a> 来格式化输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods --all-namespaces -o go-template --template<span class="o">=</span><span class="s2">&#34;{{range .items}}{{range .spec.containers}}{{.image}} {{end}}{{end}}&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="接下来httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E6%8E%A5%E4%B8%8B%E6%9D%A5" target="_blank" rel="noopener noreffer"></a></h3>
<h4 id="参考httpskubernetesiozh-cndocstasksaccess-application-clusterlist-all-running-container-imagese58f82e88083">参考<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/list-all-running-container-images/#%E5%8F%82%E8%80%83" target="_blank" rel="noopener noreffer"></a></h4>
<ul>
<li><a href="https://kubernetes.io/zh-cn/docs/reference/kubectl/jsonpath/" target="_blank" rel="noopener noreffer">Jsonpath</a> 参考指南</li>
<li><a href="https://golang.org/pkg/text/template/" target="_blank" rel="noopener noreffer">Go template</a> 参考指南</li>
</ul>
<h2 id="在-minikube-环境中使用-nginx-ingress-控制器配置-ingresshttpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikube"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/" target="_blank" rel="noopener noreffer">在 Minikube 环境中使用 NGINX Ingress 控制器配置 Ingress</a></h2>
<p><a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener noreffer">Ingress</a>是一种 API 对象， 其中定义了一些规则使得集群中的服务可以从集群外访问。 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/" target="_blank" rel="noopener noreffer">Ingress 控制器</a>负责满足 Ingress 中所设置的规则。</p>
<p>本节为你展示如何配置一个简单的 Ingress，根据 HTTP URI 将服务请求路由到服务 <code>web</code> 或 <code>web2</code>。</p>
<h3 id="准备开始httpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubee58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B" target="_blank" rel="noopener noreffer"></a></h3>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。 建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。 如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/" target="_blank" rel="noopener noreffer">Minikube</a> 构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<ul>
<li><a href="https://killercoda.com/playgrounds/scenario/kubernetes" target="_blank" rel="noopener noreffer">Killercoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank" rel="noopener noreffer">玩转 Kubernetes</a></li>
</ul>
<p>你的 Kubernetes 服务器版本必须不低于版本 1.19. 要获知版本信息，请输入 <code>kubectl version</code>.</p>
<p>如果你使用的是较早的 Kubernetes 版本，请切换到该版本的文档。</p>
<h4 id="创建一个-minikube-集群httpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubecreate-minikube-cluster">创建一个 Minikube 集群<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#create-minikube-cluster" target="_blank" rel="noopener noreffer"></a></h4>
<p>使用 Katacoda</p>
<p>Launch Terminal</p>
<p>本地</p>
<p>如果已经在本地<a href="https://kubernetes.io/zh-cn/docs/tasks/tools/#minikube" target="_blank" rel="noopener noreffer">安装 Minikube</a>， 请运行 <code>minikube start</code> 创建一个集群。</p>
<h3 id="启用-ingress-控制器httpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubee590afe794a8-ingress-e68ea7e588b6e599a8">启用 Ingress 控制器<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E5%90%AF%E7%94%A8-ingress-%E6%8E%A7%E5%88%B6%E5%99%A8" target="_blank" rel="noopener noreffer"></a></h3>
<ol>
<li>
<p>为了启用 NGINIX Ingress 控制器，可以运行下面的命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">minikube addons <span class="nb">enable</span> ingress
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>检查验证 NGINX Ingress 控制器处于运行状态：</p>
<ul>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#tab-with-md-0" target="_blank" rel="noopener noreffer">minikube v1.19 或更高版本</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#tab-with-md-1" target="_blank" rel="noopener noreffer">minikube v1.18.1 或更早版本</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods -n ingress-nginx
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：</strong></p>
<p>最多可能需要等待一分钟才能看到这些 Pod 运行正常。</p>
<p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME                                        READY   STATUS      RESTARTS    AGE
ingress-nginx-admission-create-g9g49        0/1     Completed   0          11m
ingress-nginx-admission-patch-rqp78         0/1     Completed   1          11m
ingress-nginx-controller-59b45fb494-26npt   1/1     Running     0          11m
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods -n kube-system
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：</strong></p>
<p>最多可能需要等待一分钟才能看到这些 Pod 运行正常。</p>
<p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME                                        READY     STATUS    RESTARTS   AGE
default-http-backend-59868b7dd6-xb8tq       1/1       Running   0          1m
kube-addon-manager-minikube                 1/1       Running   0          3m
kube-dns-6dcb57bcc8-n4xd4                   3/3       Running   0          2m
kubernetes-dashboard-5498ccf677-b8p5h       1/1       Running   0          2m
nginx-ingress-controller-5984b97644-rnkrg   1/1       Running   0          1m
storage-provisioner                         1/1       Running   0          2m
</code></pre></td></tr></table>
</div>
</div><p>请确保可以在输出中看到一个名称以 <code>nginx-ingress-controller-</code> 为前缀的 Pod。</p>
</li>
</ol>
<h3 id="部署一个-hello-world-应用httpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubedeploy-hello-world">部署一个 Hello World 应用<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#deploy-hello-world" target="_blank" rel="noopener noreffer"></a></h3>
<ol>
<li>
<p>使用下面的命令创建一个 Deployment：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl create deployment web --image<span class="o">=</span>gcr.io/google-samples/hello-app:1.0
</code></pre></td></tr></table>
</div>
</div><p>输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">deployment.apps/web created
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>将 Deployment 暴露出来：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl expose deployment web --type<span class="o">=</span>NodePort --port<span class="o">=</span><span class="m">8080</span>
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">service/web exposed
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>验证 Service 已经创建，并且可以从节点端口访问：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get service web
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME      TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
web       NodePort   10.104.133.249   &lt;none&gt;        8080:31637/TCP   12m
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>使用节点端口信息访问服务：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">minikube service web --url
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">http://172.17.0.15:31637
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：</strong></p>
<p>如果使用的是 Katacoda 环境，在终端面板顶端，请点击加号标志。 然后点击 <strong>Select port to view on Host 1</strong>。 输入节点和端口号（这里是<code>31637</code>），之后点击 <strong>Display Port</strong>。</p>
<p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Hello, world!
Version: 1.0.0
Hostname: web-55b8c6998d-8k564
</code></pre></td></tr></table>
</div>
</div><p>你现在应该可以通过 Minikube 的 IP 地址和节点端口来访问示例应用了。 下一步是让自己能够通过 Ingress 资源来访问应用。</p>
</li>
</ol>
<h3 id="创建一个-ingresshttpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubee5889be5bbbae4b880e4b8aa-ingress">创建一个 Ingress<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-ingress" target="_blank" rel="noopener noreffer"></a></h3>
<p>下面是一个定义 Ingress 的配置文件，负责通过 <code>hello-world.info</code> 将请求转发到你的服务。</p>
<ol>
<li>
<p>根据下面的 YAML 创建文件 <code>example-ingress.yaml</code>：</p>
<p><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/service/networking/example-ingress.yaml" target="_blank" rel="noopener noreffer"><code>service/networking/example-ingress.yaml</code></a> <figure><a class="lightgallery" href="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" title="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-thumbnail="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-sub-html="<h2>Copy service/networking/example-ingress.yaml to clipboard</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg"
            data-srcset="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 1.5x, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 2x"
            data-sizes="auto"
            alt="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" />
    </a><figcaption class="image-caption">Copy service/networking/example-ingress.yaml to clipboard</figcaption>
    </figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1</span><span class="w">
</span><span class="w">   </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span><span class="w">   </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">     </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-ingress</span><span class="w">
</span><span class="w">     </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span><span class="w">       </span><span class="nt">nginx.ingress.kubernetes.io/rewrite-target</span><span class="p">:</span><span class="w"> </span><span class="l">/$1</span><span class="w">
</span><span class="w">   </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">     </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">hello-world.info</span><span class="w">
</span><span class="w">         </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span><span class="w">           </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span><span class="w">             </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span><span class="w">               </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span><span class="w">               </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span><span class="w">                 </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span><span class="w">                   </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span><span class="w">                   </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span><span class="w">                     </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>通过运行下面的命令创建 Ingress 对象：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/service/networking/example-ingress.yaml
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">ingress.networking.k8s.io/example-ingress created
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>验证 IP 地址已被设置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get ingress
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：</strong></p>
<p>此操作可能需要几分钟时间。</p>
<p>接下来你将会在 <code>ADDRESS</code> 列中看到 IPv4 地址，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">NAME              CLASS    HOSTS              ADDRESS        PORTS   AGE
example-ingress   &lt;none&gt;   hello-world.info   172.17.0.15    80      38s
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>在 <code>/etc/hosts</code> 文件的末尾添加以下内容（需要管理员访问权限）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">172.17.0.15 hello-world.info
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：</strong></p>
<p>如果你在本地运行 Minikube 环境，需要使用 <code>minikube ip</code> 获得外部 IP 地址。 Ingress 列表中显示的 IP 地址会是内部 IP 地址。</p>
<p>添加完成后，在浏览器中访问 URL <code>hello-world.info</code>，请求将被发送到 Minikube。</p>
</li>
<li>
<p>验证 Ingress 控制器能够转发请求流量：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">curl hello-world.info
</code></pre></td></tr></table>
</div>
</div><p>你应该看到类似输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Hello, world!
Version: 1.0.0
Hostname: web-55b8c6998d-8k564
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：</strong></p>
<p>如果你在使用本地 Minikube 环境，你可以从浏览器中访问 hello-world.info。</p>
</li>
</ol>
<h3 id="创建第二个-deploymenthttpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubecreate-second-deployment">创建第二个 Deployment<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#create-second-deployment" target="_blank" rel="noopener noreffer"></a></h3>
<ol>
<li>
<p>使用下面的命令创建第二个 Deployment：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl create deployment web2 --image<span class="o">=</span>gcr.io/google-samples/hello-app:2.0
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">deployment.apps/web2 created
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>将第二个 Deployment 暴露出来：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl expose deployment web2 --port<span class="o">=</span><span class="m">8080</span> --type<span class="o">=</span>NodePort
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">service/web2 exposed
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="编辑现有的-ingresshttpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubeedit-ingress">编辑现有的 Ingress<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#edit-ingress" target="_blank" rel="noopener noreffer"></a></h3>
<ol>
<li>
<p>编辑现有的 <code>example-ingress.yaml</code>，在文件最后添加以下行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml">- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/v2</span><span class="w">
</span><span class="w">  </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l">Prefix</span><span class="w">
</span><span class="w">  </span><span class="nt">backend</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web2</span><span class="w">
</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>应用变更：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f example-ingress.yaml
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">ingress.networking/example-ingress configured
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="测试你的-ingresshttpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubetest-ingress">测试你的 Ingress<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#test-ingress" target="_blank" rel="noopener noreffer"></a></h3>
<ol>
<li>
<p>访问 Hello World 应用的第一个版本：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">curl hello-world.info
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Hello, world!
Version: 1.0.0
Hostname: web-55b8c6998d-8k564
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>访问 Hello World 应用的第二个版本：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">curl hello-world.info/v2
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Hello, world!
Version: 2.0.0
Hostname: web2-75cd47646f-t8cjk
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：</strong></p>
<p>如果你在本地运行 Minikube 环境，你可以使用浏览器来访问 <code>hello-world.info</code> 和 <code>hello-world.info/v2</code>。</p>
</li>
</ol>
<h3 id="接下来httpskubernetesiozh-cndocstasksaccess-application-clusteringress-minikubee68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E6%8E%A5%E4%B8%8B%E6%9D%A5" target="_blank" rel="noopener noreffer"></a></h3>
<ul>
<li>进一步了解 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener noreffer">Ingress</a></li>
<li>进一步了解 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/" target="_blank" rel="noopener noreffer">Ingress 控制器</a></li>
<li>进一步了解 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreffer">服务</a></li>
</ul>
<h2 id="同-pod-内的容器使用共享卷通信httpskubernetesiozh-cndocstasksaccess-application-clustercommunicate-containers-same-pod-shared-volume"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/" target="_blank" rel="noopener noreffer">同 Pod 内的容器使用共享卷通信</a></h2>
<p>本文旨在说明如何让一个 Pod 内的两个容器使用一个卷（Volume）进行通信。 参阅如何让两个进程跨容器通过 <a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/share-process-namespace/" target="_blank" rel="noopener noreffer">共享进程名字空间</a>。</p>
<h3 id="准备开始httpskubernetesiozh-cndocstasksaccess-application-clustercommunicate-containers-same-pod-shared-volumee58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B" target="_blank" rel="noopener noreffer"></a></h3>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。 建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。 如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/" target="_blank" rel="noopener noreffer">Minikube</a> 构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<ul>
<li><a href="https://killercoda.com/playgrounds/scenario/kubernetes" target="_blank" rel="noopener noreffer">Killercoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank" rel="noopener noreffer">玩转 Kubernetes</a></li>
</ul>
<p>要获知版本信息，请输入 <code>kubectl version</code>.</p>
<h3 id="创建一个包含两个容器的-podhttpskubernetesiozh-cndocstasksaccess-application-clustercommunicate-containers-same-pod-shared-volumee5889be5bbbae4b880e4b8aae58c85e590abe4b8a4e4b8aae5aeb9e599a8e79a84-pod">创建一个包含两个容器的 Pod<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB%E4%B8%A4%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%9A%84-pod" target="_blank" rel="noopener noreffer"></a></h3>
<p>在这个练习中，你会创建一个包含两个容器的 Pod。两个容器共享一个卷用于他们之间的通信。 Pod 的配置文件如下：</p>
<p><a href="https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/pods/two-container-pod.yaml" target="_blank" rel="noopener noreffer"><code>pods/two-container-pod.yaml</code></a> <figure><a class="lightgallery" href="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" title="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-thumbnail="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" data-sub-html="<h2>Copy pods/two-container-pod.yaml to clipboard</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg"
            data-srcset="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 1.5x, https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg 2x"
            data-sizes="auto"
            alt="https://d33wubrfki0l68.cloudfront.net/0901162ab78eb4ff2e9e5dc8b17c3824befc91a6/44ccd/images/copycode.svg" />
    </a><figcaption class="image-caption">Copy pods/two-container-pod.yaml to clipboard</figcaption>
    </figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">two-containers</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Never</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shared-data</span><span class="w">
</span><span class="w">    </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-container</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shared-data</span><span class="w">
</span><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w">
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">debian-container</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">debian</span><span class="w">
</span><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shared-data</span><span class="w">
</span><span class="w">      </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/pod-data</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;-c&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;echo Hello from the debian container &gt; /pod-data/index.html&#34;</span><span class="p">]</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>在配置文件中，你可以看到 Pod 有一个共享卷，名为 <code>shared-data</code>。</p>
<p>配置文件中的第一个容器运行了一个 nginx 服务器。共享卷的挂载路径是 <code>/usr/share/nginx/html</code>。 第二个容器是基于 debian 镜像的，有一个 <code>/pod-data</code> 的挂载路径。第二个容器运行了下面的命令然后终止。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">echo</span> Hello from the debian container &gt; /pod-data/index.html
</code></pre></td></tr></table>
</div>
</div><p>注意，第二个容器在 nginx 服务器的根目录下写了 <code>index.html</code> 文件。</p>
<p>创建一个包含两个容器的 Pod：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl apply -f https://k8s.io/examples/pods/two-container-pod.yaml
</code></pre></td></tr></table>
</div>
</div><p>查看 Pod 和容器的信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl get pod two-containers --output<span class="o">=</span>yaml
</code></pre></td></tr></table>
</div>
</div><p>这是输出的一部分：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="l">...</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">two-containers</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span><span class="w">  </span><span class="l">...</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="l">...</span><span class="w">
</span><span class="w">  </span><span class="nt">containerStatuses</span><span class="p">:</span><span class="w">
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">containerID</span><span class="p">:</span><span class="w"> </span><span class="l">docker://c1d8abd1 ...</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">debian</span><span class="w">
</span><span class="w">    </span><span class="l">...</span><span class="w">
</span><span class="w">    </span><span class="nt">lastState</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">terminated</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="l">...</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">debian-container</span><span class="w">
</span><span class="w">    </span><span class="l">...</span><span class="w">
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">containerID</span><span class="p">:</span><span class="w"> </span><span class="l">docker://96c1ff2c5bb ...</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span><span class="w">    </span><span class="l">...</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-container</span><span class="w">
</span><span class="w">    </span><span class="l">...</span><span class="w">
</span><span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">running</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="l">...</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>你可以看到 debian 容器已经被终止了，而 nginx 服务器依然在运行。</p>
<p>进入 nginx 容器的 shell：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl <span class="nb">exec</span> -it two-containers -c nginx-container -- /bin/bash
</code></pre></td></tr></table>
</div>
</div><p>在 shell 中，确认 nginx 还在运行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">root@two-containers:/# apt-get update
root@two-containers:/# apt-get install curl procps
root@two-containers:/# ps aux
</code></pre></td></tr></table>
</div>
</div><p>输出类似于这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">USER       PID  ...  STAT START   TIME COMMAND
root         1  ...  Ss   21:12   0:00 nginx: master process nginx -g daemon off;
</code></pre></td></tr></table>
</div>
</div><p>回忆一下，debian 容器在 nginx 的根目录下创建了 <code>index.html</code> 文件。 使用 <code>curl</code> 向 nginx 服务器发送一个 GET 请求：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">root@two-containers:/# curl localhost
</code></pre></td></tr></table>
</div>
</div><p>输出表示 nginx 向外提供了 debian 容器所写就的页面：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Hello from the debian container
</code></pre></td></tr></table>
</div>
</div><h3 id="讨论httpskubernetesiozh-cndocstasksaccess-application-clustercommunicate-containers-same-pod-shared-volumee8aea8e8aeba">讨论<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/#%E8%AE%A8%E8%AE%BA" target="_blank" rel="noopener noreffer"></a></h3>
<p>Pod 能有多个容器的主要原因是为了支持辅助应用（helper applications），以协助主应用（primary application）。 辅助应用的典型例子是数据抽取，数据推送和代理。辅助应用和主应用经常需要相互通信。 就如这个练习所示，通信通常是通过共享文件系统完成的，或者，也通过回环网络接口 localhost 完成。 举个网络接口的例子，web 服务器带有一个协助程序用于拉取 Git 仓库的更新。</p>
<p>在本练习中的卷为 Pod 生命周期中的容器相互通信提供了一种方法。如果 Pod 被删除或者重建了， 任何共享卷中的数据都会丢失。</p>
<h3 id="接下来httpskubernetesiozh-cndocstasksaccess-application-clustercommunicate-containers-same-pod-shared-volumee68ea5e4b88be69da5">接下来<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/#%E6%8E%A5%E4%B8%8B%E6%9D%A5" target="_blank" rel="noopener noreffer"></a></h3>
<ul>
<li>进一步了解<a href="https://kubernetes.io/blog/2015/06/the-distributed-system-toolkit-patterns/" target="_blank" rel="noopener noreffer">复合容器的模式</a></li>
<li>学习<a href="https://www.slideshare.net/Docker/slideshare-burns" target="_blank" rel="noopener noreffer">模块化架构中的复合容器</a></li>
<li>参见<a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-volume-storage/" target="_blank" rel="noopener noreffer">配置 Pod 使用卷来存储数据</a></li>
<li>参考<a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/share-process-namespace/" target="_blank" rel="noopener noreffer">在 Pod 中的容器之间共享进程命名空间</a></li>
<li>参考 <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#volume-v1-core" target="_blank" rel="noopener noreffer">Volume</a></li>
<li>参考 <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#pod-v1-core" target="_blank" rel="noopener noreffer">Pod</a></li>
</ul>
<h2 id="为集群配置-dnshttpskubernetesiozh-cndocstasksaccess-application-clusterconfigure-dns-cluster"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-dns-cluster/" target="_blank" rel="noopener noreffer">为集群配置 DNS</a></h2>
<p>Kubernetes 提供 DNS 集群插件，大多数支持的环境默认情况下都会启用。 在 Kubernetes 1.11 及其以后版本中，推荐使用 CoreDNS， kubeadm 默认会安装 CoreDNS。</p>
<p>要了解关于如何为 Kubernetes 集群配置 CoreDNS 的更多信息，参阅 <a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/dns-custom-nameservers/" target="_blank" rel="noopener noreffer">定制 DNS 服务</a>。 关于如何利用 kube-dns 配置 kubernetes DNS 的演示例子，参阅 <a href="https://github.com/kubernetes/examples/tree/master/staging/cluster-dns" target="_blank" rel="noopener noreffer">Kubernetes DNS 插件示例</a>。</p>
<h2 id="访问集群上运行的服务httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-services"><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/" target="_blank" rel="noopener noreffer">访问集群上运行的服务</a></h2>
<p>本文展示了如何连接 Kubernetes 集群上运行的服务。</p>
<h3 id="准备开始httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicese58786e5a487e5bc80e5a78b">准备开始<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#%E5%87%86%E5%A4%87%E5%BC%80%E5%A7%8B" target="_blank" rel="noopener noreffer"></a></h3>
<p>你必须拥有一个 Kubernetes 的集群，同时你的 Kubernetes 集群必须带有 kubectl 命令行工具。 建议在至少有两个节点的集群上运行本教程，且这些节点不作为控制平面主机。 如果你还没有集群，你可以通过 <a href="https://minikube.sigs.k8s.io/docs/tutorials/multi_node/" target="_blank" rel="noopener noreffer">Minikube</a> 构建一个你自己的集群，或者你可以使用下面任意一个 Kubernetes 工具构建：</p>
<ul>
<li><a href="https://killercoda.com/playgrounds/scenario/kubernetes" target="_blank" rel="noopener noreffer">Killercoda</a></li>
<li><a href="http://labs.play-with-k8s.com/" target="_blank" rel="noopener noreffer">玩转 Kubernetes</a></li>
</ul>
<p>要获知版本信息，请输入 <code>kubectl version</code>.</p>
<h3 id="访问集群上运行的服务httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesaccessing-services-running-on-the-cluster">访问集群上运行的服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#accessing-services-running-on-the-cluster" target="_blank" rel="noopener noreffer"></a></h3>
<p>在 Kubernetes 里，<a href="https://kubernetes.io/zh-cn/docs/concepts/architecture/nodes/" target="_blank" rel="noopener noreffer">节点</a>、 <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/" target="_blank" rel="noopener noreffer">Pod</a> 和 <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreffer">服务</a> 都有自己的 IP。 许多情况下，集群上的节点 IP、Pod IP 和某些服务 IP 是路由不可达的， 所以不能从集群之外访问它们，例如从你自己的台式机。</p>
<h4 id="连接方式httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesways-to-connect">连接方式<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#ways-to-connect" target="_blank" rel="noopener noreffer"></a></h4>
<p>你有多种可选方式从集群外连接节点、Pod 和服务：</p>
<ul>
<li>
<p>通过公网 IP 访问服务</p>
<ul>
<li>使用类型为 <code>NodePort</code> 或 <code>LoadBalancer</code> 的服务，可以从外部访问它们。 请查阅<a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreffer">服务</a> 和 <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands/#expose" target="_blank" rel="noopener noreffer">kubectl expose</a> 文档。</li>
<li>取决于你的集群环境，你可以仅把服务暴露在你的企业网络环境中，也可以将其暴露在 因特网上。需要考虑暴露的服务是否安全，它是否有自己的用户认证？</li>
<li>将 Pod 放置于服务背后。如果要访问一个副本集合中特定的 Pod，例如用于调试目的， 请给 Pod 指定一个独特的标签并创建一个新服务选择该标签。</li>
<li>大部分情况下，都不需要应用开发者通过节点 IP 直接访问节点。</li>
</ul>
</li>
<li>
<p>通过 Proxy 动词访问服务、节点或者 Pod</p>
<ul>
<li>在访问远程服务之前，利用 API 服务器执行身份认证和鉴权。 如果你的服务不够安全，无法暴露到因特网中，或者需要访问节点 IP 上的端口， 又或者出于调试目的，可使用这种方式。</li>
<li>代理可能给某些应用带来麻烦</li>
<li>此方式仅适用于 HTTP/HTTPS</li>
<li>进一步的描述在<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#manually-constructing-apiserver-proxy-urls" target="_blank" rel="noopener noreffer">这里</a></li>
<li>从集群中的 node 或者 pod 访问。</li>
</ul>
</li>
<li>
<p>从集群中的一个节点或 Pod 访问</p>
<ul>
<li>运行一个 Pod，然后使用 <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands/#exec" target="_blank" rel="noopener noreffer">kubectl exec</a> 连接到它的 Shell。从那个 Shell 连接其他的节点、Pod 和 服务</li>
<li>某些集群可能允许你 SSH 到集群中的节点。你可能可以从那儿访问集群服务。 这是一个非标准的方式，可能在一些集群上能工作，但在另一些上却不能。 浏览器和其他工具可能已经安装也可能没有安装。集群 DNS 可能不会正常工作。</li>
</ul>
</li>
</ul>
<h4 id="发现内置服务httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesdiscovering-builtin-services">发现内置服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#discovering-builtin-services" target="_blank" rel="noopener noreffer"></a></h4>
<p>典型情况下，kube-system 名字空间中会启动集群的几个服务。 使用 <code>kubectl cluster-info</code> 命令获取这些服务的列表：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">kubectl cluster-info
</code></pre></td></tr></table>
</div>
</div><p>输出类似于：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Kubernetes master is running at https://192.0.2.1
elasticsearch-logging is running at https://192.0.2.1/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy
kibana-logging is running at https://192.0.2.1/api/v1/namespaces/kube-system/services/kibana-logging/proxy
kube-dns is running at https://192.0.2.1/api/v1/namespaces/kube-system/services/kube-dns/proxy
grafana is running at https://192.0.2.1/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy
heapster is running at https://192.0.2.1/api/v1/namespaces/kube-system/services/monitoring-heapster/proxy
</code></pre></td></tr></table>
</div>
</div><p>这一输出显示了用 proxy 动词访问每个服务时可用的 URL。例如，此集群 （使用 Elasticsearch）启用了集群层面的日志。如果提供合适的凭据，可以通过 <code>https://192.0.2.1/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/</code> 访问，或通过一个 <code>kubectl proxy</code> 来访问： <code>http://localhost:8080/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/</code>。</p>
<p><strong>说明：</strong> 请参阅<a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/access-cluster-api/#accessing-the-cluster-api" target="_blank" rel="noopener noreffer">使用 Kubernetes API 访问集群</a> 了解如何传递凭据或如何使用 <code>kubectl proxy</code>。</p>
<h5 id="手动构建-api-服务器代理-urlshttpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesmanually-constructing-apiserver-proxy-urls">手动构建 API 服务器代理 URLs<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#manually-constructing-apiserver-proxy-urls" target="_blank" rel="noopener noreffer"></a></h5>
<p>如前所述，你可以使用 <code>kubectl cluster-info</code> 命令取得服务的代理 URL。 为了创建包含服务末端、后缀和参数的代理 URLs，你可以在服务的代理 URL 中添加： <code>http://</code><em><code>kubernetes_master_address</code></em><code>/api/v1/namespaces/</code><em><code>namespace_name</code></em><code>/services/</code><em><code>service_name[:port_name]</code></em><code>/proxy</code></p>
<p>如果还没有为你的端口指定名称，你可以不用在 URL 中指定 <em>port_name</em>。 对于命名和未命名端口，你还可以使用端口号代替 <em>port_name</em>。</p>
<p>默认情况下，API 服务器使用 HTTP 为你的服务提供代理。 要使用 HTTPS，请在服务名称前加上 <code>https:</code>： <code>http://&lt;kubernetes_master_address&gt;/api/v1/namespaces/&lt;namespace_name&gt;/services/&lt;service_name&gt;/proxy</code> URL 的 <code>&lt;service_name&gt;</code> 段支持的格式为：</p>
<ul>
<li><code>&lt;service_name&gt;</code> - 使用 http 代理到默认或未命名端口</li>
<li><code>&lt;service_name&gt;:&lt;port_name&gt;</code> - 使用 http 代理到指定的端口名称或端口号</li>
<li><code>https:&lt;service_name&gt;:</code> - 使用 https 代理到默认或未命名端口（注意尾随冒号）</li>
<li><code>https:&lt;service_name&gt;:&lt;port_name&gt;</code> - 使用 https 代理到指定的端口名称或端口号</li>
</ul>
<h6 id="示例httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesexamples">示例<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#examples" target="_blank" rel="noopener noreffer"></a></h6>
<ul>
<li>
<p>如要访问 Elasticsearch 服务末端 <code>_search?q=user:kimchy</code>，你可以使用以下地址：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">http://192.0.2.1/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/_search?q=user:kimchy
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>如要访问 Elasticsearch 集群健康信息<code>_cluster/health?pretty=true</code>，你可以使用以下地址：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">https://192.0.2.1/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/_cluster/health?pretty=true
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">健康信息与下面的例子类似：
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;cluster_name&#34;</span> <span class="p">:</span> <span class="s2">&#34;kubernetes_logging&#34;</span><span class="p">,</span>
  <span class="nt">&#34;status&#34;</span> <span class="p">:</span> <span class="s2">&#34;yellow&#34;</span><span class="p">,</span>
  <span class="nt">&#34;timed_out&#34;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&#34;number_of_nodes&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&#34;number_of_data_nodes&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&#34;active_primary_shards&#34;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="nt">&#34;active_shards&#34;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="nt">&#34;relocating_shards&#34;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&#34;initializing_shards&#34;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&#34;unassigned_shards&#34;</span> <span class="p">:</span> <span class="mi">5</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>如要访问 <strong>https</strong> Elasticsearch 服务健康信息 <code>_cluster/health?pretty=true</code>，你可以使用以下地址：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">https://192.0.2.1/api/v1/namespaces/kube-system/services/https:elasticsearch-logging:/proxy/_cluster/health?pretty=true
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h5 id="通过-web-浏览器访问集群中运行的服务httpskubernetesiozh-cndocstasksaccess-application-clusteraccess-cluster-servicesuusing-web-browsers-to-access-services-running-on-the-cluster">通过 Web 浏览器访问集群中运行的服务<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/access-cluster-services/#uusing-web-browsers-to-access-services-running-on-the-cluster" target="_blank" rel="noopener noreffer"></a></h5>
<p>你或许能够将 API 服务器代理的 URL 放入浏览器的地址栏，然而：</p>
<ul>
<li>Web 服务器通常不能传递令牌，所以你可能需要使用基本（密码）认证。 API 服务器可以配置为接受基本认证，但你的集群可能并没有这样配置。</li>
<li>某些 Web 应用可能无法工作，特别是那些使用客户端 Javascript 构造 URL 的 应用，所构造的 URL 可能并不支持代理路径前缀。</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 0001-01-01 00:00:00</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://jefofrank.xyz/%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" data-title=""><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://jefofrank.xyz/%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Reddit" data-sharer="reddit" data-url="https://jefofrank.xyz/%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://jefofrank.xyz/%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" data-title=""><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://jefofrank.xyz/%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" data-title=""><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://jefofrank.xyz/%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" data-title=""><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/baidu.svg"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E8%BF%90%E8%A1%8Cjobs/" class="prev" rel="prev" title=""><i class="fas fa-angle-left fa-fw"></i></a>
            <a href="/%E7%AE%A1%E7%90%86kubernetes%E5%AF%B9%E8%B1%A1%E4%B8%8Esecrets/" class="next" rel="next" title=""><i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.89.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/jf-011101" target="_blank">Jefo</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp"><a href="https://beian.miit.gov.cn/">赣ICP备2022007470号-1</a></span></br>
                <span id="busuanzi_container_site_pv">
                    访问量 <span id="busuanzi_value_site_pv"></span> 次
                </span>
                &nbsp;|&nbsp;
                <span id="busuanzi_container_site_uv">
                    访客数 <span id="busuanzi_value_site_uv"></span> 人次
                </span>
                </br><script>
                    function siteTime() {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = 2021;
                        var startMonth = 3;
                        var startDate = 27;
                        var startHour = 19;
                        var startMinute = 15;
                        var startSecond = 11;
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);
                        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                            minutes);
                        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                            diffMinutes * minutes) / seconds);
                        if (startYear == todayYear) {
                            
                            document.getElementById("sitetime").innerHTML = "已安全运行 " + diffDays + " 天 " + diffHours +
                                " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                        } else {
                            
                            document.getElementById("sitetime").innerHTML = "已安全运行 " + diffYears + " 年 " + diffDays +
                                " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                        }
                    }
                    setInterval(siteTime, 1000);
                </script>
                    <span id="sitetime">载入运行时间...</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><script type="text/javascript" src="https://jefos-blog.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"data":{"id-1":"绿叶律动","id-2":"绿叶律动"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"J0OW8CCKJZ","algoliaIndex":"JF-2","algoliaSearchKey":"3b4a19e831c95174aca4c03fcdf95f5c","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
