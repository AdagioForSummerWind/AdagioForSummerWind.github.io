<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Kitex - Jefo</title><meta name="Description" content="Jefo"><meta property="og:title" content="Kitex" />
<meta property="og:description" content="来自字节Kitex文档 准备 Golang 开发环境 如果您之前未搭建 Golang 开发环境， 可以参考 Golang 安装 推荐使用最新版本的 Golang，我们保证最新三个正式版本的兼容" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://qizhengzou.github.io/kitex/" /><meta property="og:image" content="https://qizhengzou.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-10T09:28:10+08:00" />
<meta property="article:modified_time" content="2022-06-10T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://qizhengzou.github.io/logo.png"/>

<meta name="twitter:title" content="Kitex"/>
<meta name="twitter:description" content="来自字节Kitex文档 准备 Golang 开发环境 如果您之前未搭建 Golang 开发环境， 可以参考 Golang 安装 推荐使用最新版本的 Golang，我们保证最新三个正式版本的兼容"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://qizhengzou.github.io/kitex/" /><link rel="prev" href="https://qizhengzou.github.io/grpc/" /><link rel="next" href="https://qizhengzou.github.io/mongodb_base_01/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Kitex",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/qizhengzou.github.io\/kitex\/"
        },"image": ["https:\/\/qizhengzou.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "API style","wordcount":  3236 ,
        "url": "https:\/\/qizhengzou.github.io\/kitex\/","datePublished": "2022-06-10T09:28:10+08:00","dateModified": "2022-06-10T00:00:00+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Jefo","logo": "https:\/\/qizhengzou.github.io\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "Jefo"
            },"description": ""
    }
    </script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-193031966-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-193031966-2');
</script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Jefo"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>Jefo</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> All posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/qizhengzou" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="直接搜索更方便^-^" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Jefo"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>Jefo</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="直接搜索更方便^-^" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">All posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/qizhengzou" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Kitex</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jefo</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/api-style/"><i class="far fa-folder fa-fw"></i>API Style</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-06-10 09:28:10">2022-06-10 09:28:10</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3236 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 7 分钟&nbsp;<span id="busuanzi_container_page_pv">
                    <i class="far fa-eye fa-fw"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;次阅读量</span>
                </span>
            </div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#准备-golang-开发环境">准备 Golang 开发环境</a></li>
    <li><a href="#快速上手">快速上手</a>
      <ul>
        <li><a href="#安装代码生成工具">安装代码生成工具</a></li>
        <li><a href="#确定代码放置位置">确定代码放置位置</a></li>
        <li><a href="#获取示例代码">获取示例代码</a></li>
        <li><a href="#运行示例代码">运行示例代码</a>
          <ul>
            <li><a href="#方式一直接启动">方式一：直接启动</a></li>
            <li><a href="#方式二使用-docker-快速启动">方式二：使用 Docker 快速启动</a></li>
          </ul>
        </li>
        <li><a href="#增加一个新的方法">增加一个新的方法</a></li>
        <li><a href="#重新生成代码">重新生成代码</a></li>
        <li><a href="#更新服务端处理逻辑">更新服务端处理逻辑</a></li>
        <li><a href="#增加客户端调用">增加客户端调用</a></li>
        <li><a href="#重新运行示例代码">重新运行示例代码</a></li>
      </ul>
    </li>
    <li><a href="#基础教程">基础教程</a>
      <ul>
        <li><a href="#关于-kitex">关于 Kitex</a></li>
        <li><a href="#为什么要使用-idl">为什么要使用 IDL</a></li>
        <li><a href="#创建项目目录">创建项目目录</a></li>
        <li><a href="#kitex-命令行工具">Kitex 命令行工具</a>
          <ul>
            <li><a href="#安装">安装</a></li>
            <li><a href="#使用">使用</a></li>
          </ul>
        </li>
        <li><a href="#编写-idl">编写 IDL</a></li>
        <li><a href="#生成-echo-服务代码">生成 echo 服务代码</a></li>
        <li><a href="#获取最新的-kitex-框架">获取最新的 Kitex 框架</a></li>
        <li><a href="#编写-echo-服务逻辑">编写 echo 服务逻辑</a></li>
        <li><a href="#编译运行">编译运行</a></li>
        <li><a href="#编写客户端">编写客户端</a>
          <ul>
            <li><a href="#创建-client">创建 client</a></li>
            <li><a href="#发起调用">发起调用</a></li>
          </ul>
        </li>
        <li><a href="#发起调用-1">发起调用</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>来自<a href="https://www.cloudwego.io/zh/docs/kitex/getting-started/" target="_blank" rel="noopener noreffer">字节Kitex文档</a></p>
</blockquote>
<h2 id="准备-golang-开发环境">准备 Golang 开发环境</h2>
<ol>
<li>如果您之前未搭建 Golang 开发环境， 可以参考 <a href="https://golang.org/doc/install" target="_blank" rel="noopener noreffer">Golang 安装</a></li>
<li>推荐使用最新版本的 Golang，我们保证最新三个正式版本的兼容性(现在 &gt;= <strong>v1.16</strong>)。</li>
<li>确保打开 go mod 支持 (Golang &gt;= 1.15时，默认开启)</li>
<li>kitex 暂时没有针对 Windows 做支持，如果本地开发环境是 Windows 建议使用 <a href="https://docs.microsoft.com/zh-cn/windows/wsl/install" target="_blank" rel="noopener noreffer">WSL2</a></li>
</ol>
<h2 id="快速上手">快速上手</h2>
<p>在完成环境准备后，本章节将帮助你快速上手 Kitex</p>
<h3 id="安装代码生成工具">安装代码生成工具</h3>
<p>首先，我们需要安装使用本示例所需要的命令行代码生成工具：</p>
<ol>
<li>确保 <code>GOPATH</code> 环境变量已经被正确地定义（例如 <code>export GOPATH=~/go</code>）并且将<code>$GOPATH/bin</code>添加到 <code>PATH</code> 环境变量之中（例如 <code>export PATH=$GOPATH/bin:$PATH</code>）；请勿将 <code>GOPATH</code> 设置为当前用户没有读写权限的目录</li>
<li>安装 kitex：<code>go install github.com/cloudwego/kitex/tool/cmd/kitex@latest</code></li>
<li>安装 thriftgo：<code>go install github.com/cloudwego/thriftgo@latest</code></li>
</ol>
<p>安装成功后，执行 <code>kitex --version</code> 和 <code>thriftgo --version</code> 应该能够看到具体版本号的输出（版本号有差异，以 x.x.x 示例）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ kitex --version
vx.x.x


thriftgo x.x.x
</code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>如果在安装阶段发生问题，可能主要是由于对 Golang 的不当使用造成，请依照报错信息进行检索</li>
</ol>
<h3 id="确定代码放置位置">确定代码放置位置</h3>
<ol>
<li>若将代码放置于 <code>$GOPATH/src</code> 下，需在 <code>$GOPATH/src</code> 下创建额外目录，进入该目录后再获取代码：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">mkdir -p <span class="k">$(</span>go env GOPATH<span class="k">)</span>/src/github.com/cloudwego
<span class="nb">cd</span> <span class="k">$(</span>go env GOPATH<span class="k">)</span>/src/github.com/cloudwego
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>若将代码放置于 GOPATH 之外，可直接获取</li>
</ol>
<h3 id="获取示例代码">获取示例代码</h3>
<ol>
<li>你可以直接点击 <a href="https://github.com/cloudwego/kitex-examples/archive/refs/heads/main.zip" target="_blank" rel="noopener noreffer">此处</a> 下载示例仓库</li>
<li>也可以克隆该示例仓库到本地 <code>git clone https://github.com/cloudwego/kitex-examples.git</code></li>
</ol>
<h3 id="运行示例代码">运行示例代码</h3>
<h4 id="方式一直接启动">方式一：直接启动</h4>
<ol>
<li>
<p>进入示例仓库的 <code>hello</code> 目录</p>
<p><code>cd kitex-examples/hello</code></p>
</li>
<li>
<p>运行 server</p>
<p><code>go run .</code></p>
</li>
<li>
<p>运行 client</p>
<p>另起一个终端后，<code>go run ./client</code></p>
</li>
</ol>
<h4 id="方式二使用-docker-快速启动">方式二：使用 Docker 快速启动</h4>
<ol>
<li>
<p>进入示例仓库目录</p>
<p><code>cd kitex-examples</code></p>
</li>
<li>
<p>编译项目</p>
<p><code>docker build -t kitex-examples .</code></p>
</li>
<li>
<p>运行 server</p>
<p><code>docker run --network host kitex-examples ./hello-server</code></p>
</li>
<li>
<p>运行 client</p>
<p>另起一个终端后，<code>docker run --network host kitex-examples ./hello-client</code></p>
</li>
</ol>
<p>恭喜你，你现在成功通过 Kitex 发起了 RPC 调用。</p>
<h3 id="增加一个新的方法">增加一个新的方法</h3>
<p>打开 <code>hello.thrift</code>，你会看到如下内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-thrift" data-lang="thrift"><span class="kn">namespace</span><span class="w"> </span><span class="nn">go</span><span class="w"> </span><span class="n">api</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">struct</span><span class="w"> </span><span class="nc">Request</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">struct</span><span class="w"> </span><span class="nc">Response</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">service</span><span class="w"> </span><span class="nc">Hello</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Response</span><span class="w"> </span><span class="nf">echo</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="n">req</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>现在让我们为新方法分别定义一个新的请求和响应，<code>AddRequest</code> 和 <code>AddResponse</code>，并在 <code>service Hello</code> 中增加 <code>add</code> 方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-thrift" data-lang="thrift"><span class="kn">namespace</span><span class="w"> </span><span class="nn">go</span><span class="w"> </span><span class="n">api</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">struct</span><span class="w"> </span><span class="nc">Request</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">struct</span><span class="w"> </span><span class="nc">Response</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">struct</span><span class="w"> </span><span class="nc">AddRequest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">  </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">first</span><span class="w">
</span><span class="w">  </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">second</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">struct</span><span class="w"> </span><span class="nc">AddResponse</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">  </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="n">sum</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">service</span><span class="w"> </span><span class="nc">Hello</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Response</span><span class="w"> </span><span class="nf">echo</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="n">req</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="n">AddResponse</span><span class="w"> </span><span class="nf">add</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">AddRequest</span><span class="w"> </span><span class="n">req</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>完成之后 <code>hello.thrift</code> 的内容应该和上面一样。</p>
<h3 id="重新生成代码">重新生成代码</h3>
<p>运行如下命令后，<code>kitex</code> 工具将根据 <code>hello.thrift</code> 更新代码文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">kitex -service a.b.c hello.thrift

<span class="c1"># 若当前目录不在 $GOPATH/src 下，需要加上 -module 参数，一般为 go.mod 下的名字</span>
kitex -module <span class="s2">&#34;your_module_name&#34;</span> -service a.b.c hello.thrift
</code></pre></td></tr></table>
</div>
</div><p>执行完上述命令后，<code>kitex</code> 工具将更新下述文件</p>
<ol>
<li>更新 <code>./handler.go</code>，在里面增加一个 <code>Add</code> 方法的基本实现</li>
<li>更新 <code>./kitex_gen</code>，里面有框架运行所必须的代码文件</li>
</ol>
<h3 id="更新服务端处理逻辑">更新服务端处理逻辑</h3>
<p>上述步骤完成后，<code>./handler.go</code> 中会自动补全一个 <code>Add</code> 方法的基本实现，类似如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Add implements the HelloImpl interface.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">HelloImpl</span><span class="p">)</span> <span class="nf">Add</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">AddRequest</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">AddResponse</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// TODO: Your code here...
</span><span class="c1"></span>        <span class="k">return</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>让我们在里面增加我们所需要的逻辑，类似如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Add implements the HelloImpl interface.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">HelloImpl</span><span class="p">)</span> <span class="nf">Add</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">AddRequest</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">AddResponse</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// TODO: Your code here...
</span><span class="c1"></span>        <span class="nx">resp</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">AddResponse</span><span class="p">{</span><span class="nx">Sum</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">First</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Second</span><span class="p">}</span>
        <span class="k">return</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="增加客户端调用">增加客户端调用</h3>
<p>服务端已经有了 <code>Add</code> 方法的处理，现在让我们在客户端增加对 <code>Add</code> 方法的调用。</p>
<p>在 <code>./client/main.go</code> 中你会看到类似如下的 <code>for</code> 循环：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="k">for</span> <span class="p">{</span>
        <span class="nx">req</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">Request</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;my request&#34;</span><span class="p">}</span>
        <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Echo</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">req</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>现在让我们在里面增加 <code>Add</code> 方法的调用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="k">for</span> <span class="p">{</span>
        <span class="nx">req</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">Request</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;my request&#34;</span><span class="p">}</span>
        <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Echo</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">req</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">addReq</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">AddRequest</span><span class="p">{</span><span class="nx">First</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="nx">Second</span><span class="p">:</span> <span class="mi">512</span><span class="p">}</span>
        <span class="nx">addResp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">addReq</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">addResp</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="重新运行示例代码">重新运行示例代码</h3>
<p>关闭之前运行的客户端和服务端之后</p>
<ol>
<li>运行 server</li>
</ol>
<p><code>go run .</code></p>
<ol start="2">
<li>运行 client</li>
</ol>
<p>另起一个终端后，<code>go run ./client</code></p>
<p>现在，你应该能看到客户端在调用 <code>Add</code> 方法了。</p>
<h2 id="基础教程">基础教程</h2>
<h3 id="关于-kitex">关于 Kitex</h3>
<p>Kitex 是一个 RPC 框架，既然是 RPC，底层就需要两大功能：</p>
<ol>
<li>Serialization 序列化</li>
<li>Transport 传输</li>
</ol>
<p>Kitex 框架及命令行工具，默认支持 <code>thrift</code> 和 <code>proto3</code> 两种 IDL，对应的 Kitex 支持 <code>thrift</code> 和 <code>protobuf</code> 两种序列化协议。传输上 Kitex 使用扩展的 <code>thrift</code> 作为底层的传输协议（注：thrift 既是 IDL 格式，同时也是序列化协议和传输协议）。IDL 全称是 Interface Definition Language，接口定义语言。</p>
<h3 id="为什么要使用-idl">为什么要使用 IDL</h3>
<p>如果我们要进行 RPC，就需要知道对方的接口是什么，需要传什么参数，同时也需要知道返回值是什么样的，（即使我们的接口并没有真正实现调通，也可以通过IDL生成调用的代码，不会阻塞对方的开发）就好比两个人之间交流，需要保证在说的是同一个语言、同一件事。这时候，就需要通过 IDL 来约定双方的协议，就像在写代码的时候需要调用某个函数，我们需要知道函数签名一样。</p>
<p>Thrift IDL 语法可参考：<a href="http://thrift.apache.org/docs/idl" target="_blank" rel="noopener noreffer">Thrift interface description language</a>。</p>
<p>proto3 语法可参考：<a href="https://developers.google.com/protocol-buffers/docs/proto3" target="_blank" rel="noopener noreffer">Language Guide(proto3)</a>。</p>
<h3 id="创建项目目录">创建项目目录</h3>
<p>在开始后续的步骤之前，先让我们创建一个项目目录用于后续的教程。</p>
<p><code>$ mkdir example</code></p>
<p>然后让我们进入项目目录</p>
<p><code>$ cd example</code></p>
<h3 id="kitex-命令行工具">Kitex 命令行工具</h3>
<p>Kitex 自带了一个同名的命令行工具 <code>kitex</code>，用来帮助大家很方便地生成代码，新项目的生成以及之后我们会学到的 server、client 代码的生成都是通过 kitex 工具进行。</p>
<h4 id="安装">安装</h4>
<p>可以使用以下命令来安装或者更新 kitex：</p>
<p><code>$ go install github.com/cloudwego/kitex/tool/cmd/kitex</code></p>
<p>完成后，可以通过执行 kitex 来检测是否安装成功。</p>
<p><code>$ kitex</code></p>
<p>如果出现如下输出，则安装成功。</p>
<p><code>$ kitex</code></p>
<p><code>No IDL file found.</code></p>
<p>如果出现 <code>command not found</code> 错误，可能是因为没有把 <code>$GOPATH/bin</code> 加入到 <code>$PATH</code> 中，详见环境准备一章。</p>
<h4 id="使用">使用</h4>
<p>kitex 的具体使用请参考<a href="../tutorials/code-gen/code_generation" rel="">代码生成工具</a></p>
<h3 id="编写-idl">编写 IDL</h3>
<p>首先我们需要编写一个 IDL，这里以 thrift IDL 为例。</p>
<p>首先创建一个名为 <code>echo.thrift</code> 的 thrift IDL 文件。</p>
<p>然后在里面定义我们的服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-thrift" data-lang="thrift"><span class="kn">namespace</span><span class="w"> </span><span class="nn">go</span><span class="w"> </span><span class="n">api</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">struct</span><span class="w"> </span><span class="nc">Request</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">  </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">struct</span><span class="w"> </span><span class="nc">Response</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">  </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="kd">service</span><span class="w"> </span><span class="nc">Echo</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Response</span><span class="w"> </span><span class="nf">echo</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="n">req</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="生成-echo-服务代码">生成 echo 服务代码</h3>
<p>有了 IDL 以后我们便可以通过 kitex 工具生成项目代码了，执行如下命令：</p>
<p><code>$ kitex -module example -service example echo.thrift</code></p>
<p>上述命令中，<code>-module</code> 表示生成的该项目的 go module 名，<code>-service</code> 表明我们要生成一个服务端项目，后面紧跟的 <code>example</code> 为该服务的名字。最后一个参数则为该服务的 IDL 文件。</p>
<p>生成后的项目结构如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">.
|-- build.sh
|-- echo.thrift
|-- handler.go
|-- kitex_gen
|   `-- api
|       |-- echo
|       |   |-- client.go
|       |   |-- echo.go
|       |   |-- invoker.go
|       |   `-- server.go
|       |-- echo.go
|       `-- k-echo.go
|-- main.go
`-- script
    |-- bootstrap.sh
    `-- settings.py
</code></pre></td></tr></table>
</div>
</div><h3 id="获取最新的-kitex-框架">获取最新的 Kitex 框架</h3>
<p>由于 kitex 要求使用 go mod 进行依赖管理，所以我们要升级 kitex 框架会很容易，只需要执行以下命令即可：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ go get github.com/cloudwego/kitex@latest
$ go mod tidy
</code></pre></td></tr></table>
</div>
</div><p>如果遇到类似如下报错：</p>
<p><code>github.com/apache/thrift/lib/go/thrift: ambiguous import: found package github.com/apache/thrift/lib/go/thrift in multiple modules</code></p>
<p>先执行一遍下述命令，再继续操作：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">go mod edit -droprequire=github.com/apache/thrift/lib/go/thrift
go mod edit -replace=github.com/apache/thrift=github.com/apache/thrift@v0.13.0
</code></pre></td></tr></table>
</div>
</div><h3 id="编写-echo-服务逻辑">编写 echo 服务逻辑</h3>
<p>我们需要编写的服务端逻辑都在 <code>handler.go</code> 这个文件中，现在这个文件应该如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;context&#34;</span>
  <span class="s">&#34;example/kitex_gen/api&#34;</span>
<span class="p">)</span>

<span class="c1">// EchoImpl implements the last service interface defined in the IDL.
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">EchoImpl</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Echo implements the EchoImpl interface.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">EchoImpl</span><span class="p">)</span> <span class="nf">Echo</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// TODO: Your code here...
</span><span class="c1"></span>  <span class="k">return</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>这里的 <code>Echo</code> 函数就对应了我们之前在 IDL 中定义的 <code>echo</code> 方法。</p>
<p>现在让我们修改一下服务端逻辑，让 <code>Echo</code> 服务名副其实。</p>
<p>修改 <code>Echo</code> 函数为下述代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">EchoImpl</span><span class="p">)</span> <span class="nf">Echo</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">Response</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Message</span><span class="p">},</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="编译运行">编译运行</h3>
<p>kitex 工具已经帮我们生成好了编译和运行所需的脚本：</p>
<p>编译：</p>
<p><code>$ sh build.sh</code></p>
<p>执行上述命令后，会生成一个 <code>output</code> 目录，里面含有我们的编译产物。</p>
<p>运行：</p>
<p><code>$ sh output/bootstrap.sh</code></p>
<p>执行上述命令后，<code>Echo</code> 服务就开始运行啦！</p>
<h3 id="编写客户端">编写客户端</h3>
<p>有了服务端后，接下来就让我们编写一个客户端用于调用刚刚运行起来的服务端。</p>
<p>首先，同样的，先创建一个目录用于存放我们的客户端代码：</p>
<p><code>$ mkdir client</code></p>
<p>进入目录：</p>
<p><code>$ cd client</code></p>
<p>创建一个 <code>main.go</code> 文件，然后就开始编写客户端代码了。</p>
<h4 id="创建-client">创建 client</h4>
<p>首先让我们创建一个调用所需的 <code>client</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="s">&#34;example/kitex_gen/api/echo&#34;</span>
<span class="kn">import</span> <span class="s">&#34;github.com/cloudwego/kitex/client&#34;</span>
<span class="o">...</span>
<span class="nx">c</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">echo</span><span class="p">.</span><span class="nf">NewClient</span><span class="p">(</span><span class="s">&#34;example&#34;</span><span class="p">,</span> <span class="nx">client</span><span class="p">.</span><span class="nf">WithHostPorts</span><span class="p">(</span><span class="s">&#34;0.0.0.0:8888&#34;</span><span class="p">))</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>上述代码中，<code>echo.NewClient</code> 用于创建 <code>client</code>，其第一个参数为调用的 <em>服务名</em>，第二个参数为 <em>options</em>，用于传入参数，此处的 <code>client.WithHostPorts</code> 用于指定服务端的地址，更多参数可参考<a href="../tutorials/basic-feature" rel="">基本特性</a>一节。</p>
<h4 id="发起调用">发起调用</h4>
<p>接下来让我们编写用于发起调用的代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="s">&#34;example/kitex_gen/api&#34;</span>
<span class="o">...</span>
<span class="nx">req</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">Request</span><span class="p">{</span><span class="nx">Message</span><span class="p">:</span> <span class="s">&#34;my request&#34;</span><span class="p">}</span>
<span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Echo</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">callopt</span><span class="p">.</span><span class="nf">WithRPCTimeout</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">))</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>上述代码中，我们首先创建了一个请求 <code>req</code> , 然后通过 <code>c.Echo</code> 发起了调用。</p>
<p>其第一个参数为 <code>context.Context</code>，通过通常用其传递信息或者控制本次调用的一些行为，你可以在后续章节中找到如何使用它。</p>
<p>其第二个参数为本次调用的请求。</p>
<p>其第三个参数为本次调用的 <code>options</code> ，Kitex 提供了一种 <code>callopt</code> 机制，顾名思义——调用参数 ，有别于创建 client 时传入的参数，这里传入的参数仅对此次生效。
此处的 <code>callopt.WithRPCTimeout</code> 用于指定此次调用的超时（通常不需要指定，此处仅作演示之用）同样的，你可以在<a href="../tutorials/basic-feature" rel="">基本特性</a>一节中找到更多的参数。</p>
<h3 id="发起调用-1">发起调用</h3>
<p>在编写完一个简单的客户端后，我们终于可以发起调用了。</p>
<p>你可以通过下述命令来完成这一步骤：</p>
<p><code>$ go run main.go</code></p>
<p>如果不出意外，你可以看到类似如下输出：</p>
<p><code>2021/05/20 16:51:35 Response({Message:my request})</code></p>
<p>恭喜你！至此你成功编写了一个 Kitex 的服务端和客户端，并完成了一次调用！</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-06-10 00:00:00</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://qizhengzou.github.io/kitex/" data-title="Kitex" data-hashtags="API style"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://qizhengzou.github.io/kitex/" data-hashtag="API style"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Reddit" data-sharer="reddit" data-url="https://qizhengzou.github.io/kitex/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://qizhengzou.github.io/kitex/" data-title="Kitex"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://qizhengzou.github.io/kitex/" data-title="Kitex"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://qizhengzou.github.io/kitex/" data-title="Kitex"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/baidu.svg"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/api-style/">API style</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/grpc/" class="prev" rel="prev" title="Grpc"><i class="fas fa-angle-left fa-fw"></i>Grpc</a>
            <a href="/mongodb_base_01/" class="next" rel="next" title="Mongodb_base_01">Mongodb_base_01<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><script type="text/javascript" src="https://jefos-blog.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"J0OW8CCKJZ","algoliaIndex":"JF","algoliaSearchKey":"3b4a19e831c95174aca4c03fcdf95f5c","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
