<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Gb_20131023 - 绿叶律动</title><meta name="Description" content="绿叶律动"><meta property="og:title" content="Gb_20131023" />
<meta property="og:description" content="Strings, bytes, runes and characters in Go Rob Pike 23 October 2013 Introduction The previous blog post explained how slices work in Go, using a number of examples to illustrate the mechanism behind their implementation. Building on that background, this post discusses strings in Go. At first, strings might seem too simple a topic for a blog post, but to use them well requires understanding not only how they work," />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jefofrank.xyz/gb_20131023/" /><meta property="og:image" content="https://jefofrank.xyz/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-24T08:59:13+08:00" />
<meta property="article:modified_time" content="2022-10-29T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jefofrank.xyz/logo.png"/>

<meta name="twitter:title" content="Gb_20131023"/>
<meta name="twitter:description" content="Strings, bytes, runes and characters in Go Rob Pike 23 October 2013 Introduction The previous blog post explained how slices work in Go, using a number of examples to illustrate the mechanism behind their implementation. Building on that background, this post discusses strings in Go. At first, strings might seem too simple a topic for a blog post, but to use them well requires understanding not only how they work,"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://jefofrank.xyz/gb_20131023/" /><link rel="prev" href="https://jefofrank.xyz/gb_20130926/" /><link rel="next" href="https://jefofrank.xyz/gb_20131110/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Gb_20131023",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/jefofrank.xyz\/gb_20131023\/"
        },"image": ["https:\/\/jefofrank.xyz\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "go official blogs","wordcount":  2776 ,
        "url": "https:\/\/jefofrank.xyz\/gb_20131023\/","datePublished": "2022-10-24T08:59:13+08:00","dateModified": "2022-10-29T00:00:00+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Jefo","logo": "https:\/\/jefofrank.xyz\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "Jefo"
            },"description": ""
    }
    </script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-193031966-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-193031966-2');
</script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="绿叶律动"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> All posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/jf-011101" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="直接搜索更方便^-^" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="绿叶律动"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="直接搜索更方便^-^" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">All posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/jf-011101" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Gb_20131023</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/jf-011101" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jefo</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/2022/"><i class="far fa-folder fa-fw"></i>2022</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-10-24 08:59:13">2022-10-24 08:59:13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2776 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;<span id="busuanzi_container_page_pv">
                    <i class="far fa-eye fa-fw"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;次阅读量</span>
                </span>
            </div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#what-is-a-string">What is a string?</a></li>
    <li><a href="#printing-strings">Printing strings</a></li>
    <li><a href="#utf-8-and-string-literals">UTF-8 and string literals</a></li>
    <li><a href="#code-points-characters-and-runes">Code points, characters, and runes</a></li>
    <li><a href="#range-loops">Range loops</a></li>
    <li><a href="#libraries">Libraries</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="strings-bytes-runes-and-characters-in-go">Strings, bytes, runes and characters in Go</h1>
<p>Rob Pike<br>
23 October 2013</p>
<h2 id="introduction">Introduction</h2>
<p>The <a href="https://blog.golang.org/slices" target="_blank" rel="noopener noreffer">previous blog post</a> explained how slices work in Go, using a number of examples to illustrate the mechanism behind their implementation. Building on that background, this post discusses strings in Go. At first, strings might seem too simple a topic for a blog post, but to use them well requires understanding not only how they work, but also the difference between a byte, a character, and a rune, the difference between Unicode and UTF-8, the difference between a string and a string literal, and other even more subtle distinctions.</p>
<p>One way to approach this topic is to think of it as an answer to the frequently asked question, “When I index a Go string at position <em>n</em>, why don’t I get the <em>nth</em> character?” As you’ll see, this question leads us to many details about how text works in the modern world.</p>
<p>An excellent introduction to some of these issues, independent of Go, is Joel Spolsky’s famous blog post, <a href="http://www.joelonsoftware.com/articles/Unicode.html" target="_blank" rel="noopener noreffer">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!)</a>. Many of the points he raises will be echoed here.</p>
<h2 id="what-is-a-string">What is a string?</h2>
<p>Let’s start with some basics.</p>
<p>In Go, a string is in effect a read-only slice of bytes. If you’re at all uncertain about what a slice of bytes is or how it works, please read the <a href="https://blog.golang.org/slices" target="_blank" rel="noopener noreffer">previous blog post</a>; we’ll assume here that you have.</p>
<p>It’s important to state right up front that a string holds <em>arbitrary</em> bytes. It is not required to hold Unicode text, UTF-8 text, or any other predefined format. As far as the content of a string is concerned, it is exactly equivalent to a slice of bytes.</p>
<p>Here is a string literal (more about those soon) that uses the <code>\xNN</code> notation to define a string constant holding some peculiar byte values. (Of course, bytes range from hexadecimal values 00 through FF, inclusive.)</p>
<pre><code>const sample = &quot;\\xbd\\xb2\\x3d\\xbc\\x20\\xe2\\x8c\\x98&quot;
</code></pre>
<h2 id="printing-strings">Printing strings</h2>
<p>Because some of the bytes in our sample string are not valid ASCII, not even valid UTF-8, printing the string directly will produce ugly output. The simple print statement</p>
<pre><code>fmt.Println(sample)
</code></pre>
<p>produces this mess (whose exact appearance varies with the environment):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">��=� ⌘
</code></pre></td></tr></table>
</div>
</div><p>To find out what that string really holds, we need to take it apart and examine the pieces. There are several ways to do this. The most obvious is to loop over its contents and pull out the bytes individually, as in this <code>for</code> loop:</p>
<pre><code>for i := 0; i &lt; len(sample); i++ {
    fmt.Printf(&quot;%x &quot;, sample\[i\])
}
</code></pre>
<p>As implied up front, indexing a string accesses individual bytes, not characters. We’ll return to that topic in detail below. For now, let’s stick with just the bytes. This is the output from the byte-by-byte loop:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">bd b2 3d bc 20 e2 8c 98
</code></pre></td></tr></table>
</div>
</div><p>Notice how the individual bytes match the hexadecimal escapes that defined the string.</p>
<p>A shorter way to generate presentable output for a messy string is to use the <code>%x</code> (hexadecimal) format verb of <code>fmt.Printf</code>. It just dumps out the sequential bytes of the string as hexadecimal digits, two per byte.</p>
<pre><code>fmt.Printf(&quot;%x\\n&quot;, sample)
</code></pre>
<p>Compare its output to that above:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">bdb23dbc20e28c98
</code></pre></td></tr></table>
</div>
</div><p>A nice trick is to use the “space” flag in that format, putting a space between the <code>%</code> and the <code>x</code>. Compare the format string used here to the one above,</p>
<pre><code>fmt.Printf(&quot;% x\\n&quot;, sample)
</code></pre>
<p>and notice how the bytes come out with spaces between, making the result a little less imposing:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">bd b2 3d bc 20 e2 8c 98
</code></pre></td></tr></table>
</div>
</div><p>There’s more. The <code>%q</code> (quoted) verb will escape any non-printable byte sequences in a string so the output is unambiguous.</p>
<pre><code>fmt.Printf(&quot;%q\\n&quot;, sample)
</code></pre>
<p>This technique is handy when much of the string is intelligible as text but there are peculiarities to root out; it produces:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">&#34;\xbd\xb2=\xbc ⌘&#34;
</code></pre></td></tr></table>
</div>
</div><p>If we squint at that, we can see that buried in the noise is one ASCII equals sign, along with a regular space, and at the end appears the well-known Swedish “Place of Interest” symbol. That symbol has Unicode value U+2318, encoded as UTF-8 by the bytes after the space (hex value <code>20</code>): <code>e2</code> <code>8c</code> <code>98</code>.</p>
<p>If we are unfamiliar or confused by strange values in the string, we can use the “plus” flag to the <code>%q</code> verb. This flag causes the output to escape not only non-printable sequences, but also any non-ASCII bytes, all while interpreting UTF-8. The result is that it exposes the Unicode values of properly formatted UTF-8 that represents non-ASCII data in the string:</p>
<pre><code>fmt.Printf(&quot;%+q\\n&quot;, sample)
</code></pre>
<p>With that format, the Unicode value of the Swedish symbol shows up as a <code>\u</code> escape:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">&#34;\xbd\xb2=\xbc \u2318&#34;
</code></pre></td></tr></table>
</div>
</div><p>These printing techniques are good to know when debugging the contents of strings, and will be handy in the discussion that follows. It’s worth pointing out as well that all these methods behave exactly the same for byte slices as they do for strings.</p>
<p>Here’s the full set of printing options we’ve listed, presented as a complete program you can run (and edit) right in the browser:</p>
<p>// +build OMIT</p>
<p>// Copyright 2013 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.</p>
<p>package main</p>
<p>import &ldquo;fmt&rdquo;</p>
<p>func main() {
const sample = &ldquo;\xbd\xb2\x3d\xbc\x20\xe2\x8c\x98&rdquo;</p>
<pre><code>fmt.Println(&quot;Println:&quot;)
fmt.Println(sample)

fmt.Println(&quot;Byte loop:&quot;)
for i := 0; i &lt; len(sample); i++ {
    fmt.Printf(&quot;%x &quot;, sample\[i\])
}
fmt.Printf(&quot;\\n&quot;)

fmt.Println(&quot;Printf with %x:&quot;)
fmt.Printf(&quot;%x\\n&quot;, sample)

fmt.Println(&quot;Printf with % x:&quot;)
fmt.Printf(&quot;% x\\n&quot;, sample)

fmt.Println(&quot;Printf with %q:&quot;)
fmt.Printf(&quot;%q\\n&quot;, sample)

fmt.Println(&quot;Printf with %+q:&quot;)
fmt.Printf(&quot;%+q\\n&quot;, sample)
</code></pre>
<p>}</p>
<p>Run</p>
<p>RunKillClose</p>
<p>[Exercise: Modify the examples above to use a slice of bytes instead of a string. Hint: Use a conversion to create the slice.]</p>
<p>[Exercise: Loop over the string using the <code>%q</code> format on each byte. What does the output tell you?]</p>
<h2 id="utf-8-and-string-literals">UTF-8 and string literals</h2>
<p>As we saw, indexing a string yields its bytes, not its characters: a string is just a bunch of bytes. That means that when we store a character value in a string, we store its byte-at-a-time representation. Let’s look at a more controlled example to see how that happens.</p>
<p>Here’s a simple program that prints a string constant with a single character three different ways, once as a plain string, once as an ASCII-only quoted string, and once as individual bytes in hexadecimal. To avoid any confusion, we create a “raw string”, enclosed by back quotes, so it can contain only literal text. (Regular strings, enclosed by double quotes, can contain escape sequences as we showed above.)</p>
<p>// +build OMIT</p>
<p>// Copyright 2013 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.</p>
<p>package main</p>
<p>import &ldquo;fmt&rdquo;</p>
<p>func main() {
const placeOfInterest = `⌘`</p>
<pre><code>fmt.Printf(&quot;plain string: &quot;)
fmt.Printf(&quot;%s&quot;, placeOfInterest)
fmt.Printf(&quot;\\n&quot;)

fmt.Printf(&quot;quoted string: &quot;)
fmt.Printf(&quot;%+q&quot;, placeOfInterest)
fmt.Printf(&quot;\\n&quot;)

fmt.Printf(&quot;hex bytes: &quot;)
for i := 0; i &lt; len(placeOfInterest); i++ {
    fmt.Printf(&quot;%x &quot;, placeOfInterest\[i\])
}
fmt.Printf(&quot;\\n&quot;)
</code></pre>
<p>}</p>
<p>Run</p>
<p>RunKillClose</p>
<p>The output is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">plain string: ⌘
quoted string: &#34;\u2318&#34;
hex bytes: e2 8c 98
</code></pre></td></tr></table>
</div>
</div><p>which reminds us that the Unicode character value U+2318, the “Place of Interest” symbol ⌘, is represented by the bytes <code>e2</code> <code>8c</code> <code>98</code>, and that those bytes are the UTF-8 encoding of the hexadecimal value 2318.</p>
<p>It may be obvious or it may be subtle, depending on your familiarity with UTF-8, but it’s worth taking a moment to explain how the UTF-8 representation of the string was created. The simple fact is: it was created when the source code was written.</p>
<p>Source code in Go is <em>defined</em> to be UTF-8 text; no other representation is allowed. That implies that when, in the source code, we write the text</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">`⌘`
</code></pre></td></tr></table>
</div>
</div><p>the text editor used to create the program places the UTF-8 encoding of the symbol ⌘ into the source text. When we print out the hexadecimal bytes, we’re just dumping the data the editor placed in the file.</p>
<p>In short, Go source code is UTF-8, so <em>the source code for the string literal is UTF-8 text</em>. If that string literal contains no escape sequences, which a raw string cannot, the constructed string will hold exactly the source text between the quotes. Thus by definition and by construction the raw string will always contain a valid UTF-8 representation of its contents. Similarly, unless it contains UTF-8-breaking escapes like those from the previous section, a regular string literal will also always contain valid UTF-8.</p>
<p>Some people think Go strings are always UTF-8, but they are not: only string literals are UTF-8. As we showed in the previous section, string <em>values</em> can contain arbitrary bytes; as we showed in this one, string <em>literals</em> always contain UTF-8 text as long as they have no byte-level escapes.</p>
<p>To summarize, strings can contain arbitrary bytes, but when constructed from string literals, those bytes are (almost always) UTF-8.</p>
<h2 id="code-points-characters-and-runes">Code points, characters, and runes</h2>
<p>We’ve been very careful so far in how we use the words “byte” and “character”. That’s partly because strings hold bytes, and partly because the idea of “character” is a little hard to define. The Unicode standard uses the term “code point” to refer to the item represented by a single value. The code point U+2318, with hexadecimal value 2318, represents the symbol ⌘. (For lots more information about that code point, see <a href="http://unicode.org/cldr/utility/character.jsp?a=2318" target="_blank" rel="noopener noreffer">its Unicode page</a>.)</p>
<p>To pick a more prosaic example, the Unicode code point U+0061 is the lower case Latin letter ‘A’: a.</p>
<p>But what about the lower case grave-accented letter ‘A’, à? That’s a character, and it’s also a code point (U+00E0), but it has other representations. For example we can use the “combining” grave accent code point, U+0300, and attach it to the lower case letter a, U+0061, to create the same character à. In general, a character may be represented by a number of different sequences of code points, and therefore different sequences of UTF-8 bytes.</p>
<p>The concept of character in computing is therefore ambiguous, or at least confusing, so we use it with care. To make things dependable, there are <em>normalization</em> techniques that guarantee that a given character is always represented by the same code points, but that subject takes us too far off the topic for now. A later blog post will explain how the Go libraries address normalization.</p>
<p>“Code point” is a bit of a mouthful, so Go introduces a shorter term for the concept: <em>rune</em>. The term appears in the libraries and source code, and means exactly the same as “code point”, with one interesting addition.</p>
<p>The Go language defines the word <code>rune</code> as an alias for the type <code>int32</code>, so programs can be clear when an integer value represents a code point. Moreover, what you might think of as a character constant is called a <em>rune constant</em> in Go. The type and value of the expression</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">&#39;⌘&#39;
</code></pre></td></tr></table>
</div>
</div><p>is <code>rune</code> with integer value <code>0x2318</code>.</p>
<p>To summarize, here are the salient points:</p>
<ul>
<li>Go source code is always UTF-8.</li>
<li>A string holds arbitrary bytes.</li>
<li>A string literal, absent byte-level escapes, always holds valid UTF-8 sequences.</li>
<li>Those sequences represent Unicode code points, called runes.</li>
<li>No guarantee is made in Go that characters in strings are normalized.</li>
</ul>
<h2 id="range-loops">Range loops</h2>
<p>Besides the axiomatic detail that Go source code is UTF-8, there’s really only one way that Go treats UTF-8 specially, and that is when using a <code>for</code> <code>range</code> loop on a string.</p>
<p>We’ve seen what happens with a regular <code>for</code> loop. A <code>for</code> <code>range</code> loop, by contrast, decodes one UTF-8-encoded rune on each iteration. Each time around the loop, the index of the loop is the starting position of the current rune, measured in bytes, and the code point is its value. Here’s an example using yet another handy <code>Printf</code> format, <code>%#U</code>, which shows the code point’s Unicode value and its printed representation:</p>
<p>// +build OMIT</p>
<p>// Copyright 2013 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.</p>
<p>package main</p>
<p>import &ldquo;fmt&rdquo;</p>
<p>func main() {</p>
<pre><code>const nihongo = &quot;日本語&quot;
for index, runeValue := range nihongo {
    fmt.Printf(&quot;%#U starts at byte position %d\\n&quot;, runeValue, index)
}
</code></pre>
<p>}</p>
<p>Run</p>
<p>RunKillClose</p>
<p>The output shows how each code point occupies multiple bytes:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">U+65E5 &#39;日&#39; starts at byte position 0
U+672C &#39;本&#39; starts at byte position 3
U+8A9E &#39;語&#39; starts at byte position 6
</code></pre></td></tr></table>
</div>
</div><p>[Exercise: Put an invalid UTF-8 byte sequence into the string. (How?) What happens to the iterations of the loop?]</p>
<h2 id="libraries">Libraries</h2>
<p>Go’s standard library provides strong support for interpreting UTF-8 text. If a <code>for</code> <code>range</code> loop isn’t sufficient for your purposes, chances are the facility you need is provided by a package in the library.</p>
<p>The most important such package is <a href="https://go.dev/pkg/unicode/utf8/" target="_blank" rel="noopener noreffer"><code>unicode/utf8</code></a>, which contains helper routines to validate, disassemble, and reassemble UTF-8 strings. Here is a program equivalent to the <code>for</code> <code>range</code> example above, but using the <code>DecodeRuneInString</code> function from that package to do the work. The return values from the function are the rune and its width in UTF-8-encoded bytes.</p>
<p>// +build OMIT</p>
<p>// Copyright 2013 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.</p>
<p>package main</p>
<p>import (
&ldquo;fmt&rdquo;
&ldquo;unicode/utf8&rdquo;
)</p>
<p>func main() {</p>
<pre><code>const nihongo = &quot;日本語&quot;
for i, w := 0, 0; i &lt; len(nihongo); i += w {
    runeValue, width := utf8.DecodeRuneInString(nihongo\[i:\])
    fmt.Printf(&quot;%#U starts at byte position %d\\n&quot;, runeValue, i)
    w = width
}
</code></pre>
<p>}</p>
<p>Run</p>
<p>RunKillClose</p>
<p>Run it to see that it performs the same. The <code>for</code> <code>range</code> loop and <code>DecodeRuneInString</code> are defined to produce exactly the same iteration sequence.</p>
<p>Look at the <a href="https://go.dev/pkg/unicode/utf8/" target="_blank" rel="noopener noreffer">documentation</a> for the <code>unicode/utf8</code> package to see what other facilities it provides.</p>
<h2 id="conclusion">Conclusion</h2>
<p>To answer the question posed at the beginning: Strings are built from bytes so indexing them yields bytes, not characters. A string might not even hold characters. In fact, the definition of “character” is ambiguous and it would be a mistake to try to resolve the ambiguity by defining that strings are made of characters.</p>
<p>There’s much more to say about Unicode, UTF-8, and the world of multilingual text processing, but it can wait for another post. For now, we hope you have a better understanding of how Go strings behave and that, although they may contain arbitrary bytes, UTF-8 is a central part of their design.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-10-29 00:00:00</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://jefofrank.xyz/gb_20131023/" data-title="Gb_20131023" data-hashtags="go official blogs"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://jefofrank.xyz/gb_20131023/" data-hashtag="go official blogs"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Reddit" data-sharer="reddit" data-url="https://jefofrank.xyz/gb_20131023/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://jefofrank.xyz/gb_20131023/" data-title="Gb_20131023"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://jefofrank.xyz/gb_20131023/" data-title="Gb_20131023"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://jefofrank.xyz/gb_20131023/" data-title="Gb_20131023"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/baidu.svg"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/go-official-blogs/">go official blogs</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/gb_20130926/" class="prev" rel="prev" title="Gb_20130926"><i class="fas fa-angle-left fa-fw"></i>Gb_20130926</a>
            <a href="/gb_20131110/" class="next" rel="next" title="Gb_20131110">Gb_20131110<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.89.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/jf-011101" target="_blank">Jefo</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp"><a href="https://beian.miit.gov.cn/">赣ICP备2022007470号-1</a></span></br>
                <span id="busuanzi_container_site_pv">
                    访问量 <span id="busuanzi_value_site_pv"></span> 次
                </span>
                &nbsp;|&nbsp;
                <span id="busuanzi_container_site_uv">
                    访客数 <span id="busuanzi_value_site_uv"></span> 人次
                </span>
                </br><script>
                    function siteTime() {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = 2021;
                        var startMonth = 3;
                        var startDate = 27;
                        var startHour = 19;
                        var startMinute = 15;
                        var startSecond = 11;
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);
                        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                            minutes);
                        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                            diffMinutes * minutes) / seconds);
                        if (startYear == todayYear) {
                            
                            document.getElementById("sitetime").innerHTML = "已安全运行 " + diffDays + " 天 " + diffHours +
                                " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                        } else {
                            
                            document.getElementById("sitetime").innerHTML = "已安全运行 " + diffYears + " 年 " + diffDays +
                                " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                        }
                    }
                    setInterval(siteTime, 1000);
                </script>
                    <span id="sitetime">载入运行时间...</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><script type="text/javascript" src="https://jefos-blog.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"data":{"id-1":"绿叶律动","id-2":"绿叶律动"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"J0OW8CCKJZ","algoliaIndex":"JF-2","algoliaSearchKey":"3b4a19e831c95174aca4c03fcdf95f5c","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
