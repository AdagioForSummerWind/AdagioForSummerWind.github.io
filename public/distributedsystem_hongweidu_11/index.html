<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>DistributedSystem_HongweiDu_11 - 绿叶律动</title><meta name="Description" content="绿叶律动"><meta property="og:title" content="DistributedSystem_HongweiDu_11" />
<meta property="og:description" content="2021哈工大深圳堵宏伟分布式系统课程笔记 Unix File Systems文件系统 File Systems： File system provides the most fundamental service for building any information systems. file storage, management and retrieve service. We look at two file operations: fp = open" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jefofrank.xyz/distributedsystem_hongweidu_11/" /><meta property="og:image" content="https://jefofrank.xyz/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-01T15:21:34+08:00" />
<meta property="article:modified_time" content="2022-10-08T19:55:40+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jefofrank.xyz/logo.png"/>

<meta name="twitter:title" content="DistributedSystem_HongweiDu_11"/>
<meta name="twitter:description" content="2021哈工大深圳堵宏伟分布式系统课程笔记 Unix File Systems文件系统 File Systems： File system provides the most fundamental service for building any information systems. file storage, management and retrieve service. We look at two file operations: fp = open"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://jefofrank.xyz/distributedsystem_hongweidu_11/" /><link rel="prev" href="https://jefofrank.xyz/isc_base_10/" /><link rel="next" href="https://jefofrank.xyz/distributedsystem_hongweidu_12/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "DistributedSystem_HongweiDu_11",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/jefofrank.xyz\/distributedsystem_hongweidu_11\/"
        },"image": ["https:\/\/jefofrank.xyz\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "distributed system","wordcount":  2599 ,
        "url": "https:\/\/jefofrank.xyz\/distributedsystem_hongweidu_11\/","datePublished": "2022-01-01T15:21:34+08:00","dateModified": "2022-10-08T19:55:40+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Jefo","logo": "https:\/\/jefofrank.xyz\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "Jefo"
            },"description": ""
    }
    </script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-193031966-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-193031966-2');
</script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="绿叶律动"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> All posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/jf-011101" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="直接搜索更方便^-^" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="绿叶律动"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="直接搜索更方便^-^" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">All posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/jf-011101" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">DistributedSystem_HongweiDu_11</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/jf-011101" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jefo</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/school-courses/"><i class="far fa-folder fa-fw"></i>School courses</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-01-01 15:21:34">2022-01-01 15:21:34</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2599 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;<span id="busuanzi_container_page_pv">
                    <i class="far fa-eye fa-fw"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;次阅读量</span>
                </span>
            </div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#unix-file-systems文件系统">Unix File Systems文件系统</a></li>
    <li><a href="#distributed-file-systems">Distributed File Systems</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>2021哈工大深圳堵宏伟分布式系统课程笔记</p>
</blockquote>
<h2 id="unix-file-systems文件系统">Unix File Systems文件系统</h2>
<p>File Systems：</p>
<ul>
<li>File system provides the most fundamental service for building any information systems.
<ul>
<li>file storage, management and retrieve service.</li>
</ul>
</li>
<li>We look at two file operations:
<ul>
<li>fp = open (“cs4274/exam”, r, 0);</li>
<li>r = read (fp, n, buf);</li>
</ul>
</li>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202700.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202700.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202700.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202700.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202700.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202700.png" /></li>
</ul>
<p>Hard disk Structure：</p>
<ul>
<li>Head, cylinder, sector
<ul>
<li>Data stored in the same cylinder first to reduce the head movement</li>
</ul>
</li>
<li>Disk operation in units of sectors</li>
<li>An IBM hard disk configuration:
<ul>
<li>10 heads</li>
<li>40 tracks-per-disk (cylinders)</li>
<li>32 sectors-per-track</li>
<li>512 bytes/sector</li>
</ul>
</li>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202947.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202947.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202947.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202947.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202947.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101202947.png" /></li>
</ul>
<p>Data Block and Block Number：</p>
<ul>
<li>File system uses block as a data unit for disk operation
<ul>
<li>Usually a block size is 1K (&gt;=  sector size)</li>
<li>Disk block is referenced by its block #</li>
</ul>
</li>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101205249.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101205249.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101205249.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101205249.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101205249.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101205249.png" /></li>
<li>Block # to Physical Address Translation
<ul>
<li>sectors = blk_num  (#sects-per-blk)</li>
<li>cyld_num = sectors  (#sects-per-cyld)</li>
<li>head_num = (sectors mod (#sects-per-cyld)) / (#sects-per-track)</li>
<li>sect_num =  sectors mod (#sects-per-track)</li>
</ul>
</li>
</ul>
<p>Internal File Structure :</p>
<ul>
<li>Each file has an i-node: file attributes and data index:</li>
<li>File attributes:
<ul>
<li>owner, access permissions, access times, file size</li>
<li>12 bytes</li>
</ul>
</li>
<li>Data index:
<ul>
<li>13 indices: 10 direct indices, 1 indirect index, 1 double indirect index, 1 triple indirect index</li>
<li>13 * 4 =52 bytes</li>
</ul>
</li>
<li>The size of an inode = 64 bytes.</li>
<li>An inode is referenced by its inode #</li>
</ul>
<p>Diagram of data index in inode :</p>
<ul>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210530.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210530.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210530.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210530.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210530.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210530.png" /></li>
</ul>
<p>Unix Directory File :</p>
<ul>
<li>Directory files are ordinary files consisting of entries mapping names to i-node #, e.g., directory file /etc</li>
<li>After BSD4.3, file names are of variable length (upto 255 bytes). Each entry has the entry-length, name &amp; inode #.</li>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210607.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210607.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210607.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210607.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210607.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101210607.png" /></li>
</ul>
<p>Directory structure and name resolution:</p>
<ul>
<li>Directories are in a tree structure.</li>
<li>Resolve pathname recursively to i-node number, component by component from the root (or relative) directory, e.g. /home/lec/jia/unix-fs.doc</li>
<li>a) Starting from inode # 3 of “/” -&gt; load inode of “/”</li>
<li>b) Read content of directory file “/”:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">  1368 bin@             1478 lib/           233756 rpool/        2484 boot/            1486 mnt/             
   1489 sbin/              1369 dev/         154559 net/           1494 system/       2818 devices/       
   6 export/                 2429 platform/  5 var/                    27376 home/ ………………….
</code></pre></td></tr></table>
</div>
</div><ul>
<li>c) Map “home” -&gt; inode # 27376 -&gt; load inode 27376</li>
<li>d) Read directory file “/home”:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">94171 bsft08/       93753 course/         231 lec/               94363 ms10/
55531 bsft09/       94125 cslab/           94239 misc/         91159 ms11/ ……
</code></pre></td></tr></table>
</div>
</div><ul>
<li>e) Map “lec” -&gt; inode # 231 -&gt; load inode 231</li>
<li>d) Repeat the above steps until map “unix-fs.doc” -&gt; inode #</li>
</ul>
<p>Disk Management (inode # -&gt; i-nodes):</p>
<ul>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211558.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211558.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211558.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211558.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211558.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211558.png" /></li>
</ul>
<p>Super block 超级块:</p>
<ul>
<li>Each file system has a super block which contains:
<ul>
<li>The size of the file system</li>
<li>The number of free blocks in the system</li>
<li>An array of cached free block numbers</li>
<li>The index of the next free block number</li>
<li>A pointer to the start of i-nodes area</li>
<li>The number of free i-nodes in the system</li>
<li>A list of cached free i-node numbers</li>
<li>The index of the next free i-node numbers</li>
</ul>
</li>
<li>The super block (usually one disk block) of the root file system must be loaded into memory when system is up.</li>
</ul>
<p>Calculate an inode address by inode number :</p>
<ul>
<li>blk_num = (inode_num -1) / #inodes-per-blk + st-addr-inodes</li>
<li>byte_offset = ((inode_num -1) mod (#inodes-per-blk))*inode-size</li>
<li>N.B. In UNIX, inode-size = 64,  #inodes-per-blk = 16</li>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211936.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211936.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211936.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211936.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211936.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101211936.png" /></li>
</ul>
<p>Summary on address translations:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">pathname 	-&gt; 	inode #
            -&gt; 	inode address (block # &amp; offset)
            -&gt; 	inode 
            -&gt; 	data block #
            -&gt; 	disk address
            -&gt; 	data 
</code></pre></td></tr></table>
</div>
</div><p>Internal Structure for File Accesses :</p>
<ul>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212105.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212105.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212105.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212105.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212105.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212105.png" /></li>
</ul>
<p>Pseudo-code for open operation :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">int open (path-name, op) {
	i = resolve(path-name);
	if inode(i) in inode-table then
		    inode-table(i).count++;
	else
		    load inode(i) into inode-table;
	create an entry in file-table, file-entry(i);
	file-entry(i).count = 1; file-entry(i).op = op; file-entry(i).offset = 0; 
	file-entry(i).inode-ptr = &amp;(inode-table(i));
	fd = get the next entry in file-descript-table, fdt;
	fdt[fd] = &amp;(file-entry(i));
	return fd;
}
</code></pre></td></tr></table>
</div>
</div><p>Pseudo-code for read operation :</p>
<ul>
<li>Steps of reading a file data:</li>
<li>read (fp, n, buf)</li>
<li>fp -&gt;
<ul>
<li>pointer to the entry in file-table, getting offset</li>
<li>pointer to the entry in inode-table</li>
<li>get the block # of the data</li>
<li>convert the block # to head, cylinder, sector</li>
<li>ask disk controller to read in data and copy the n bytes into buf</li>
</ul>
</li>
</ul>
<p>Global File Organization :</p>
<ul>
<li>Disk Partitions
<ul>
<li>disk units are partitioned into sections.</li>
<li>each section is configured into a file system.</li>
<li>inode numbers and disk block numbers are valid within a file system.</li>
</ul>
</li>
</ul>
<p>Mount/umount operations :</p>
<ul>
<li>mount(dev_name, dir_name, options);   umount(dev_name)
<ul>
<li>e.g., mount(“/dev/dsk1”, “/usr”, 0)</li>
</ul>
</li>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212314.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212314.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212314.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212314.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212314.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212314.png" /></li>
</ul>
<p>Mount table:</p>
<ul>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212339.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212339.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212339.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212339.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212339.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212339.png" /></li>
</ul>
<p>Name resolution cross mount point:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">- mount /dev/dsk1  /usr
- cd /usr/src/uts
</code></pre></td></tr></table>
</div>
</div><ul>
<li>When the kernel parses the path name crossing a mount point, from the inode it knows this is a mount point.</li>
<li>It finds the mount table entry, which contains the addr of the super block and a pointer to the root inode (incore).</li>
<li>It then accesses the root inode of the mounted file system. The rest of the name resolution is inside the mounted fs.</li>
</ul>
<p>Link files :</p>
<ul>
<li>Link system call is
<ul>
<li>link(sour_fname, dest_fname)</li>
<li>e.g.  	link(“usr/src/uts/sys”, “/usr/include/sys”)</li>
</ul>
</li>
<li>File system first finds the inode # of the source file.</li>
<li>It then searches for the parent directory of the dest_fname.</li>
<li>It adds an entry in the parent directory of the dest file), and fills in the pair of dest_fname and the inode #.</li>
<li>Notice: link cannot cross a file system.</li>
</ul>
<h2 id="distributed-file-systems">Distributed File Systems</h2>
<p>DFS Goals:</p>
<ul>
<li>Location transparency: a uniform file name space that does not contain file physical location information.</li>
<li>Concurrency transparency: a user’s file operations will not be interfered by another user.</li>
<li>Failure transparency: when part of the system fails, the rest of the system can still provide file services.</li>
<li>Heterogeneity: interoperable among different operating systems and communication protocols.</li>
<li>Scalability: the system performance will not deteriorate as the system size grows.</li>
</ul>
<p>Distributed File System Components :</p>
<ul>
<li>Flat file service: offer a simple set of general operations to access attributes and data of files, indexed by UFIDs.</li>
<li>Directory service: map text names to UFIDs.</li>
<li>Client module: allow access to file &amp; directory service under a single application programming interface.</li>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212656.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212656.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212656.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212656.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212656.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212656.png" /></li>
</ul>
<p>Distributed File System Interface:</p>
<ul>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212718.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212718.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212718.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212718.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212718.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101212718.png" /></li>
</ul>
<p>Flat file service operations:</p>
<ul>
<li>read(UFID,i n) -&gt; Data   If1≤i≤Length(File), read a sequence of up to n items from a file starting at item i and returns it in Data.
<ul>
<li>throws BadlPosition,</li>
</ul>
</li>
<li>write(UFID, i, Data) If1≤i≤Length(File)+I, write a sequence of Data to a file. starting at item i.
<ul>
<li>throws BadPosition</li>
</ul>
</li>
<li>create( &gt; UFID Create a new file with length 0 and return its UFID.</li>
<li>delete(UFID) Remove the file from the file store.</li>
<li>gettributes(UFID) &gt; Attr   Return attributes of the file.</li>
<li>setlttributes(UFID, Attr)   Set file attributes.</li>
</ul>
<p>Directory service operations:</p>
<ul>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213441.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213441.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213441.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213441.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213441.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213441.png" /></li>
</ul>
<p>Constructing a Hierarchical FS at Client Module:</p>
<ul>
<li>A hierarchical file naming system can be constructed by the client module by using file &amp; directory services.</li>
<li>The root of the directory tree is a directory with a well-known UFID.</li>
<li>A pathname resolution function is provided in the client module.</li>
</ul>
<p>Differences between DFS and stand-alone FS :</p>
<ul>
<li>Separation of file service and directory service:
<ul>
<li>The file service is made more general and the design of directory service can be more flexible.</li>
<li>It off loads directory service from file server.</li>
</ul>
</li>
<li>Stateless servers and emulations in the client module:
<ul>
<li>File server is made very light weighted, leaving most of work to the client module.</li>
<li>Server can recover from failure efficiently, with no need to restore client’s states.</li>
<li>Client module emulates the traditional FS interface.</li>
</ul>
</li>
<li>Repeatable operations
<ul>
<li>File operations are idempotent, allowing the use of at-least-once RPC semantics.</li>
<li>Operation create is exceptional (but no side-effect to users).</li>
</ul>
</li>
</ul>
<p>Capabilities and Access Control :</p>
<ul>
<li>Clients interacts with dir-server and file-server via RPCs. There is a security loophole, allowing unauthorized user to use other’s ID to access files illegally.</li>
<li>Capability (in the form of a UFID) is a digital key used to identify and access file by clients in distributed FS.</li>
<li>A capability includes information of file location (groupID), FID, and access control.</li>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213614.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213614.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213614.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213614.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213614.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101213614.png" /></li>
<li>Directory server generates the capability of a file based on to client’s ID and access permission.</li>
<li>Capabilities is used for access control to the file.</li>
<li>A capability must have an encrypted field to prevent it from being modified or mis-used by others. The encryption key is usually shared between the directory server and file server.</li>
</ul>
<p>File Representation :</p>
<ul>
<li>An index block (similar to i-node in UNIX) is used for each file to point to data blocks (or another layer of index blocks).</li>
<li>Locating an index block is done by using UFID. The UFIDs can be organized to B-tree structure for efficient search.
<ul>
<li>The mappings from UFIDs to the corresponding index-blocks are stored in disk, and the mappings can be too big to be in memory at once.</li>
</ul>
</li>
<li>Server’s location (file group ID) is embedded in UFID. The client needs to know server’s location before making RPC for file access. This can be done by the following RPC to any server:
<ul>
<li>PortID = GetServerPort(FileGroupID)</li>
</ul>
</li>
</ul>
<p>Space Leaks:</p>
<ul>
<li>Some files whose directory links have been removed may remain in disk and never be accessed, due to the separation of directory servers from file servers.</li>
<li>The problem is ignored, or prevented in most of the systems.</li>
<li>A “life-time” method aims to solve the problem:
<ul>
<li>the dir-server periodically touch all files, i.e., set a life-time to all files registered with the directory-server.</li>
<li>file-server decrements the life-time of all files at some clock rate, and each access to a file will renew its lifetime.</li>
<li>The files with life-time 0 will be removed (they are not accessed).</li>
</ul>
</li>
</ul>
<p>Google File System (an example):</p>
<ul>
<li>GFS aims to provide fault-tolerant and highly concurrent accesses to huge files. It consists of GFS client, a single GFS master, and many GFS chunkservers.</li>
<li>The client requests the master (directory server) with file-name and chunk index (translated from user’s byte-offset within a file and the fixed chunk size, 64MB).</li>
<li>The master replies with the chunk handle and location of the replicas.</li>
<li>The client requests one of the replicas (chunkserver, i.e., data server) with chunk handle and a byte-range within the chunk for data-access.</li>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215407.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215407.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215407.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215407.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215407.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215407.png" /></li>
</ul>
<p>Sun Network File System (NFS) :</p>
<ul>
<li>The Network File System (NFS) was developed to allow machines to mount a local directory to a remote file system as if it were on a local disk. It facilitates fast and seamless sharing of files across a network.</li>
<li>It is an open standard with clear and simple interfaces (an industry standard for file sharing in LANs since 1980s).
It follows the abstract file service model defined for Distributed File Systems.</li>
</ul>
<p>NFS server operations (RFC1813, 1995):</p>
<ul>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215604.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215604.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215604.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215604.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215604.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215604.png" /></li>
</ul>
<p>NFS architecture:</p>
<ul>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215629.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215629.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215629.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215629.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215629.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215629.png" /></li>
</ul>
<p>NFS Structure:</p>
<ul>
<li>NFS client module resides in the UNIX kernel. It emulates exactly the semantics of UNIX file system.
<ul>
<li>application programs can run in NFS without any change.</li>
<li>a single client module serves all user processes.</li>
</ul>
</li>
<li>NFS client and server modules communicate using NFS protocol and mount protocol (through Sun RPCs).</li>
<li>NFS server is stateless. It provides reliable file operations.</li>
</ul>
<p>NFS Virtual File System :</p>
<ul>
<li>NFS introduces a Virtual File System (VFS) layer. It maintains an entry of v-node (virtual i-node) for each file that is currently opened or mounted.</li>
<li>v-node is a data structure maintained in OS (similar to incore inode-table in unix), not stored on disk. It indicates whether a file is local or remote.
<ul>
<li>For a local file, it contains i-node.</li>
<li>For a remote file, it contains the file-handle as following:</li>
</ul>
</li>
<li>FileSystem ID&mdash;-i-node number&mdash;-i-node generation number</li>
</ul>
<p>Mount remote file systems to client in NFS:</p>
<ul>
<li><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215932.png"
        data-srcset="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215932.png, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215932.png 1.5x, https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215932.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215932.png"
        title="https://raw.githubusercontent.com/JF-011101/Image_hosting_rep/main/20220101215932.png" /></li>
<li>Note: The file system mounted at /usr/students in Client is a sub-tree located at /export/people in Server 1;</li>
<li>The file system mounted at /usr/staff in Client is the sub-tree located at /nfs/users in Server 2.</li>
</ul>
<p>Mount Service:</p>
<ul>
<li>Each NFS server runs a mount process at application level.</li>
<li>Client module requests mount of a remote file system by specifying
remote host name, pathname and local directory to be mounted.</li>
<li>The mount process at the server communicates with the client by a mount protocol (RPCs), and returns the file-handle of the mounted directory to the client.</li>
<li>The client keeps the file-handle (containing location of the server) in the v-node of the mounted directory for subsequent file accesses.</li>
</ul>
<p>File Sharing (export for mount): by server:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">share  [-F FSType]  [-o specific_options]   [-d description] [pathname]
dfshares [-F FSType] [-h] [-o specific_options] [server...]
</code></pre></td></tr></table>
</div>
</div><ul>
<li>share: export, or make a resource available for mounting, through a type specified FSType, or the first file-system-type listed in /etc/dfs/fstypes file.
<ul>
<li>/etc/dfs/fstypes: list of DFS utilities installed on the system. For each installed DFS type, there is a line starting with file system type (e.g., “nfs” or “autofs”), followed by descriptive text.</li>
<li>/etc/dfs/dfstab: list of share commands to be executed at boot time</li>
<li>/etc/dfs/sharetab: system record of shared file systems</li>
</ul>
</li>
<li>dfshares: list available resources from remote or local  systems
<ul>
<li>For each resource, the fields are: resource server access transport</li>
</ul>
</li>
</ul>
<p>Mount Remote Files: by client:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">mount [ -F nfs] [generic_options] [-o specific_options]  [-O] resource mount_point
mountall [-F FSType] [-l | -r]  [file_system_table]
</code></pre></td></tr></table>
</div>
</div><ul>
<li>The mount process attaches a named directory to the file system hierarchy at the pathname location mount_point.</li>
<li>/etc/vfstab: list of default parameters for each file system.
<ul>
<li>Each entry consists of space-separated fields:
<ul>
<li>device  to  mount, device to fsck, mount point, FS type, fsck pass, mount at boot, mount  options.</li>
</ul>
</li>
<li>Those file systems with the mount-at-boot field “yes” are mounted automatically at boot time by mountall</li>
</ul>
</li>
<li>/etc/mnttab: a record of file systems that are currently mounted.
<ul>
<li>Each entry consists of TAB-separated fields:
<ul>
<li>special, mount_point, fstype, options, time</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Automounting:</p>
<ul>
<li>automount [-t duration] [-v]
<ul>
<li>Problem with static mounts
<ul>
<li>If a client has many remote resources mounted, boot-time can be excessive</li>
</ul>
</li>
<li>Automount: Mount and unmount in response to client demand
<ul>
<li>Automounter performs mount according to configuration files (/etc/auto_master, /etc/auto_home)</li>
<li>When an empty mount point is referenced,
<ul>
<li>OS sends a probe message to each server</li>
<li>First reply wins: then uses the mount service to mount the filesystem at the first server to respond</li>
</ul>
</li>
<li>Attempt to unmount every 10 minutes</li>
</ul>
</li>
<li>Automounter (/usr/lib/autofs/automountd) is started at system boot-up time, and is a daemon process running at the client computer</li>
</ul>
</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-10-08 19:55:40&nbsp;<a class="git-hash" href="https://github.com/dillonzq/LoveIt/commit/08d4d6cf8a78e5a1cb353b041919a9e49a704d6a" target="_blank" title="commit by JF-011101(2838264218@qq.com) 08d4d6cf8a78e5a1cb353b041919a9e49a704d6a: feat">
                                    <i class="fas fa-hashtag fa-fw"></i>08d4d6c</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://jefofrank.xyz/distributedsystem_hongweidu_11/" data-title="DistributedSystem_HongweiDu_11" data-hashtags="distributed system"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://jefofrank.xyz/distributedsystem_hongweidu_11/" data-hashtag="distributed system"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Reddit" data-sharer="reddit" data-url="https://jefofrank.xyz/distributedsystem_hongweidu_11/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://jefofrank.xyz/distributedsystem_hongweidu_11/" data-title="DistributedSystem_HongweiDu_11"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://jefofrank.xyz/distributedsystem_hongweidu_11/" data-title="DistributedSystem_HongweiDu_11"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://jefofrank.xyz/distributedsystem_hongweidu_11/" data-title="DistributedSystem_HongweiDu_11"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/baidu.svg"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/distributed-system/">distributed system</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/isc_base_10/" class="prev" rel="prev" title="ISC_base_10"><i class="fas fa-angle-left fa-fw"></i>ISC_base_10</a>
            <a href="/distributedsystem_hongweidu_12/" class="next" rel="next" title="DistributedSystem_HongweiDu_12">DistributedSystem_HongweiDu_12<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.89.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/jf-011101" target="_blank">Jefo</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp"><a href="https://beian.miit.gov.cn/">赣ICP备2022007470号-1</a></span></br>
                <span id="busuanzi_container_site_pv">
                    访问量 <span id="busuanzi_value_site_pv"></span> 次
                </span>
                &nbsp;|&nbsp;
                <span id="busuanzi_container_site_uv">
                    访客数 <span id="busuanzi_value_site_uv"></span> 人次
                </span>
                </br><script>
                    function siteTime() {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = 2021;
                        var startMonth = 3;
                        var startDate = 27;
                        var startHour = 19;
                        var startMinute = 15;
                        var startSecond = 11;
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);
                        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                            minutes);
                        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                            diffMinutes * minutes) / seconds);
                        if (startYear == todayYear) {
                            
                            document.getElementById("sitetime").innerHTML = "已安全运行 " + diffDays + " 天 " + diffHours +
                                " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                        } else {
                            
                            document.getElementById("sitetime").innerHTML = "已安全运行 " + diffYears + " 年 " + diffDays +
                                " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                        }
                    }
                    setInterval(siteTime, 1000);
                </script>
                    <span id="sitetime">载入运行时间...</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><script type="text/javascript" src="https://jefos-blog.disqus.com/embed.js" defer></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"data":{"id-1":"绿叶律动","id-2":"绿叶律动"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"J0OW8CCKJZ","algoliaIndex":"JF-2","algoliaSearchKey":"3b4a19e831c95174aca4c03fcdf95f5c","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
